"use strict";
let src='bGV0IF9fbW9kdWxlcyA9IHt9OwoKZnVuY3Rpb24gcmVxdWlyZShuYW1lKSB7CglyZXR1cm4gX19tb2R1bGVzW25hbWVdLmV4cG9ydHM7Cn0KCmZ1bmN0aW9uIGFkZE1vZHVsZShuYW1lLCBmbikgewoJbGV0IG1vZCA9IHsKCQlleHBvcnRzOiB7fQoJfTsKCV9fbW9kdWxlc1tuYW1lXSA9IG1vZDsKCW1vZC5mbiA9IGZuKHJlcXVpcmUsIG1vZCwgbW9kLmV4cG9ydHMpOwp9CmFkZE1vZHVsZSgnZWFyY3V0JywgZnVuY3Rpb24ocmVxdWlyZSwgbW9kdWxlLCBleHBvcnRzKXsndXNlIHN0cmljdCc7Cgptb2R1bGUuZXhwb3J0cyA9IGVhcmN1dDsKbW9kdWxlLmV4cG9ydHMuZGVmYXVsdCA9IGVhcmN1dDsKCmZ1bmN0aW9uIGVhcmN1dChkYXRhLCBob2xlSW5kaWNlcywgZGltKSB7CgogICAgZGltID0gZGltIHx8IDI7CgogICAgdmFyIGhhc0hvbGVzID0gaG9sZUluZGljZXMgJiYgaG9sZUluZGljZXMubGVuZ3RoLAogICAgICAgIG91dGVyTGVuID0gaGFzSG9sZXMgPyBob2xlSW5kaWNlc1swXSAqIGRpbSA6IGRhdGEubGVuZ3RoLAogICAgICAgIG91dGVyTm9kZSA9IGxpbmtlZExpc3QoZGF0YSwgMCwgb3V0ZXJMZW4sIGRpbSwgdHJ1ZSksCiAgICAgICAgdHJpYW5nbGVzID0gW107CgogICAgaWYgKCFvdXRlck5vZGUpIHJldHVybiB0cmlhbmdsZXM7CgogICAgdmFyIG1pblgsIG1pblksIG1heFgsIG1heFksIHgsIHksIGludlNpemU7CgogICAgaWYgKGhhc0hvbGVzKSBvdXRlck5vZGUgPSBlbGltaW5hdGVIb2xlcyhkYXRhLCBob2xlSW5kaWNlcywgb3V0ZXJOb2RlLCBkaW0pOwoKICAgIC8vIGlmIHRoZSBzaGFwZSBpcyBub3QgdG9vIHNpbXBsZSwgd2UnbGwgdXNlIHotb3JkZXIgY3VydmUgaGFzaCBsYXRlcjsgY2FsY3VsYXRlIHBvbHlnb24gYmJveAogICAgaWYgKGRhdGEubGVuZ3RoID4gODAgKiBkaW0pIHsKICAgICAgICBtaW5YID0gbWF4WCA9IGRhdGFbMF07CiAgICAgICAgbWluWSA9IG1heFkgPSBkYXRhWzFdOwoKICAgICAgICBmb3IgKHZhciBpID0gZGltOyBpIDwgb3V0ZXJMZW47IGkgKz0gZGltKSB7CiAgICAgICAgICAgIHggPSBkYXRhW2ldOwogICAgICAgICAgICB5ID0gZGF0YVtpICsgMV07CiAgICAgICAgICAgIGlmICh4IDwgbWluWCkgbWluWCA9IHg7CiAgICAgICAgICAgIGlmICh5IDwgbWluWSkgbWluWSA9IHk7CiAgICAgICAgICAgIGlmICh4ID4gbWF4WCkgbWF4WCA9IHg7CiAgICAgICAgICAgIGlmICh5ID4gbWF4WSkgbWF4WSA9IHk7CiAgICAgICAgfQoKICAgICAgICAvLyBtaW5YLCBtaW5ZIGFuZCBpbnZTaXplIGFyZSBsYXRlciB1c2VkIHRvIHRyYW5zZm9ybSBjb29yZHMgaW50byBpbnRlZ2VycyBmb3Igei1vcmRlciBjYWxjdWxhdGlvbgogICAgICAgIGludlNpemUgPSBNYXRoLm1heChtYXhYIC0gbWluWCwgbWF4WSAtIG1pblkpOwogICAgICAgIGludlNpemUgPSBpbnZTaXplICE9PSAwID8gMSAvIGludlNpemUgOiAwOwogICAgfQoKICAgIGVhcmN1dExpbmtlZChvdXRlck5vZGUsIHRyaWFuZ2xlcywgZGltLCBtaW5YLCBtaW5ZLCBpbnZTaXplKTsKCiAgICByZXR1cm4gdHJpYW5nbGVzOwp9CgovLyBjcmVhdGUgYSBjaXJjdWxhciBkb3VibHkgbGlua2VkIGxpc3QgZnJvbSBwb2x5Z29uIHBvaW50cyBpbiB0aGUgc3BlY2lmaWVkIHdpbmRpbmcgb3JkZXIKZnVuY3Rpb24gbGlua2VkTGlzdChkYXRhLCBzdGFydCwgZW5kLCBkaW0sIGNsb2Nrd2lzZSkgewogICAgdmFyIGksIGxhc3Q7CgogICAgaWYgKGNsb2Nrd2lzZSA9PT0gKHNpZ25lZEFyZWEoZGF0YSwgc3RhcnQsIGVuZCwgZGltKSA+IDApKSB7CiAgICAgICAgZm9yIChpID0gc3RhcnQ7IGkgPCBlbmQ7IGkgKz0gZGltKSBsYXN0ID0gaW5zZXJ0Tm9kZShpLCBkYXRhW2ldLCBkYXRhW2kgKyAxXSwgbGFzdCk7CiAgICB9IGVsc2UgewogICAgICAgIGZvciAoaSA9IGVuZCAtIGRpbTsgaSA+PSBzdGFydDsgaSAtPSBkaW0pIGxhc3QgPSBpbnNlcnROb2RlKGksIGRhdGFbaV0sIGRhdGFbaSArIDFdLCBsYXN0KTsKICAgIH0KCiAgICBpZiAobGFzdCAmJiBlcXVhbHMobGFzdCwgbGFzdC5uZXh0KSkgewogICAgICAgIHJlbW92ZU5vZGUobGFzdCk7CiAgICAgICAgbGFzdCA9IGxhc3QubmV4dDsKICAgIH0KCiAgICByZXR1cm4gbGFzdDsKfQoKLy8gZWxpbWluYXRlIGNvbGluZWFyIG9yIGR1cGxpY2F0ZSBwb2ludHMKZnVuY3Rpb24gZmlsdGVyUG9pbnRzKHN0YXJ0LCBlbmQpIHsKICAgIGlmICghc3RhcnQpIHJldHVybiBzdGFydDsKICAgIGlmICghZW5kKSBlbmQgPSBzdGFydDsKCiAgICB2YXIgcCA9IHN0YXJ0LAogICAgICAgIGFnYWluOwogICAgZG8gewogICAgICAgIGFnYWluID0gZmFsc2U7CgogICAgICAgIGlmICghcC5zdGVpbmVyICYmIChlcXVhbHMocCwgcC5uZXh0KSB8fCBhcmVhKHAucHJldiwgcCwgcC5uZXh0KSA9PT0gMCkpIHsKICAgICAgICAgICAgcmVtb3ZlTm9kZShwKTsKICAgICAgICAgICAgcCA9IGVuZCA9IHAucHJldjsKICAgICAgICAgICAgaWYgKHAgPT09IHAubmV4dCkgYnJlYWs7CiAgICAgICAgICAgIGFnYWluID0gdHJ1ZTsKCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcCA9IHAubmV4dDsKICAgICAgICB9CiAgICB9IHdoaWxlIChhZ2FpbiB8fCBwICE9PSBlbmQpOwoKICAgIHJldHVybiBlbmQ7Cn0KCi8vIG1haW4gZWFyIHNsaWNpbmcgbG9vcCB3aGljaCB0cmlhbmd1bGF0ZXMgYSBwb2x5Z29uIChnaXZlbiBhcyBhIGxpbmtlZCBsaXN0KQpmdW5jdGlvbiBlYXJjdXRMaW5rZWQoZWFyLCB0cmlhbmdsZXMsIGRpbSwgbWluWCwgbWluWSwgaW52U2l6ZSwgcGFzcykgewogICAgaWYgKCFlYXIpIHJldHVybjsKCiAgICAvLyBpbnRlcmxpbmsgcG9seWdvbiBub2RlcyBpbiB6LW9yZGVyCiAgICBpZiAoIXBhc3MgJiYgaW52U2l6ZSkgaW5kZXhDdXJ2ZShlYXIsIG1pblgsIG1pblksIGludlNpemUpOwoKICAgIHZhciBzdG9wID0gZWFyLAogICAgICAgIHByZXYsIG5leHQ7CgogICAgLy8gaXRlcmF0ZSB0aHJvdWdoIGVhcnMsIHNsaWNpbmcgdGhlbSBvbmUgYnkgb25lCiAgICB3aGlsZSAoZWFyLnByZXYgIT09IGVhci5uZXh0KSB7CiAgICAgICAgcHJldiA9IGVhci5wcmV2OwogICAgICAgIG5leHQgPSBlYXIubmV4dDsKCiAgICAgICAgaWYgKGludlNpemUgPyBpc0Vhckhhc2hlZChlYXIsIG1pblgsIG1pblksIGludlNpemUpIDogaXNFYXIoZWFyKSkgewogICAgICAgICAgICAvLyBjdXQgb2ZmIHRoZSB0cmlhbmdsZQogICAgICAgICAgICB0cmlhbmdsZXMucHVzaChwcmV2LmkgLyBkaW0pOwogICAgICAgICAgICB0cmlhbmdsZXMucHVzaChlYXIuaSAvIGRpbSk7CiAgICAgICAgICAgIHRyaWFuZ2xlcy5wdXNoKG5leHQuaSAvIGRpbSk7CgogICAgICAgICAgICByZW1vdmVOb2RlKGVhcik7CgogICAgICAgICAgICAvLyBza2lwcGluZyB0aGUgbmV4dCB2ZXJ0aWNlIGxlYWRzIHRvIGxlc3Mgc2xpdmVyIHRyaWFuZ2xlcwogICAgICAgICAgICBlYXIgPSBuZXh0Lm5leHQ7CiAgICAgICAgICAgIHN0b3AgPSBuZXh0Lm5leHQ7CgogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIGVhciA9IG5leHQ7CgogICAgICAgIC8vIGlmIHdlIGxvb3BlZCB0aHJvdWdoIHRoZSB3aG9sZSByZW1haW5pbmcgcG9seWdvbiBhbmQgY2FuJ3QgZmluZCBhbnkgbW9yZSBlYXJzCiAgICAgICAgaWYgKGVhciA9PT0gc3RvcCkgewogICAgICAgICAgICAvLyB0cnkgZmlsdGVyaW5nIHBvaW50cyBhbmQgc2xpY2luZyBhZ2FpbgogICAgICAgICAgICBpZiAoIXBhc3MpIHsKICAgICAgICAgICAgICAgIGVhcmN1dExpbmtlZChmaWx0ZXJQb2ludHMoZWFyKSwgdHJpYW5nbGVzLCBkaW0sIG1pblgsIG1pblksIGludlNpemUsIDEpOwoKICAgICAgICAgICAgLy8gaWYgdGhpcyBkaWRuJ3Qgd29yaywgdHJ5IGN1cmluZyBhbGwgc21hbGwgc2VsZi1pbnRlcnNlY3Rpb25zIGxvY2FsbHkKICAgICAgICAgICAgfSBlbHNlIGlmIChwYXNzID09PSAxKSB7CiAgICAgICAgICAgICAgICBlYXIgPSBjdXJlTG9jYWxJbnRlcnNlY3Rpb25zKGVhciwgdHJpYW5nbGVzLCBkaW0pOwogICAgICAgICAgICAgICAgZWFyY3V0TGlua2VkKGVhciwgdHJpYW5nbGVzLCBkaW0sIG1pblgsIG1pblksIGludlNpemUsIDIpOwoKICAgICAgICAgICAgLy8gYXMgYSBsYXN0IHJlc29ydCwgdHJ5IHNwbGl0dGluZyB0aGUgcmVtYWluaW5nIHBvbHlnb24gaW50byB0d28KICAgICAgICAgICAgfSBlbHNlIGlmIChwYXNzID09PSAyKSB7CiAgICAgICAgICAgICAgICBzcGxpdEVhcmN1dChlYXIsIHRyaWFuZ2xlcywgZGltLCBtaW5YLCBtaW5ZLCBpbnZTaXplKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQp9CgovLyBjaGVjayB3aGV0aGVyIGEgcG9seWdvbiBub2RlIGZvcm1zIGEgdmFsaWQgZWFyIHdpdGggYWRqYWNlbnQgbm9kZXMKZnVuY3Rpb24gaXNFYXIoZWFyKSB7CiAgICB2YXIgYSA9IGVhci5wcmV2LAogICAgICAgIGIgPSBlYXIsCiAgICAgICAgYyA9IGVhci5uZXh0OwoKICAgIGlmIChhcmVhKGEsIGIsIGMpID49IDApIHJldHVybiBmYWxzZTsgLy8gcmVmbGV4LCBjYW4ndCBiZSBhbiBlYXIKCiAgICAvLyBub3cgbWFrZSBzdXJlIHdlIGRvbid0IGhhdmUgb3RoZXIgcG9pbnRzIGluc2lkZSB0aGUgcG90ZW50aWFsIGVhcgogICAgdmFyIHAgPSBlYXIubmV4dC5uZXh0OwoKICAgIHdoaWxlIChwICE9PSBlYXIucHJldikgewogICAgICAgIGlmIChwb2ludEluVHJpYW5nbGUoYS54LCBhLnksIGIueCwgYi55LCBjLngsIGMueSwgcC54LCBwLnkpICYmCiAgICAgICAgICAgIGFyZWEocC5wcmV2LCBwLCBwLm5leHQpID49IDApIHJldHVybiBmYWxzZTsKICAgICAgICBwID0gcC5uZXh0OwogICAgfQoKICAgIHJldHVybiB0cnVlOwp9CgpmdW5jdGlvbiBpc0Vhckhhc2hlZChlYXIsIG1pblgsIG1pblksIGludlNpemUpIHsKICAgIHZhciBhID0gZWFyLnByZXYsCiAgICAgICAgYiA9IGVhciwKICAgICAgICBjID0gZWFyLm5leHQ7CgogICAgaWYgKGFyZWEoYSwgYiwgYykgPj0gMCkgcmV0dXJuIGZhbHNlOyAvLyByZWZsZXgsIGNhbid0IGJlIGFuIGVhcgoKICAgIC8vIHRyaWFuZ2xlIGJib3g7IG1pbiAmIG1heCBhcmUgY2FsY3VsYXRlZCBsaWtlIHRoaXMgZm9yIHNwZWVkCiAgICB2YXIgbWluVFggPSBhLnggPCBiLnggPyAoYS54IDwgYy54ID8gYS54IDogYy54KSA6IChiLnggPCBjLnggPyBiLnggOiBjLngpLAogICAgICAgIG1pblRZID0gYS55IDwgYi55ID8gKGEueSA8IGMueSA/IGEueSA6IGMueSkgOiAoYi55IDwgYy55ID8gYi55IDogYy55KSwKICAgICAgICBtYXhUWCA9IGEueCA+IGIueCA/IChhLnggPiBjLnggPyBhLnggOiBjLngpIDogKGIueCA+IGMueCA/IGIueCA6IGMueCksCiAgICAgICAgbWF4VFkgPSBhLnkgPiBiLnkgPyAoYS55ID4gYy55ID8gYS55IDogYy55KSA6IChiLnkgPiBjLnkgPyBiLnkgOiBjLnkpOwoKICAgIC8vIHotb3JkZXIgcmFuZ2UgZm9yIHRoZSBjdXJyZW50IHRyaWFuZ2xlIGJib3g7CiAgICB2YXIgbWluWiA9IHpPcmRlcihtaW5UWCwgbWluVFksIG1pblgsIG1pblksIGludlNpemUpLAogICAgICAgIG1heFogPSB6T3JkZXIobWF4VFgsIG1heFRZLCBtaW5YLCBtaW5ZLCBpbnZTaXplKTsKCiAgICB2YXIgcCA9IGVhci5wcmV2WiwKICAgICAgICBuID0gZWFyLm5leHRaOwoKICAgIC8vIGxvb2sgZm9yIHBvaW50cyBpbnNpZGUgdGhlIHRyaWFuZ2xlIGluIGJvdGggZGlyZWN0aW9ucwogICAgd2hpbGUgKHAgJiYgcC56ID49IG1pblogJiYgbiAmJiBuLnogPD0gbWF4WikgewogICAgICAgIGlmIChwICE9PSBlYXIucHJldiAmJiBwICE9PSBlYXIubmV4dCAmJgogICAgICAgICAgICBwb2ludEluVHJpYW5nbGUoYS54LCBhLnksIGIueCwgYi55LCBjLngsIGMueSwgcC54LCBwLnkpICYmCiAgICAgICAgICAgIGFyZWEocC5wcmV2LCBwLCBwLm5leHQpID49IDApIHJldHVybiBmYWxzZTsKICAgICAgICBwID0gcC5wcmV2WjsKCiAgICAgICAgaWYgKG4gIT09IGVhci5wcmV2ICYmIG4gIT09IGVhci5uZXh0ICYmCiAgICAgICAgICAgIHBvaW50SW5UcmlhbmdsZShhLngsIGEueSwgYi54LCBiLnksIGMueCwgYy55LCBuLngsIG4ueSkgJiYKICAgICAgICAgICAgYXJlYShuLnByZXYsIG4sIG4ubmV4dCkgPj0gMCkgcmV0dXJuIGZhbHNlOwogICAgICAgIG4gPSBuLm5leHRaOwogICAgfQoKICAgIC8vIGxvb2sgZm9yIHJlbWFpbmluZyBwb2ludHMgaW4gZGVjcmVhc2luZyB6LW9yZGVyCiAgICB3aGlsZSAocCAmJiBwLnogPj0gbWluWikgewogICAgICAgIGlmIChwICE9PSBlYXIucHJldiAmJiBwICE9PSBlYXIubmV4dCAmJgogICAgICAgICAgICBwb2ludEluVHJpYW5nbGUoYS54LCBhLnksIGIueCwgYi55LCBjLngsIGMueSwgcC54LCBwLnkpICYmCiAgICAgICAgICAgIGFyZWEocC5wcmV2LCBwLCBwLm5leHQpID49IDApIHJldHVybiBmYWxzZTsKICAgICAgICBwID0gcC5wcmV2WjsKICAgIH0KCiAgICAvLyBsb29rIGZvciByZW1haW5pbmcgcG9pbnRzIGluIGluY3JlYXNpbmcgei1vcmRlcgogICAgd2hpbGUgKG4gJiYgbi56IDw9IG1heFopIHsKICAgICAgICBpZiAobiAhPT0gZWFyLnByZXYgJiYgbiAhPT0gZWFyLm5leHQgJiYKICAgICAgICAgICAgcG9pbnRJblRyaWFuZ2xlKGEueCwgYS55LCBiLngsIGIueSwgYy54LCBjLnksIG4ueCwgbi55KSAmJgogICAgICAgICAgICBhcmVhKG4ucHJldiwgbiwgbi5uZXh0KSA+PSAwKSByZXR1cm4gZmFsc2U7CiAgICAgICAgbiA9IG4ubmV4dFo7CiAgICB9CgogICAgcmV0dXJuIHRydWU7Cn0KCi8vIGdvIHRocm91Z2ggYWxsIHBvbHlnb24gbm9kZXMgYW5kIGN1cmUgc21hbGwgbG9jYWwgc2VsZi1pbnRlcnNlY3Rpb25zCmZ1bmN0aW9uIGN1cmVMb2NhbEludGVyc2VjdGlvbnMoc3RhcnQsIHRyaWFuZ2xlcywgZGltKSB7CiAgICB2YXIgcCA9IHN0YXJ0OwogICAgZG8gewogICAgICAgIHZhciBhID0gcC5wcmV2LAogICAgICAgICAgICBiID0gcC5uZXh0Lm5leHQ7CgogICAgICAgIGlmICghZXF1YWxzKGEsIGIpICYmIGludGVyc2VjdHMoYSwgcCwgcC5uZXh0LCBiKSAmJiBsb2NhbGx5SW5zaWRlKGEsIGIpICYmIGxvY2FsbHlJbnNpZGUoYiwgYSkpIHsKCiAgICAgICAgICAgIHRyaWFuZ2xlcy5wdXNoKGEuaSAvIGRpbSk7CiAgICAgICAgICAgIHRyaWFuZ2xlcy5wdXNoKHAuaSAvIGRpbSk7CiAgICAgICAgICAgIHRyaWFuZ2xlcy5wdXNoKGIuaSAvIGRpbSk7CgogICAgICAgICAgICAvLyByZW1vdmUgdHdvIG5vZGVzIGludm9sdmVkCiAgICAgICAgICAgIHJlbW92ZU5vZGUocCk7CiAgICAgICAgICAgIHJlbW92ZU5vZGUocC5uZXh0KTsKCiAgICAgICAgICAgIHAgPSBzdGFydCA9IGI7CiAgICAgICAgfQogICAgICAgIHAgPSBwLm5leHQ7CiAgICB9IHdoaWxlIChwICE9PSBzdGFydCk7CgogICAgcmV0dXJuIHA7Cn0KCi8vIHRyeSBzcGxpdHRpbmcgcG9seWdvbiBpbnRvIHR3byBhbmQgdHJpYW5ndWxhdGUgdGhlbSBpbmRlcGVuZGVudGx5CmZ1bmN0aW9uIHNwbGl0RWFyY3V0KHN0YXJ0LCB0cmlhbmdsZXMsIGRpbSwgbWluWCwgbWluWSwgaW52U2l6ZSkgewogICAgLy8gbG9vayBmb3IgYSB2YWxpZCBkaWFnb25hbCB0aGF0IGRpdmlkZXMgdGhlIHBvbHlnb24gaW50byB0d28KICAgIHZhciBhID0gc3RhcnQ7CiAgICBkbyB7CiAgICAgICAgdmFyIGIgPSBhLm5leHQubmV4dDsKICAgICAgICB3aGlsZSAoYiAhPT0gYS5wcmV2KSB7CiAgICAgICAgICAgIGlmIChhLmkgIT09IGIuaSAmJiBpc1ZhbGlkRGlhZ29uYWwoYSwgYikpIHsKICAgICAgICAgICAgICAgIC8vIHNwbGl0IHRoZSBwb2x5Z29uIGluIHR3byBieSB0aGUgZGlhZ29uYWwKICAgICAgICAgICAgICAgIHZhciBjID0gc3BsaXRQb2x5Z29uKGEsIGIpOwoKICAgICAgICAgICAgICAgIC8vIGZpbHRlciBjb2xpbmVhciBwb2ludHMgYXJvdW5kIHRoZSBjdXRzCiAgICAgICAgICAgICAgICBhID0gZmlsdGVyUG9pbnRzKGEsIGEubmV4dCk7CiAgICAgICAgICAgICAgICBjID0gZmlsdGVyUG9pbnRzKGMsIGMubmV4dCk7CgogICAgICAgICAgICAgICAgLy8gcnVuIGVhcmN1dCBvbiBlYWNoIGhhbGYKICAgICAgICAgICAgICAgIGVhcmN1dExpbmtlZChhLCB0cmlhbmdsZXMsIGRpbSwgbWluWCwgbWluWSwgaW52U2l6ZSk7CiAgICAgICAgICAgICAgICBlYXJjdXRMaW5rZWQoYywgdHJpYW5nbGVzLCBkaW0sIG1pblgsIG1pblksIGludlNpemUpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGIgPSBiLm5leHQ7CiAgICAgICAgfQogICAgICAgIGEgPSBhLm5leHQ7CiAgICB9IHdoaWxlIChhICE9PSBzdGFydCk7Cn0KCi8vIGxpbmsgZXZlcnkgaG9sZSBpbnRvIHRoZSBvdXRlciBsb29wLCBwcm9kdWNpbmcgYSBzaW5nbGUtcmluZyBwb2x5Z29uIHdpdGhvdXQgaG9sZXMKZnVuY3Rpb24gZWxpbWluYXRlSG9sZXMoZGF0YSwgaG9sZUluZGljZXMsIG91dGVyTm9kZSwgZGltKSB7CiAgICB2YXIgcXVldWUgPSBbXSwKICAgICAgICBpLCBsZW4sIHN0YXJ0LCBlbmQsIGxpc3Q7CgogICAgZm9yIChpID0gMCwgbGVuID0gaG9sZUluZGljZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICBzdGFydCA9IGhvbGVJbmRpY2VzW2ldICogZGltOwogICAgICAgIGVuZCA9IGkgPCBsZW4gLSAxID8gaG9sZUluZGljZXNbaSArIDFdICogZGltIDogZGF0YS5sZW5ndGg7CiAgICAgICAgbGlzdCA9IGxpbmtlZExpc3QoZGF0YSwgc3RhcnQsIGVuZCwgZGltLCBmYWxzZSk7CiAgICAgICAgaWYgKGxpc3QgPT09IGxpc3QubmV4dCkgbGlzdC5zdGVpbmVyID0gdHJ1ZTsKICAgICAgICBxdWV1ZS5wdXNoKGdldExlZnRtb3N0KGxpc3QpKTsKICAgIH0KCiAgICBxdWV1ZS5zb3J0KGNvbXBhcmVYKTsKCiAgICAvLyBwcm9jZXNzIGhvbGVzIGZyb20gbGVmdCB0byByaWdodAogICAgZm9yIChpID0gMDsgaSA8IHF1ZXVlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZWxpbWluYXRlSG9sZShxdWV1ZVtpXSwgb3V0ZXJOb2RlKTsKICAgICAgICBvdXRlck5vZGUgPSBmaWx0ZXJQb2ludHMob3V0ZXJOb2RlLCBvdXRlck5vZGUubmV4dCk7CiAgICB9CgogICAgcmV0dXJuIG91dGVyTm9kZTsKfQoKZnVuY3Rpb24gY29tcGFyZVgoYSwgYikgewogICAgcmV0dXJuIGEueCAtIGIueDsKfQoKLy8gZmluZCBhIGJyaWRnZSBiZXR3ZWVuIHZlcnRpY2VzIHRoYXQgY29ubmVjdHMgaG9sZSB3aXRoIGFuIG91dGVyIHJpbmcgYW5kIGFuZCBsaW5rIGl0CmZ1bmN0aW9uIGVsaW1pbmF0ZUhvbGUoaG9sZSwgb3V0ZXJOb2RlKSB7CiAgICBvdXRlck5vZGUgPSBmaW5kSG9sZUJyaWRnZShob2xlLCBvdXRlck5vZGUpOwogICAgaWYgKG91dGVyTm9kZSkgewogICAgICAgIHZhciBiID0gc3BsaXRQb2x5Z29uKG91dGVyTm9kZSwgaG9sZSk7CiAgICAgICAgZmlsdGVyUG9pbnRzKGIsIGIubmV4dCk7CiAgICB9Cn0KCi8vIERhdmlkIEViZXJseSdzIGFsZ29yaXRobSBmb3IgZmluZGluZyBhIGJyaWRnZSBiZXR3ZWVuIGhvbGUgYW5kIG91dGVyIHBvbHlnb24KZnVuY3Rpb24gZmluZEhvbGVCcmlkZ2UoaG9sZSwgb3V0ZXJOb2RlKSB7CiAgICB2YXIgcCA9IG91dGVyTm9kZSwKICAgICAgICBoeCA9IGhvbGUueCwKICAgICAgICBoeSA9IGhvbGUueSwKICAgICAgICBxeCA9IC1JbmZpbml0eSwKICAgICAgICBtOwoKICAgIC8vIGZpbmQgYSBzZWdtZW50IGludGVyc2VjdGVkIGJ5IGEgcmF5IGZyb20gdGhlIGhvbGUncyBsZWZ0bW9zdCBwb2ludCB0byB0aGUgbGVmdDsKICAgIC8vIHNlZ21lbnQncyBlbmRwb2ludCB3aXRoIGxlc3NlciB4IHdpbGwgYmUgcG90ZW50aWFsIGNvbm5lY3Rpb24gcG9pbnQKICAgIGRvIHsKICAgICAgICBpZiAoaHkgPD0gcC55ICYmIGh5ID49IHAubmV4dC55ICYmIHAubmV4dC55ICE9PSBwLnkpIHsKICAgICAgICAgICAgdmFyIHggPSBwLnggKyAoaHkgLSBwLnkpICogKHAubmV4dC54IC0gcC54KSAvIChwLm5leHQueSAtIHAueSk7CiAgICAgICAgICAgIGlmICh4IDw9IGh4ICYmIHggPiBxeCkgewogICAgICAgICAgICAgICAgcXggPSB4OwogICAgICAgICAgICAgICAgaWYgKHggPT09IGh4KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGh5ID09PSBwLnkpIHJldHVybiBwOwogICAgICAgICAgICAgICAgICAgIGlmIChoeSA9PT0gcC5uZXh0LnkpIHJldHVybiBwLm5leHQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBtID0gcC54IDwgcC5uZXh0LnggPyBwIDogcC5uZXh0OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHAgPSBwLm5leHQ7CiAgICB9IHdoaWxlIChwICE9PSBvdXRlck5vZGUpOwoKICAgIGlmICghbSkgcmV0dXJuIG51bGw7CgogICAgaWYgKGh4ID09PSBxeCkgcmV0dXJuIG0ucHJldjsgLy8gaG9sZSB0b3VjaGVzIG91dGVyIHNlZ21lbnQ7IHBpY2sgbG93ZXIgZW5kcG9pbnQKCiAgICAvLyBsb29rIGZvciBwb2ludHMgaW5zaWRlIHRoZSB0cmlhbmdsZSBvZiBob2xlIHBvaW50LCBzZWdtZW50IGludGVyc2VjdGlvbiBhbmQgZW5kcG9pbnQ7CiAgICAvLyBpZiB0aGVyZSBhcmUgbm8gcG9pbnRzIGZvdW5kLCB3ZSBoYXZlIGEgdmFsaWQgY29ubmVjdGlvbjsKICAgIC8vIG90aGVyd2lzZSBjaG9vc2UgdGhlIHBvaW50IG9mIHRoZSBtaW5pbXVtIGFuZ2xlIHdpdGggdGhlIHJheSBhcyBjb25uZWN0aW9uIHBvaW50CgogICAgdmFyIHN0b3AgPSBtLAogICAgICAgIG14ID0gbS54LAogICAgICAgIG15ID0gbS55LAogICAgICAgIHRhbk1pbiA9IEluZmluaXR5LAogICAgICAgIHRhbjsKCiAgICBwID0gbS5uZXh0OwoKICAgIHdoaWxlIChwICE9PSBzdG9wKSB7CiAgICAgICAgaWYgKGh4ID49IHAueCAmJiBwLnggPj0gbXggJiYgaHggIT09IHAueCAmJgogICAgICAgICAgICAgICAgcG9pbnRJblRyaWFuZ2xlKGh5IDwgbXkgPyBoeCA6IHF4LCBoeSwgbXgsIG15LCBoeSA8IG15ID8gcXggOiBoeCwgaHksIHAueCwgcC55KSkgewoKICAgICAgICAgICAgdGFuID0gTWF0aC5hYnMoaHkgLSBwLnkpIC8gKGh4IC0gcC54KTsgLy8gdGFuZ2VudGlhbAoKICAgICAgICAgICAgaWYgKCh0YW4gPCB0YW5NaW4gfHwgKHRhbiA9PT0gdGFuTWluICYmIHAueCA+IG0ueCkpICYmIGxvY2FsbHlJbnNpZGUocCwgaG9sZSkpIHsKICAgICAgICAgICAgICAgIG0gPSBwOwogICAgICAgICAgICAgICAgdGFuTWluID0gdGFuOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwID0gcC5uZXh0OwogICAgfQoKICAgIHJldHVybiBtOwp9CgovLyBpbnRlcmxpbmsgcG9seWdvbiBub2RlcyBpbiB6LW9yZGVyCmZ1bmN0aW9uIGluZGV4Q3VydmUoc3RhcnQsIG1pblgsIG1pblksIGludlNpemUpIHsKICAgIHZhciBwID0gc3RhcnQ7CiAgICBkbyB7CiAgICAgICAgaWYgKHAueiA9PT0gbnVsbCkgcC56ID0gek9yZGVyKHAueCwgcC55LCBtaW5YLCBtaW5ZLCBpbnZTaXplKTsKICAgICAgICBwLnByZXZaID0gcC5wcmV2OwogICAgICAgIHAubmV4dFogPSBwLm5leHQ7CiAgICAgICAgcCA9IHAubmV4dDsKICAgIH0gd2hpbGUgKHAgIT09IHN0YXJ0KTsKCiAgICBwLnByZXZaLm5leHRaID0gbnVsbDsKICAgIHAucHJldlogPSBudWxsOwoKICAgIHNvcnRMaW5rZWQocCk7Cn0KCi8vIFNpbW9uIFRhdGhhbSdzIGxpbmtlZCBsaXN0IG1lcmdlIHNvcnQgYWxnb3JpdGhtCi8vIGh0dHA6Ly93d3cuY2hpYXJrLmdyZWVuZW5kLm9yZy51ay9+c2d0YXRoYW0vYWxnb3JpdGhtcy9saXN0c29ydC5odG1sCmZ1bmN0aW9uIHNvcnRMaW5rZWQobGlzdCkgewogICAgdmFyIGksIHAsIHEsIGUsIHRhaWwsIG51bU1lcmdlcywgcFNpemUsIHFTaXplLAogICAgICAgIGluU2l6ZSA9IDE7CgogICAgZG8gewogICAgICAgIHAgPSBsaXN0OwogICAgICAgIGxpc3QgPSBudWxsOwogICAgICAgIHRhaWwgPSBudWxsOwogICAgICAgIG51bU1lcmdlcyA9IDA7CgogICAgICAgIHdoaWxlIChwKSB7CiAgICAgICAgICAgIG51bU1lcmdlcysrOwogICAgICAgICAgICBxID0gcDsKICAgICAgICAgICAgcFNpemUgPSAwOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaW5TaXplOyBpKyspIHsKICAgICAgICAgICAgICAgIHBTaXplKys7CiAgICAgICAgICAgICAgICBxID0gcS5uZXh0WjsKICAgICAgICAgICAgICAgIGlmICghcSkgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcVNpemUgPSBpblNpemU7CgogICAgICAgICAgICB3aGlsZSAocFNpemUgPiAwIHx8IChxU2l6ZSA+IDAgJiYgcSkpIHsKCiAgICAgICAgICAgICAgICBpZiAocFNpemUgIT09IDAgJiYgKHFTaXplID09PSAwIHx8ICFxIHx8IHAueiA8PSBxLnopKSB7CiAgICAgICAgICAgICAgICAgICAgZSA9IHA7CiAgICAgICAgICAgICAgICAgICAgcCA9IHAubmV4dFo7CiAgICAgICAgICAgICAgICAgICAgcFNpemUtLTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZSA9IHE7CiAgICAgICAgICAgICAgICAgICAgcSA9IHEubmV4dFo7CiAgICAgICAgICAgICAgICAgICAgcVNpemUtLTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodGFpbCkgdGFpbC5uZXh0WiA9IGU7CiAgICAgICAgICAgICAgICBlbHNlIGxpc3QgPSBlOwoKICAgICAgICAgICAgICAgIGUucHJldlogPSB0YWlsOwogICAgICAgICAgICAgICAgdGFpbCA9IGU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHAgPSBxOwogICAgICAgIH0KCiAgICAgICAgdGFpbC5uZXh0WiA9IG51bGw7CiAgICAgICAgaW5TaXplICo9IDI7CgogICAgfSB3aGlsZSAobnVtTWVyZ2VzID4gMSk7CgogICAgcmV0dXJuIGxpc3Q7Cn0KCi8vIHotb3JkZXIgb2YgYSBwb2ludCBnaXZlbiBjb29yZHMgYW5kIGludmVyc2Ugb2YgdGhlIGxvbmdlciBzaWRlIG9mIGRhdGEgYmJveApmdW5jdGlvbiB6T3JkZXIoeCwgeSwgbWluWCwgbWluWSwgaW52U2l6ZSkgewogICAgLy8gY29vcmRzIGFyZSB0cmFuc2Zvcm1lZCBpbnRvIG5vbi1uZWdhdGl2ZSAxNS1iaXQgaW50ZWdlciByYW5nZQogICAgeCA9IDMyNzY3ICogKHggLSBtaW5YKSAqIGludlNpemU7CiAgICB5ID0gMzI3NjcgKiAoeSAtIG1pblkpICogaW52U2l6ZTsKCiAgICB4ID0gKHggfCAoeCA8PCA4KSkgJiAweDAwRkYwMEZGOwogICAgeCA9ICh4IHwgKHggPDwgNCkpICYgMHgwRjBGMEYwRjsKICAgIHggPSAoeCB8ICh4IDw8IDIpKSAmIDB4MzMzMzMzMzM7CiAgICB4ID0gKHggfCAoeCA8PCAxKSkgJiAweDU1NTU1NTU1OwoKICAgIHkgPSAoeSB8ICh5IDw8IDgpKSAmIDB4MDBGRjAwRkY7CiAgICB5ID0gKHkgfCAoeSA8PCA0KSkgJiAweDBGMEYwRjBGOwogICAgeSA9ICh5IHwgKHkgPDwgMikpICYgMHgzMzMzMzMzMzsKICAgIHkgPSAoeSB8ICh5IDw8IDEpKSAmIDB4NTU1NTU1NTU7CgogICAgcmV0dXJuIHggfCAoeSA8PCAxKTsKfQoKLy8gZmluZCB0aGUgbGVmdG1vc3Qgbm9kZSBvZiBhIHBvbHlnb24gcmluZwpmdW5jdGlvbiBnZXRMZWZ0bW9zdChzdGFydCkgewogICAgdmFyIHAgPSBzdGFydCwKICAgICAgICBsZWZ0bW9zdCA9IHN0YXJ0OwogICAgZG8gewogICAgICAgIGlmIChwLnggPCBsZWZ0bW9zdC54KSBsZWZ0bW9zdCA9IHA7CiAgICAgICAgcCA9IHAubmV4dDsKICAgIH0gd2hpbGUgKHAgIT09IHN0YXJ0KTsKCiAgICByZXR1cm4gbGVmdG1vc3Q7Cn0KCi8vIGNoZWNrIGlmIGEgcG9pbnQgbGllcyB3aXRoaW4gYSBjb252ZXggdHJpYW5nbGUKZnVuY3Rpb24gcG9pbnRJblRyaWFuZ2xlKGF4LCBheSwgYngsIGJ5LCBjeCwgY3ksIHB4LCBweSkgewogICAgcmV0dXJuIChjeCAtIHB4KSAqIChheSAtIHB5KSAtIChheCAtIHB4KSAqIChjeSAtIHB5KSA+PSAwICYmCiAgICAgICAgICAgKGF4IC0gcHgpICogKGJ5IC0gcHkpIC0gKGJ4IC0gcHgpICogKGF5IC0gcHkpID49IDAgJiYKICAgICAgICAgICAoYnggLSBweCkgKiAoY3kgLSBweSkgLSAoY3ggLSBweCkgKiAoYnkgLSBweSkgPj0gMDsKfQoKLy8gY2hlY2sgaWYgYSBkaWFnb25hbCBiZXR3ZWVuIHR3byBwb2x5Z29uIG5vZGVzIGlzIHZhbGlkIChsaWVzIGluIHBvbHlnb24gaW50ZXJpb3IpCmZ1bmN0aW9uIGlzVmFsaWREaWFnb25hbChhLCBiKSB7CiAgICByZXR1cm4gYS5uZXh0LmkgIT09IGIuaSAmJiBhLnByZXYuaSAhPT0gYi5pICYmICFpbnRlcnNlY3RzUG9seWdvbihhLCBiKSAmJgogICAgICAgICAgIGxvY2FsbHlJbnNpZGUoYSwgYikgJiYgbG9jYWxseUluc2lkZShiLCBhKSAmJiBtaWRkbGVJbnNpZGUoYSwgYik7Cn0KCi8vIHNpZ25lZCBhcmVhIG9mIGEgdHJpYW5nbGUKZnVuY3Rpb24gYXJlYShwLCBxLCByKSB7CiAgICByZXR1cm4gKHEueSAtIHAueSkgKiAoci54IC0gcS54KSAtIChxLnggLSBwLngpICogKHIueSAtIHEueSk7Cn0KCi8vIGNoZWNrIGlmIHR3byBwb2ludHMgYXJlIGVxdWFsCmZ1bmN0aW9uIGVxdWFscyhwMSwgcDIpIHsKICAgIHJldHVybiBwMS54ID09PSBwMi54ICYmIHAxLnkgPT09IHAyLnk7Cn0KCi8vIGNoZWNrIGlmIHR3byBzZWdtZW50cyBpbnRlcnNlY3QKZnVuY3Rpb24gaW50ZXJzZWN0cyhwMSwgcTEsIHAyLCBxMikgewogICAgaWYgKChlcXVhbHMocDEsIHExKSAmJiBlcXVhbHMocDIsIHEyKSkgfHwKICAgICAgICAoZXF1YWxzKHAxLCBxMikgJiYgZXF1YWxzKHAyLCBxMSkpKSByZXR1cm4gdHJ1ZTsKICAgIHJldHVybiBhcmVhKHAxLCBxMSwgcDIpID4gMCAhPT0gYXJlYShwMSwgcTEsIHEyKSA+IDAgJiYKICAgICAgICAgICBhcmVhKHAyLCBxMiwgcDEpID4gMCAhPT0gYXJlYShwMiwgcTIsIHExKSA+IDA7Cn0KCi8vIGNoZWNrIGlmIGEgcG9seWdvbiBkaWFnb25hbCBpbnRlcnNlY3RzIGFueSBwb2x5Z29uIHNlZ21lbnRzCmZ1bmN0aW9uIGludGVyc2VjdHNQb2x5Z29uKGEsIGIpIHsKICAgIHZhciBwID0gYTsKICAgIGRvIHsKICAgICAgICBpZiAocC5pICE9PSBhLmkgJiYgcC5uZXh0LmkgIT09IGEuaSAmJiBwLmkgIT09IGIuaSAmJiBwLm5leHQuaSAhPT0gYi5pICYmCiAgICAgICAgICAgICAgICBpbnRlcnNlY3RzKHAsIHAubmV4dCwgYSwgYikpIHJldHVybiB0cnVlOwogICAgICAgIHAgPSBwLm5leHQ7CiAgICB9IHdoaWxlIChwICE9PSBhKTsKCiAgICByZXR1cm4gZmFsc2U7Cn0KCi8vIGNoZWNrIGlmIGEgcG9seWdvbiBkaWFnb25hbCBpcyBsb2NhbGx5IGluc2lkZSB0aGUgcG9seWdvbgpmdW5jdGlvbiBsb2NhbGx5SW5zaWRlKGEsIGIpIHsKICAgIHJldHVybiBhcmVhKGEucHJldiwgYSwgYS5uZXh0KSA8IDAgPwogICAgICAgIGFyZWEoYSwgYiwgYS5uZXh0KSA+PSAwICYmIGFyZWEoYSwgYS5wcmV2LCBiKSA+PSAwIDoKICAgICAgICBhcmVhKGEsIGIsIGEucHJldikgPCAwIHx8IGFyZWEoYSwgYS5uZXh0LCBiKSA8IDA7Cn0KCi8vIGNoZWNrIGlmIHRoZSBtaWRkbGUgcG9pbnQgb2YgYSBwb2x5Z29uIGRpYWdvbmFsIGlzIGluc2lkZSB0aGUgcG9seWdvbgpmdW5jdGlvbiBtaWRkbGVJbnNpZGUoYSwgYikgewogICAgdmFyIHAgPSBhLAogICAgICAgIGluc2lkZSA9IGZhbHNlLAogICAgICAgIHB4ID0gKGEueCArIGIueCkgLyAyLAogICAgICAgIHB5ID0gKGEueSArIGIueSkgLyAyOwogICAgZG8gewogICAgICAgIGlmICgoKHAueSA+IHB5KSAhPT0gKHAubmV4dC55ID4gcHkpKSAmJiBwLm5leHQueSAhPT0gcC55ICYmCiAgICAgICAgICAgICAgICAocHggPCAocC5uZXh0LnggLSBwLngpICogKHB5IC0gcC55KSAvIChwLm5leHQueSAtIHAueSkgKyBwLngpKQogICAgICAgICAgICBpbnNpZGUgPSAhaW5zaWRlOwogICAgICAgIHAgPSBwLm5leHQ7CiAgICB9IHdoaWxlIChwICE9PSBhKTsKCiAgICByZXR1cm4gaW5zaWRlOwp9CgovLyBsaW5rIHR3byBwb2x5Z29uIHZlcnRpY2VzIHdpdGggYSBicmlkZ2U7IGlmIHRoZSB2ZXJ0aWNlcyBiZWxvbmcgdG8gdGhlIHNhbWUgcmluZywgaXQgc3BsaXRzIHBvbHlnb24gaW50byB0d287Ci8vIGlmIG9uZSBiZWxvbmdzIHRvIHRoZSBvdXRlciByaW5nIGFuZCBhbm90aGVyIHRvIGEgaG9sZSwgaXQgbWVyZ2VzIGl0IGludG8gYSBzaW5nbGUgcmluZwpmdW5jdGlvbiBzcGxpdFBvbHlnb24oYSwgYikgewogICAgdmFyIGEyID0gbmV3IE5vZGUoYS5pLCBhLngsIGEueSksCiAgICAgICAgYjIgPSBuZXcgTm9kZShiLmksIGIueCwgYi55KSwKICAgICAgICBhbiA9IGEubmV4dCwKICAgICAgICBicCA9IGIucHJldjsKCiAgICBhLm5leHQgPSBiOwogICAgYi5wcmV2ID0gYTsKCiAgICBhMi5uZXh0ID0gYW47CiAgICBhbi5wcmV2ID0gYTI7CgogICAgYjIubmV4dCA9IGEyOwogICAgYTIucHJldiA9IGIyOwoKICAgIGJwLm5leHQgPSBiMjsKICAgIGIyLnByZXYgPSBicDsKCiAgICByZXR1cm4gYjI7Cn0KCi8vIGNyZWF0ZSBhIG5vZGUgYW5kIG9wdGlvbmFsbHkgbGluayBpdCB3aXRoIHByZXZpb3VzIG9uZSAoaW4gYSBjaXJjdWxhciBkb3VibHkgbGlua2VkIGxpc3QpCmZ1bmN0aW9uIGluc2VydE5vZGUoaSwgeCwgeSwgbGFzdCkgewogICAgdmFyIHAgPSBuZXcgTm9kZShpLCB4LCB5KTsKCiAgICBpZiAoIWxhc3QpIHsKICAgICAgICBwLnByZXYgPSBwOwogICAgICAgIHAubmV4dCA9IHA7CgogICAgfSBlbHNlIHsKICAgICAgICBwLm5leHQgPSBsYXN0Lm5leHQ7CiAgICAgICAgcC5wcmV2ID0gbGFzdDsKICAgICAgICBsYXN0Lm5leHQucHJldiA9IHA7CiAgICAgICAgbGFzdC5uZXh0ID0gcDsKICAgIH0KICAgIHJldHVybiBwOwp9CgpmdW5jdGlvbiByZW1vdmVOb2RlKHApIHsKICAgIHAubmV4dC5wcmV2ID0gcC5wcmV2OwogICAgcC5wcmV2Lm5leHQgPSBwLm5leHQ7CgogICAgaWYgKHAucHJldlopIHAucHJldloubmV4dFogPSBwLm5leHRaOwogICAgaWYgKHAubmV4dFopIHAubmV4dFoucHJldlogPSBwLnByZXZaOwp9CgpmdW5jdGlvbiBOb2RlKGksIHgsIHkpIHsKICAgIC8vIHZlcnRpY2UgaW5kZXggaW4gY29vcmRpbmF0ZXMgYXJyYXkKICAgIHRoaXMuaSA9IGk7CgogICAgLy8gdmVydGV4IGNvb3JkaW5hdGVzCiAgICB0aGlzLnggPSB4OwogICAgdGhpcy55ID0geTsKCiAgICAvLyBwcmV2aW91cyBhbmQgbmV4dCB2ZXJ0aWNlIG5vZGVzIGluIGEgcG9seWdvbiByaW5nCiAgICB0aGlzLnByZXYgPSBudWxsOwogICAgdGhpcy5uZXh0ID0gbnVsbDsKCiAgICAvLyB6LW9yZGVyIGN1cnZlIHZhbHVlCiAgICB0aGlzLnogPSBudWxsOwoKICAgIC8vIHByZXZpb3VzIGFuZCBuZXh0IG5vZGVzIGluIHotb3JkZXIKICAgIHRoaXMucHJldlogPSBudWxsOwogICAgdGhpcy5uZXh0WiA9IG51bGw7CgogICAgLy8gaW5kaWNhdGVzIHdoZXRoZXIgdGhpcyBpcyBhIHN0ZWluZXIgcG9pbnQKICAgIHRoaXMuc3RlaW5lciA9IGZhbHNlOwp9CgovLyByZXR1cm4gYSBwZXJjZW50YWdlIGRpZmZlcmVuY2UgYmV0d2VlbiB0aGUgcG9seWdvbiBhcmVhIGFuZCBpdHMgdHJpYW5ndWxhdGlvbiBhcmVhOwovLyB1c2VkIHRvIHZlcmlmeSBjb3JyZWN0bmVzcyBvZiB0cmlhbmd1bGF0aW9uCmVhcmN1dC5kZXZpYXRpb24gPSBmdW5jdGlvbiAoZGF0YSwgaG9sZUluZGljZXMsIGRpbSwgdHJpYW5nbGVzKSB7CiAgICB2YXIgaGFzSG9sZXMgPSBob2xlSW5kaWNlcyAmJiBob2xlSW5kaWNlcy5sZW5ndGg7CiAgICB2YXIgb3V0ZXJMZW4gPSBoYXNIb2xlcyA/IGhvbGVJbmRpY2VzWzBdICogZGltIDogZGF0YS5sZW5ndGg7CgogICAgdmFyIHBvbHlnb25BcmVhID0gTWF0aC5hYnMoc2lnbmVkQXJlYShkYXRhLCAwLCBvdXRlckxlbiwgZGltKSk7CiAgICBpZiAoaGFzSG9sZXMpIHsKICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gaG9sZUluZGljZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgdmFyIHN0YXJ0ID0gaG9sZUluZGljZXNbaV0gKiBkaW07CiAgICAgICAgICAgIHZhciBlbmQgPSBpIDwgbGVuIC0gMSA/IGhvbGVJbmRpY2VzW2kgKyAxXSAqIGRpbSA6IGRhdGEubGVuZ3RoOwogICAgICAgICAgICBwb2x5Z29uQXJlYSAtPSBNYXRoLmFicyhzaWduZWRBcmVhKGRhdGEsIHN0YXJ0LCBlbmQsIGRpbSkpOwogICAgICAgIH0KICAgIH0KCiAgICB2YXIgdHJpYW5nbGVzQXJlYSA9IDA7CiAgICBmb3IgKGkgPSAwOyBpIDwgdHJpYW5nbGVzLmxlbmd0aDsgaSArPSAzKSB7CiAgICAgICAgdmFyIGEgPSB0cmlhbmdsZXNbaV0gKiBkaW07CiAgICAgICAgdmFyIGIgPSB0cmlhbmdsZXNbaSArIDFdICogZGltOwogICAgICAgIHZhciBjID0gdHJpYW5nbGVzW2kgKyAyXSAqIGRpbTsKICAgICAgICB0cmlhbmdsZXNBcmVhICs9IE1hdGguYWJzKAogICAgICAgICAgICAoZGF0YVthXSAtIGRhdGFbY10pICogKGRhdGFbYiArIDFdIC0gZGF0YVthICsgMV0pIC0KICAgICAgICAgICAgKGRhdGFbYV0gLSBkYXRhW2JdKSAqIChkYXRhW2MgKyAxXSAtIGRhdGFbYSArIDFdKSk7CiAgICB9CgogICAgcmV0dXJuIHBvbHlnb25BcmVhID09PSAwICYmIHRyaWFuZ2xlc0FyZWEgPT09IDAgPyAwIDoKICAgICAgICBNYXRoLmFicygodHJpYW5nbGVzQXJlYSAtIHBvbHlnb25BcmVhKSAvIHBvbHlnb25BcmVhKTsKfTsKCmZ1bmN0aW9uIHNpZ25lZEFyZWEoZGF0YSwgc3RhcnQsIGVuZCwgZGltKSB7CiAgICB2YXIgc3VtID0gMDsKICAgIGZvciAodmFyIGkgPSBzdGFydCwgaiA9IGVuZCAtIGRpbTsgaSA8IGVuZDsgaSArPSBkaW0pIHsKICAgICAgICBzdW0gKz0gKGRhdGFbal0gLSBkYXRhW2ldKSAqIChkYXRhW2kgKyAxXSArIGRhdGFbaiArIDFdKTsKICAgICAgICBqID0gaTsKICAgIH0KICAgIHJldHVybiBzdW07Cn0KCi8vIHR1cm4gYSBwb2x5Z29uIGluIGEgbXVsdGktZGltZW5zaW9uYWwgYXJyYXkgZm9ybSAoZS5nLiBhcyBpbiBHZW9KU09OKSBpbnRvIGEgZm9ybSBFYXJjdXQgYWNjZXB0cwplYXJjdXQuZmxhdHRlbiA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICB2YXIgZGltID0gZGF0YVswXVswXS5sZW5ndGgsCiAgICAgICAgcmVzdWx0ID0ge3ZlcnRpY2VzOiBbXSwgaG9sZXM6IFtdLCBkaW1lbnNpb25zOiBkaW19LAogICAgICAgIGhvbGVJbmRleCA9IDA7CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGZvciAodmFyIGQgPSAwOyBkIDwgZGltOyBkKyspIHJlc3VsdC52ZXJ0aWNlcy5wdXNoKGRhdGFbaV1bal1bZF0pOwogICAgICAgIH0KICAgICAgICBpZiAoaSA+IDApIHsKICAgICAgICAgICAgaG9sZUluZGV4ICs9IGRhdGFbaSAtIDFdLmxlbmd0aDsKICAgICAgICAgICAgcmVzdWx0LmhvbGVzLnB1c2goaG9sZUluZGV4KTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0Owp9Owp9KTthZGRNb2R1bGUoJy4vY29kZWNhYl90cmFjZXInLCBmdW5jdGlvbihyZXF1aXJlLCBtb2R1bGUsIGV4cG9ydHMpeyJ1c2Ugc3RyaWN0IjsNCmxldCBlYXJjdXQgPSByZXF1aXJlKCdlYXJjdXQnKTsNCg0KDQovKg0KIENvcHlyaWdodCAoYykgMjAxNSwgS3JpamdzbWFuIEF1dG9tYXRpc2VyaW5nDQogd3d3LmNvZGVjYWIuY29tDQoNCiBQZXJtaXNzaW9uIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBhbmQvb3IgZGlzdHJpYnV0ZSB0aGlzIHNvZnR3YXJlIGZvciBhbnkgcHVycG9zZQ0KIHdpdGggb3Igd2l0aG91dCBmZWUgaXMgaGVyZWJ5IGdyYW50ZWQsIHByb3ZpZGVkIHRoYXQgdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UNCiBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBhcHBlYXIgaW4gYWxsIGNvcGllcy4NCg0KIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiIEFORCBUSEUgQVVUSE9SIERJU0NMQUlNUyBBTEwgV0FSUkFOVElFUyBXSVRIDQogUkVHQVJEIFRPIFRISVMgU09GVFdBUkUgSU5DTFVESU5HIEFMTCBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORA0KIEZJVE5FU1MuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1IgQkUgTElBQkxFIEZPUiBBTlkgU1BFQ0lBTCwgRElSRUNULA0KIElORElSRUNULCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgT1IgQU5ZIERBTUFHRVMgV0hBVFNPRVZFUiBSRVNVTFRJTkcgRlJPTSBMT1NTDQogT0YgVVNFLCBEQVRBIE9SIFBST0ZJVFMsIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBORUdMSUdFTkNFIE9SIE9USEVSDQogVE9SVElPVVMgQUNUSU9OLCBBUklTSU5HIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFVTRSBPUiBQRVJGT1JNQU5DRSBPRg0KIFRISVMgU09GVFdBUkUuDQogKi8NCg0KdmFyIFNUQVJUID0gMjU1Ow0KdmFyIFRSQUNFRCA9IDI1NDsNCnZhciBJR05PUkVEID0gMjUzOw0KdmFyIElOVEVSU0VDVElPTiA9IDB4MDg7DQovLw0KLy8gICstLS0rLS0tKy0tLSsNCi8vICB8IDEgfCAwIHwgNyB8DQovLyAgKy0tLSstLS0rLS0tKw0KLy8gIHwgMiB8IFAgfCA2IHwNCi8vICArLS0tKy0tLSstLS0rDQovLyAgfCAzIHwgNCB8IDUgfA0KLy8gICstLS0rLS0tKy0tLSsNCnZhciBESVJTID0gW1swLCAtMV0sIFstMSwgLTFdLCBbLTEsIDBdLCBbLTEsIDFdLCBbMCwgMV0sIFsxLCAxXSwgWzEsIDBdLCBbMSwgLTFdXTsNCg0KbW9kdWxlLmV4cG9ydHMudHJhY2VBbmRDb252ZXhpZnkgPSB0cmFjZUFuZENvbnZleGlmeSA7DQpmdW5jdGlvbiB0cmFjZUFuZENvbnZleGlmeShpbWdEYXRhKSB7DQogICAgaW1nRGF0YS5kYXRhID0gY3JlYXRlTWFzayhpbWdEYXRhKTsNCiAgICB2YXIgcG9seXM7DQogICAgLy9URVNUDQogICAgc2hvd1RyYWNlZEltYWdlKGltZ0RhdGEsIHBvbHlzLCA1KTsNCiAgICB2YXIgczsNCiAgICBzID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7DQogICAgLy9fVEVTVA0KDQogICAgYXZvaWRTaW5nbGVQaXhlbHMoaW1nRGF0YSk7DQoNCiAgICAvL1RFU1QNCiAgICBpZiAodHlwZW9mIGRvY3VtZW50ICE9PSAndW5kZWZpbmVkJykgY29uc29sZS5sb2coJ2F2b2lkU2luZ2xlUGl4ZWxzIHRvb2sgJyArIChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHMpICsgJyBtc2VjJyk7DQogICAgc2hvd1RyYWNlZEltYWdlKGltZ0RhdGEsIHBvbHlzLCA1KTsNCiAgICBzID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7DQogICAgLy9fVEVTVA0KDQogICAgdmFyIHBvbHlzID0gdHJhY2VJbWFnZShpbWdEYXRhKTsNCg0KICAgIC8vVEVTVA0KICAgIGlmICh0eXBlb2YgZG9jdW1lbnQgIT09ICd1bmRlZmluZWQnKSBjb25zb2xlLmxvZygndHJhY2VJbWFnZSB0b29rICcgKyAobmV3IERhdGUoKS5nZXRUaW1lKCkgLSBzKSArICcgbXNlYycpOw0KICAgIHNob3dUcmFjZWRJbWFnZShpbWdEYXRhLCBwb2x5cywgNSk7DQogICAgcyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOw0KICAgIC8vX1RFU1QNCg0KICAgIHBvbHlzID0gc2ltcGxpZnkoaW1nRGF0YSwgcG9seXMpOw0KDQogICAgLy9URVNUDQogICAgaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcpIGNvbnNvbGUubG9nKCdzaW1wbGlmeSB0b29rICcgKyAobmV3IERhdGUoKS5nZXRUaW1lKCkgLSBzKSArICcgbXNlYycpOw0KICAgIHNob3dTaW1wbGlmaWVkKGltZ0RhdGEsIHBvbHlzLCA0KTsNCiAgICBzID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7DQogICAgLy9fVEVTVA0KDQogICAgcG9seXMgPSB0cmlhbmd1bGF0ZShwb2x5cyk7DQoNCiAgICAvL1RFU1QNCiAgICBpZiAodHlwZW9mIGRvY3VtZW50ICE9PSAndW5kZWZpbmVkJykgY29uc29sZS5sb2coJ3RyaWFuZ3VsYXRlIHRvb2sgJyArIChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHMpICsgJyBtc2VjJyk7DQogICAgc2hvd1ZlcnRpY2VzKHBvbHlzLCBpbWdEYXRhLncsIGltZ0RhdGEuaCwgNCk7DQogICAgcyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOw0KICAgIC8vX1RFU1QNCg0KICAgIHZhciBzaGFwZXMgPSB0cmlhbmdsZXNUb0NvbnZleChwb2x5cyk7DQogICAgLy9URVNUDQogICAgaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcpIGNvbnNvbGUubG9nKCd0cmlhbmdsZXNUb0NvbnZleCB0b29rICcgKyAobmV3IERhdGUoKS5nZXRUaW1lKCkgLSBzKSArICcgbXNlYycpOw0KICAgIHNob3dDb252ZXgoc2hhcGVzLCBpbWdEYXRhLncsIGltZ0RhdGEuaCwgNCk7DQogICAgcyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOw0KICAgIC8vX1RFU1QNCg0KICAgIHJldHVybiBbY29udmV4VG9BcnJheShzaGFwZXMsIC1pbWdEYXRhLm1hcmdpbiAtIDAuNSldOw0KfQ0KDQpmdW5jdGlvbiBoZXgycmdiKGhleCkgew0KICAgIHJldHVybiBbKGhleCA+PiAxNiAmIDB4ZmYpIC8gMjU1LCAoIGhleCA+PiA4ICYgMHhmZikgLyAyNTUsIChoZXggJiAweGZmKSAvIDI1NV07DQp9DQoNCi8vIENyZWF0ZSBhIG1hc2sNCm1vZHVsZS5leHBvcnRzLmNyZWF0ZU1hc2sgPSBjcmVhdGVNYXNrOw0KZnVuY3Rpb24gY3JlYXRlTWFzayhpbWdEYXRhKSB7DQogICAgdmFyIHcgPSBpbWdEYXRhLncsDQogICAgICAgIGggPSBpbWdEYXRhLmgsDQogICAgICAgIGRhdGEgPSBpbWdEYXRhLmRhdGEsDQogICAgICAgIC8vIFJldXNlIGRhdGEgYnVmZmVyIHRvIGF2b2lkIGV4dHJhIG1lbW9yeSBhbGxvY2F0aW9uDQogICAgICAgIC8vIFNldHRpbmcgbWFzayB2YWx1ZSByZXBsYWNlcyB0aGUgb3JpZ2luYWwgaW1hZ2UgcGl4ZWwgd2hpY2ggd2UgZG9uJ3QgbmVlZA0KICAgICAgICAvLyBhbnltb3JlDQogICAgICAgIG1hc2sgPSBuZXcgVWludDMyQXJyYXkoZGF0YS5idWZmZXIpLA0KICAgICAgICBpOw0KICAgIGlmICh0eXBlb2YgaW1nRGF0YS5iYWNrZ3JvdW5kQ29sb3IgPT09ICdudW1iZXInKSB7DQogICAgICAgIHZhciBhbHBoYSA9IGltZ0RhdGEuYmFja2dyb3VuZENvbG9yICogMjU2Ow0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdyAqIGg7IGkgKz0gMSkgew0KICAgICAgICAgICAgbWFza1tpXSA9IGRhdGFbaSAqIDQgKyAzXSA+IGFscGhhID8gMSA6IDA7DQogICAgICAgIH0NCiAgICB9IGVsc2Ugew0KICAgICAgICB2YXIgYyA9IGhleDJyZ2IoaW1nRGF0YS5iYWNrZ3JvdW5kQ29sb3IpOw0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdyAqIGg7IGkgKz0gMSkgew0KICAgICAgICAgICAgaWYgKGRhdGFbaSAqIDRdID09PSBjWzBdICYmDQogICAgICAgICAgICAgICAgZGF0YVtpICogNCArIDFdID09PSBjWzFdICYmDQogICAgICAgICAgICAgICAgZGF0YVtpICogNCArIDJdID09PSBjWzJdKSB7DQogICAgICAgICAgICAgICAgbWFza1tpXSA9IDE7DQogICAgICAgICAgICB9IGVsc2UgbWFza1tpXSA9IDA7IC8vIGF1dG8gc2V0IGJ5IFVpbnQ4QXJyYXkgYnV0IGp1c3QgdG8gYmUgc3VyZQ0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBtYXNrOw0KfQ0KDQovLyBUcmFjZSByb3V0aW5lIHdvbid0IHdvcmsgb24gc29tZSBzaW5nbGUgcGl4ZWwgcGF0dGVybnMuDQovLyBUaGlzIGZ1bmN0aW9uIHdpbGwgYXZvaWQgdGhlbSBieSBhZGRpbmcgYW4gZXh0cmEgcGl4ZWwuDQptb2R1bGUuZXhwb3J0cy5hdm9pZFNpbmdsZVBpeGVscyA9IGF2b2lkU2luZ2xlUGl4ZWxzOw0KZnVuY3Rpb24gYXZvaWRTaW5nbGVQaXhlbHMoaW1nRGF0YSkgew0KICAgIHZhciByZXNldCA9IFtdOw0KICAgIHZhciBpLA0KICAgICAgICB3ID0gaW1nRGF0YS53LA0KICAgICAgICBoID0gaW1nRGF0YS5oLA0KICAgICAgICBsdGggPSBpbWdEYXRhLncgKiBpbWdEYXRhLmgsDQogICAgICAgIGRhdGEgPSBpbWdEYXRhLmRhdGE7DQogICAgZm9yIChpID0gMDsgaSA8IGx0aCAtIHcgLSAxOyBpICs9IDEpIHsNCiAgICAgICAgaWYgKGRhdGFbaV0gPT09IDEpIHsNCiAgICAgICAgICAgIGlmICghZGF0YVtpICsgMV0pIHsNCiAgICAgICAgICAgICAgICBkYXRhW2kgKyAxXSA9IDI7DQogICAgICAgICAgICAgICAgcmVzZXQucHVzaChpICsgMSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoIWRhdGFbaSArIHddKSB7DQogICAgICAgICAgICAgICAgZGF0YVtpICsgd10gPSAyOw0KICAgICAgICAgICAgICAgIHJlc2V0LnB1c2goaSArIHcpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCFkYXRhW2kgKyB3ICsgMV0pIHsNCiAgICAgICAgICAgICAgICBkYXRhW2kgKyB3ICsgMV0gPSAyOw0KICAgICAgICAgICAgICAgIHJlc2V0LnB1c2goaSArIHcgKyAxKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNoZWNrRGlhZ29uYWwoaikgew0KICAgICAgICBpZiAoIWRhdGFbal0gJiYgIWRhdGFbaiArIHcgKyAxXSAmJiBkYXRhW2ogKyAxXSAmJiBkYXRhW2ogKyB3XSkgew0KICAgICAgICAgICAgZGF0YVtqXSA9IDE7DQogICAgICAgICAgICBjaGVja0RpYWdvbmFsKGogLSB3IC0gMSk7DQogICAgICAgICAgICBjaGVja0RpYWdvbmFsKGogLSB3KTsNCiAgICAgICAgICAgIGNoZWNrRGlhZ29uYWwoaiAtIHcgKyAxKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoZGF0YVtqXSAmJiBkYXRhW2ogKyB3ICsgMV0gJiYgIWRhdGFbaiArIDFdICYmICFkYXRhW2ogKyB3XSkgew0KICAgICAgICAgICAgZGF0YVtqICsgMV0gPSAxOw0KICAgICAgICAgICAgY2hlY2tEaWFnb25hbChqIC0gdyAtIDEpOw0KICAgICAgICAgICAgY2hlY2tEaWFnb25hbChqIC0gdyk7DQogICAgICAgICAgICBjaGVja0RpYWdvbmFsKGogLSB3ICsgMSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBmb3IgKGkgPSB3ICsgMTsgaSA8IGx0aCAtIHcgLSAxOyBpICs9IDEpIHsNCiAgICAgICAgY2hlY2tEaWFnb25hbChpKTsNCiAgICB9DQogICAgZm9yIChpID0gMDsgaSA8IHJlc2V0Lmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGRhdGFbcmVzZXRbaV1dID0gMTsNCiAgICB9DQp9DQoNCi8vIEZpbmQgZWRnZSBhbmQgZm9sbG93IGl0IHVudGlsIHRoZSBzdGFydCBpcyBmb3VuZA0KLy8gRWRnZSBmcm9tIDAgLT4gMSBpcyBvdXRlciBsaW5lLCBmcm9tIDEgLT4gMCBpcyBpbm5lciBob2xlDQovLyBUcmFjZWQgcGl4ZWxzIGFyZSBtYXJrZWQgdG8gYXZvaWQgZG91YmxlIHRyYWNpbmcNCi8vIFdoZW4gYSBob2xlIGlzIGZvdW5kIHdlIGNhbiBlYXNpbHkgY3JlYXRlIGEgd2Vha2x5IHNpbXBsZSBwb2x5Z29uDQovLyBieSBsb29raW5nIHRvIHRoZSBsZWZ0IHVudGlsIGl0cyBvdXRlciBlZGdlIGlzIGZvdW5kLiBUaGF0IGlzIGFsd2F5cw0KLy8gdGhlIGNvcnJlc3BvbmRpbmcgb3V0ZXIgZWRnZS4NCi8vIFdoZW4gdGhlIHdlYWtseSBzaW1wbGUgcG9seWdvbiBvcHRpb24gaXMgc2V0IHRoZSBwb2x5Z29ucyBhcmUgY29tYmluZWQNCi8vIGFuZCBqb2luZWQgYnkgYW4gaW50ZXJzZWN0aW9uIGxpbmUuIFRoZSBrbm93bGVkZ2Ugb2YgYW4gaW50ZXJzZWN0aW9uDQovLyBwb2ludCBoZXJlIGlzIHZlcnkgdXNlZnVsIHRvIGNyZWF0ZSBiZXR0ZXIgc2ltcGxpZmllZCBwb2x5cyBpbiB0aGUgbmV4dA0KLy8gc3RlcC4NCm1vZHVsZS5leHBvcnRzLnRyYWNlSW1hZ2UgPSB0cmFjZUltYWdlOw0KZnVuY3Rpb24gdHJhY2VJbWFnZShpbWdEYXRhKSB7DQogICAgdmFyIGksDQogICAgICAgIHcgPSBpbWdEYXRhLncsDQogICAgICAgIGggPSBpbWdEYXRhLmgsDQogICAgICAgIGx0aCA9IGltZ0RhdGEudyAqIGltZ0RhdGEuaCwNCiAgICAgICAgZGF0YSA9IGltZ0RhdGEuZGF0YSwNCiAgICAgICAgcG9seXMgPSBbXSwNCiAgICAgICAgcG9seSwgcCwgcHJldiA9IDAsDQogICAgICAgIGludGVyc2VjdGlvbiwNCiAgICAgICAgaW5kZXggPSAwLA0KICAgICAgICB3ZWFrbHlTaW1wbGUgPSBpbWdEYXRhLndlYWtseVNpbXBsZTsNCg0KICAgIGZvciAoaSA9IHcgKyAxOyBpIDwgbHRoIC0gdyAtIDE7IGkgKz0gMSkgew0KICAgICAgICBwID0gZGF0YVtpXTsNCiAgICAgICAgaWYgKHAgPT09IDEgJiYgcHJldiA9PT0gMCkgew0KICAgICAgICAgICAgLy8gT3V0ZXIgbGluZQ0KICAgICAgICAgICAgcG9seSA9IGZvbGxvd0VkZ2UoZGF0YSwgaSwgdywgdHJ1ZSwgaW5kZXgpOw0KICAgICAgICAgICAgaWYgKHBvbHkpIHsNCiAgICAgICAgICAgICAgICBwb2x5cy5wdXNoKHsNCiAgICAgICAgICAgICAgICAgICAgb3V0ZXI6IHBvbHksDQogICAgICAgICAgICAgICAgICAgIGlubmVyczogW10NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBpbmRleCsrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2UgaWYgKHAgPT09IDAgJiYgcHJldiA9PT0gMSkgew0KICAgICAgICAgICAgcG9seSA9IGZvbGxvd0VkZ2UoZGF0YSwgaSAtIDEsIHcsIGZhbHNlLCBpbmRleCk7DQogICAgICAgICAgICBpZiAocG9seSkgew0KICAgICAgICAgICAgICAgIGludGVyc2VjdGlvbiA9IG1lcmdlSW5uZXJQb2x5KGRhdGEsIHBvbHlzLCBwb2x5LCBpIC0gMSwgdywgd2Vha2x5U2ltcGxlKTsNCiAgICAgICAgICAgICAgICBpZiAoIXdlYWtseVNpbXBsZSkgew0KICAgICAgICAgICAgICAgICAgICBwb2x5c1tpbnRlcnNlY3Rpb24ub3RoZXJJbmRleF0uaW5uZXJzLnB1c2gocG9seSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHByZXYgPSBwOw0KICAgIH0NCg0KICAgIC8vIFJlbW92ZSBpbm5lcnMgd2hlbiBuZWVkZWQNCiAgICBpZiAoaW1nRGF0YS5vcHRpb25zLm5vSG9sZXMpIHsNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IHBvbHlzLmxlbmd0aDsgaSArPSAxKSB7DQogICAgICAgICAgICBwb2x5c1tpXS5pbm5lcnMgPSBbXTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gcG9seXM7DQp9DQoNCi8vRm9sbG93IHRoZSBlZGdlIGJ5IGxvb2tpbmcgY291bnRlcmNsb2Nrd2lzZSBpbiA4IGRpcmVjdGlvbnMuDQovL1RoYXQgd2F5IHdlIHNob3VsZCBhbHdheXMgbWVldCBvdXIgc3RhcnQgcG9pbnQgYWdhaW4NCg0KZnVuY3Rpb24gZm9sbG93RWRnZShkYXRhLCBvZmZzZXQsIHdpZHRoLCBpc091dGVyLCBpbmRleCkgew0KICAgIHZhciBwb2x5ID0gW10sDQogICAgICAgIHhzID0gb2Zmc2V0ICUgd2lkdGgsDQogICAgICAgIHlzID0gTWF0aC5mbG9vcihvZmZzZXQgLyB3aWR0aCksDQogICAgICAgIHggPSB4cywNCiAgICAgICAgeG4sDQogICAgICAgIHkgPSB5cywNCiAgICAgICAgeW4sDQogICAgICAgIGRpciA9IChpc091dGVyID8gMyA6IDYpLA0KICAgICAgICBkLA0KICAgICAgICBwLA0KICAgICAgICBsdGggPSAwLA0KICAgICAgICBtYXhQb2ludHMgPSAxMDAwMDAwMCwgLy8gQXZvaWQgZW5kbGVzcyBsb29wcw0KICAgICAgICBpLA0KICAgICAgICB2ZWM7DQoNCiAgICBkYXRhW3ggKyB5ICogd2lkdGhdID0gU1RBUlQ7DQogICAgd2hpbGUgKGx0aCsrIDwgbWF4UG9pbnRzKSB7DQogICAgICAgIGZvciAoaSA9IDA7IGkgPD0gODsgaSsrKSB7DQogICAgICAgICAgICBpZiAoaSA9PT0gOCkgew0KICAgICAgICAgICAgICAgIC8vIFRyaWVkIGFsbCBkaXJlY3Rpb25zLCBtdXN0IGJlIGEgc2luZ2xlIHBpeGVsDQogICAgICAgICAgICAgICAgaWYgKCFwb2x5Lmxlbmd0aCkgew0KICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgc2luZ2xlIHBpeGVsDQogICAgICAgICAgICAgICAgICAgIGRhdGFbeCArIHkgKiB3aWR0aF0gPSBJR05PUkVEOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgZmluZG5leHQgcG9pbnQgYXQgIiArIHhzICsgIiwgIiArIHlzKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGQgPSAoZGlyICsgaSkgJSA4Ow0KICAgICAgICAgICAgdmVjID0gRElSU1tkXTsNCiAgICAgICAgICAgIHhuID0geCArIHZlY1swXTsNCiAgICAgICAgICAgIHluID0geSArIHZlY1sxXTsNCiAgICAgICAgICAgIHAgPSBkYXRhW3huICsgeW4gKiB3aWR0aF07DQogICAgICAgICAgICBpZiAocCA9PT0gMCkgY29udGludWU7DQogICAgICAgICAgICB4ID0geG47DQogICAgICAgICAgICB5ID0geW47DQogICAgICAgICAgICBwb2x5LnB1c2goeCwgeSwgZCk7DQogICAgICAgICAgICBkYXRhW3ggKyB5ICogd2lkdGhdID0gKFRSQUNFRCB8IChpbmRleCA8PCA4KSk7DQogICAgICAgICAgICBpZiAocCA9PT0gU1RBUlQpIHsNCiAgICAgICAgICAgICAgICAvLyBQb2x5IG11c3QgYXQgbGVhc3QgY29udGFpbiAzIHBvaW50cyAodHJpYW5nbGUpDQogICAgICAgICAgICAgICAgaWYgKHBvbHkubGVuZ3RoID4gMiAqIDMpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHN0YXJ0IHBvaW50DQogICAgICAgICAgICAgICAgICAgIHBvbHkucHVzaChwb2x5WzBdLCBwb2x5WzFdLCBwb2x5WzNdKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBvbHk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIC8vIElnbm9yZSBuZXh0IHRpbWUgKHRvbyBzaG9ydCkNCiAgICAgICAgICAgICAgICB3aGlsZSAocG9seS5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICAgICAgZGF0YVtwb2x5WzBdICsgd2lkdGggKiBwb2x5WzFdXSA9IElHTk9SRUQ7DQogICAgICAgICAgICAgICAgICAgIHBvbHkuc2hpZnQoKTsNCiAgICAgICAgICAgICAgICAgICAgcG9seS5zaGlmdCgpOw0KICAgICAgICAgICAgICAgICAgICBwb2x5LnNoaWZ0KCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZGlyID0gKGQgKyA4IC0gMykgJSA4Ow0KICAgICAgICAgICAgLy8gY29udGludWUgd2l0aCBuZXh0IHBvaW50DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgIH0NCiAgICB0aHJvdyBuZXcgRXJyb3IoIlRyYWNpbmcgZXJyb3IuIEZvdW5kIGVuZGxlc3MgbG9vcCBhdCAiICsgeHMgKyAiLCAiICsgeXMpOw0KfQ0KDQpmdW5jdGlvbiBtZXJnZUlubmVyUG9seShkYXRhLCBwb2x5cywgaW5uZXIsIG9mZnNldCwgd2lkdGgsIHdlYWtseVNpbXBsZSkgew0KICAgIHZhciB4ID0gb2Zmc2V0ICUgd2lkdGg7DQogICAgdmFyIHkgPSBNYXRoLnRydW5jKG9mZnNldCAvIHdpZHRoKTsNCiAgICBmb3IgKHZhciB4byA9IHggLSAxOyB4byA+IDA7IHhvLS0pIHsNCiAgICAgICAgdmFyIG8gPSB4byArIHkgKiB3aWR0aDsNCiAgICAgICAgaWYgKGRhdGFbb10gPj0gVFJBQ0VEKSB7DQogICAgICAgICAgICB2YXIgaW50ZXJzZWN0aW9uID0gZmluZEludGVyc2VjdGlvbihkYXRhLCB3aWR0aCwgcG9seXMsIHhvLCB5LCB0cnVlLCB3ZWFrbHlTaW1wbGUpOw0KICAgICAgICAgICAgaWYgKGludGVyc2VjdGlvbikgew0KICAgICAgICAgICAgICAgIC8vIE1hcmsgaW5uZXJsaW5lIHBpeGVscyB0byB0aGlzIG90aGVyUG9seQ0KICAgICAgICAgICAgICAgIHZhciBvdGhlclBvbHkgPSBwb2x5c1tpbnRlcnNlY3Rpb24ub3RoZXJJbmRleF0ub3V0ZXI7DQogICAgICAgICAgICAgICAgZm9yICh2YXIgaTIgPSAwOyBpMiA8IGlubmVyLmxlbmd0aDsgaTIgKz0gMykgew0KICAgICAgICAgICAgICAgICAgICBkYXRhW2lubmVyW2kyXSArIHdpZHRoICogaW5uZXJbaTIgKyAxXV0gJj0gMHgwZmY7DQogICAgICAgICAgICAgICAgICAgIGRhdGFbaW5uZXJbaTJdICsgd2lkdGggKiBpbm5lcltpMiArIDFdXSB8PSAoaW50ZXJzZWN0aW9uLm90aGVySW5kZXggPDwgOCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICh3ZWFrbHlTaW1wbGUpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGN1dFBvaW50ID0gaW50ZXJzZWN0aW9uLnBvaW50SW5kZXg7DQogICAgICAgICAgICAgICAgICAgIC8vIFNraXAgbGVmdCB2ZWN0b3JzDQogICAgICAgICAgICAgICAgICAgIHdoaWxlIChjdXRQb2ludCA+IDYgJiYgb3RoZXJQb2x5W2N1dFBvaW50ICsgMiAtIDNdID09PSAyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjdXRQb2ludCAtPSAzOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHZhciBzdGFydFBvbHkgPSBvdGhlclBvbHkuc2xpY2UoMCwgY3V0UG9pbnQpOw0KDQogICAgICAgICAgICAgICAgICAgIHZhciBlbmRQb2x5ID0gb3RoZXJQb2x5LnNsaWNlKGludGVyc2VjdGlvbi5wb2ludEluZGV4IC0gMyk7DQogICAgICAgICAgICAgICAgICAgIGVuZFBvbHlbMV0gKz0gMC4yOw0KICAgICAgICAgICAgICAgICAgICBlbmRQb2x5WzJdID0gOCArIDI7IC8vIHNwZWNpYWwgdmVjdG9yIGF2b2lkcyBvcHRpbWFsaXNhdGlvbiBoZXJlDQogICAgICAgICAgICAgICAgICAgIGlubmVyW2lubmVyLmxlbmd0aCAtIDJdICs9IDAuMjsNCiAgICAgICAgICAgICAgICAgICAgaW5uZXJbMl0gPSA4ICsgNjsgLy8gc3BlY2lhbCB2ZWN0b3IgYXZvaWRzIG9wdGltYWxpc2F0aW9uIGhlcmUNCiAgICAgICAgICAgICAgICAgICAgb3RoZXJQb2x5ID0gc3RhcnRQb2x5LmNvbmNhdChpbm5lci5jb25jYXQoZW5kUG9seSkpOw0KICAgICAgICAgICAgICAgICAgICBwb2x5c1tpbnRlcnNlY3Rpb24ub3RoZXJJbmRleF0ub3V0ZXIgPSBvdGhlclBvbHk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcnNlY3Rpb247DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgdGhyb3cgbmV3IEVycm9yKCJPdXRlciBlZGdlIG5vdCBmb3VuZCIpOw0KfQ0KDQpmdW5jdGlvbiBmaW5kSW50ZXJzZWN0aW9uKGRhdGEsIHdpZHRoLCBwb2x5cywgeCwgeSwgaXNEb3dud2FyZHMsIHdlYWtseVNpbXBsZSkgew0KICAgIHZhciBvZmZzZXQgPSB4ICsgeSAqIHdpZHRoOw0KICAgIHZhciBvdGhlckluZGV4ID0gZGF0YVtvZmZzZXRdID4+IDg7DQogICAgaWYgKG90aGVySW5kZXggPT09IHBvbHlzLmxlbmd0aCkgew0KICAgICAgICAvLyBGb3VuZCBvdXIgb3duIGlubmVybGluZS4gSWdub3JlDQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgaWYgKG90aGVySW5kZXggPj0gcG9seXMubGVuZ3RoKSB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgb2Zmc2V0Iik7DQogICAgdmFyIG90aGVyUG9seSA9IHBvbHlzW290aGVySW5kZXhdLm91dGVyOw0KICAgIHZhciBpbnRlcnNlY3Rpb24gPSBmaW5kSW50ZXJzZWN0aW9uT25MaW5lKHgsIHksIG90aGVySW5kZXgsIG90aGVyUG9seSwgaXNEb3dud2FyZHMpOw0KICAgIGlmIChpbnRlcnNlY3Rpb24pIHsNCiAgICAgICAgcmV0dXJuIGludGVyc2VjdGlvbjsNCiAgICB9DQogICAgZm9yICh2YXIgaCA9IDA7IGggPCBwb2x5c1tvdGhlckluZGV4XS5pbm5lcnMubGVuZ3RoOyBoKyspIHsNCiAgICAgICAgaW50ZXJzZWN0aW9uID0gZmluZEludGVyc2VjdGlvbk9uTGluZSh4LCB5LCBvdGhlckluZGV4LCBwb2x5c1tvdGhlckluZGV4XS5pbm5lcnNbaF0sIGlzRG93bndhcmRzKTsNCiAgICAgICAgaWYgKGludGVyc2VjdGlvbikgew0KICAgICAgICAgICAgcmV0dXJuIGludGVyc2VjdGlvbjsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KZnVuY3Rpb24gZmluZEludGVyc2VjdGlvbk9uTGluZSh4LCB5LCBvdGhlckluZGV4LCBvdGhlclBvbHksIGlzRG93bndhcmRzKSB7DQoNCiAgICAvLyBGaW5kIHBvaW50IG9uIG90aGVyIHBvbHkNCiAgICB2YXIgZGlycyA9IGlzRG93bndhcmRzID8gWzMsIDQsIDVdIDogWzAsIDIsIDEsIDYsIDddOw0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3RoZXJQb2x5Lmxlbmd0aDsgaSArPSAzKSB7DQogICAgICAgIGlmIChvdGhlclBvbHlbaV0gPT09IHggJiYgb3RoZXJQb2x5W2kgKyAxXSA9PT0geSAmJiBkaXJzLmluZGV4T2Yob3RoZXJQb2x5W2kgKyAyXSkgPj0gMCkgew0KICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICBvdGhlckluZGV4OiBvdGhlckluZGV4LA0KICAgICAgICAgICAgICAgIHBvaW50SW5kZXg6IGksDQogICAgICAgICAgICAgICAgaXNEb3dud2FyZHM6IGlzRG93bndhcmRzDQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQogICAgfQ0KfQ0KDQoNCi8vIFNpbXBsaWZ5IGNyZWF0ZXMgYSByYXN0ZXIgMngyIHRpbWVzIGxhcmdlciB0aGFuIHRoZSBpbWFnZS4NCi8vIFRoZW4gZHJhdyB0aGUgc21hbGwgcG9seSBsaW5lcyB3aXRoIGEgJ3Nsb3BlJyBhcm91bmQgaXQuIFNsb3BlIHdpZHRoIGlzDQovLyB0aGUgdG9sZXJhbmNlIHZhbHVlIGZvciBzaW1wbGlmaWNhdGlvbi4gVGhpcyBtZWFucyB0aGF0IGFzIGxvbmcgYXMgd2UNCi8vIGNhbiBkcmF3IGEgc3RyYWlnaHQgbGluZSBiZXR3ZWVuIHZlcnRpY2VzIHdoaWxlIHN0YXlpbiAnb24gdGhlIHNsb3BlJw0KLy8gdGhlIGxpbmUgaXMgd2l0aGluIHRoZSB0b2xlcmFuY2UgdmFsdWU6DQovLw0KLy8gICAgICAgICAgWCAgICAgICAgICBYICAgWCAgICAgIFgNCi8vDQovLyAgICAgICAgICBfICAgICAgICAgIF8gICBfICAgICAgXw0KLy8gICAgICAgICBfIF8gICAgICAgIF8gXyBfIF8gICAgXyBfDQovLyAgICAgICAgXyAgIF8gICAgICBfICAgXyAgIF8gIF8gICBfDQovLyAgICAgICBfICAgICBfICAgIF8gICAgICAgICBfXyAgICAgXw0KLy8gICBfX19fICAgICAgIF9fX18gICAgICAgICAgICAgICAgICBfDQovLw0KLy8gSW4gdGhlIG5leHQgc3RlcCBhbGwgJ3ZhbGxleSBwb2ludHMnIGFyZSBkZXRlY3RlZCBhbmQgc2V0IHRvIDAuDQovLw0KLy8gICAgICAgICAgWCAgICAgICAgICBYICAgWCAgICAgIFgNCi8vDQovLyAgICAgICAgICBfICAgICAgICAgIF8gICBfICAgICAgXw0KLy8gICAgICAgICBfIF8gICAgICAgIF8gXyBfIF8gICAgXyBfDQovLyAgICAgICAgXyAgIF8gICAgICBfICAgICAgIF8gIF8gICBfDQovLyAgICAgICBfICAgICBfICAgIF8gICAgICAgICAgXyAgICAgXw0KLy8gICBfX19fICAgICAgIF9fX18gICAgIF8gICAgXyAgICAgICBfDQovLyAgICAgICAgICAgICAgICAgICAgICAgMCAgICAwDQovLw0KLy8gV2l0aCB0aGlzIHJhc3RlciB0aGUgc2ltbGlmaWVkIGxpbmVzIGNhbiBiZSBmb3VuZCBieSBjb25uZWN0aW5nDQovLyB2ZXJ0cmljZXMgYXMgbG9uZyBhcyB0aGUgc3RyYWlnaHQgbGluZSBiZXR3ZWVuIGRlIHZlcnRpY2VzIGRvDQovLyBub3QgY3Jvc3MgJzAnIHZhbHVlcy4gVGhpcyB3aWxsIGd1YXJhbnRlZSB0aGF0IHNpbXBsaWZpZWQgbGluZXMNCi8vIHdpbGwgbmV2ZXIgb3ZlcmxhcC4NCi8vIEZvciBzcGVlZCBvcHRpbWFsaXphdGlvbiB3ZSB1c2UgYmlzZWN0aW5nIHN0ZXBzIChzdGFydCB3aXRoIDMyIG9yIG1heA0KLy8gaGFsZiB0aGUgdG90YWwgcG9seSBsZW5ndGgpLg0KLy8gRi5lLiB3aGVuIHRoZSBsYXJnZXN0IGZpdHRpbmcgbGluZSBsZW5ndGggaXMgNDMgdGhlIGZvbGxvd2luZyBsZW5ndGhzDQovLyB3aWxsIGJlIHRlc3RlZDogMzIsIDY0LCA0OCwgNDAsIDQ0LCA0MiwgNDMNCm1vZHVsZS5leHBvcnRzLnNpbXBsaWZ5ID0gc2ltcGxpZnk7DQpmdW5jdGlvbiBzaW1wbGlmeShpbWdEYXRhLCBwb2x5cykgew0KICAgIHZhciB6ID0gaW1nRGF0YS5zaW1wbGlmeVpvb20gPSAyOw0KICAgIHZhciBzID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7DQogICAgdmFyIGx3ID0gaW1nRGF0YS53ICogejsNCiAgICB2YXIgbGggPSBpbWdEYXRhLmggKiB6Ow0KICAgIHZhciBkZWx0YXMgPSBpbWdEYXRhLnRvbGVyYW5jZSAqIHo7DQogICAgLy8gUmV1c2UgYXJyYXkNCiAgICB2YXIgbGIgPSBuZXcgVWludDhBcnJheShpbWdEYXRhLmRhdGEuYnVmZmVyKTsNCiAgICBpbWdEYXRhLmRhdGEgPSBsYjsNCiAgICB2YXIgeCwgeSwgZDsNCiAgICB2YXIgaTsNCiAgICBmb3IgKGkgPSAwOyBpIDwgbGIubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgbGJbaV0gPSAwOw0KICAgIH0NCiAgICB2YXIgbCwgcG9seSwgaDsNCiAgICB2YXIgeDAsIHkwLCB4MSwgeTE7DQogICAgdmFyIHdlYWtseVNpbXBsZSA9IGltZ0RhdGEud2Vha2x5U2ltcGxlOw0KICAgIHZhciB0b2xlcmFuY2UgPSBNYXRoLnJvdW5kKGltZ0RhdGEudG9sZXJhbmNlICogeik7DQogICAgdmFyIG1hc2sgPSBuZXcgQXJyYXkodG9sZXJhbmNlKTsNCiAgICBmb3IgKHggPSAwOyB4IDwgdG9sZXJhbmNlOyB4KyspIHsNCiAgICAgICAgbWFza1t4XSA9IG5ldyBBcnJheSh0b2xlcmFuY2UpOw0KICAgICAgICBmb3IgKHkgPSAwOyB5IDwgdG9sZXJhbmNlOyB5KyspIHsNCiAgICAgICAgICAgIGQgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSk7DQogICAgICAgICAgICBtYXNrW3hdW3ldID0gMjU1IC0gTWF0aC5mbG9vcigyNTYgLyB0b2xlcmFuY2UpICogZDsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHNldFBvaW50KF94LCBfeSkgew0KICAgICAgICBmb3IgKHZhciBteCA9IDA7IG14IDwgbWFzay5sZW5ndGg7IG14KyspIHsNCiAgICAgICAgICAgIGZvciAodmFyIG15ID0gMDsgbXkgPCBtYXNrLmxlbmd0aDsgbXkrKykgew0KICAgICAgICAgICAgICAgIGlmIChtYXNrW214XVtteV0gPiBsYltfeCArIG14ICsgKF95ICsgbXkpICogbHddKSB7DQogICAgICAgICAgICAgICAgICAgIGxiW194ICsgbXggKyAoX3kgKyBteSkgKiBsd10gPSBtYXNrW214XVtteV07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChtYXNrW214XVtteV0gPiBsYltfeCAtIG14ICsgKF95ICsgbXkpICogbHddKSB7DQogICAgICAgICAgICAgICAgICAgIGxiW194IC0gbXggKyAoX3kgKyBteSkgKiBsd10gPSBtYXNrW214XVtteV07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChtYXNrW214XVtteV0gPiBsYltfeCArIG14ICsgKF95IC0gbXkpICogbHddKSB7DQogICAgICAgICAgICAgICAgICAgIGxiW194ICsgbXggKyAoX3kgLSBteSkgKiBsd10gPSBtYXNrW214XVtteV07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChtYXNrW214XVtteV0gPiBsYltfeCAtIG14ICsgKF95IC0gbXkpICogbHddKSB7DQogICAgICAgICAgICAgICAgICAgIGxiW194IC0gbXggKyAoX3kgLSBteSkgKiBsd10gPSBtYXNrW214XVtteV07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIGZvciAobCA9IDA7IGwgPCBwb2x5cy5sZW5ndGg7IGwrKykgew0KICAgICAgICBwb2x5ID0gcG9seXNbbF0ub3V0ZXI7DQogICAgICAgIGZvciAoaSA9IDM7IGkgPCBwb2x5Lmxlbmd0aDsgaSArPSAzKSB7DQogICAgICAgICAgICB4MCA9IHBvbHlbaSAtIDNdICogejsNCiAgICAgICAgICAgIHkwID0gcG9seVtpIC0gMl0gKiB6Ow0KICAgICAgICAgICAgeDEgPSBwb2x5W2ldICogejsNCiAgICAgICAgICAgIHkxID0gcG9seVtpICsgMV0gKiB6Ow0KICAgICAgICAgICAgY2FsY0xpbmUoeDAsIHkwLCB4MSwgeTEsIHNldFBvaW50KTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIXdlYWtseVNpbXBsZSkgew0KICAgICAgICAgICAgZm9yIChoID0gMDsgaCA8IHBvbHlzW2xdLmlubmVycy5sZW5ndGg7IGgrKykgew0KICAgICAgICAgICAgICAgIHBvbHkgPSBwb2x5c1tsXS5pbm5lcnNbaF07DQogICAgICAgICAgICAgICAgZm9yIChpID0gMzsgaSA8IHBvbHkubGVuZ3RoOyBpICs9IDMpIHsNCiAgICAgICAgICAgICAgICAgICAgeDAgPSBwb2x5W2kgLSAzXSAqIHo7DQogICAgICAgICAgICAgICAgICAgIHkwID0gcG9seVtpIC0gMl0gKiB6Ow0KICAgICAgICAgICAgICAgICAgICB4MSA9IHBvbHlbaV0gKiB6Ow0KICAgICAgICAgICAgICAgICAgICB5MSA9IHBvbHlbaSArIDFdICogejsNCiAgICAgICAgICAgICAgICAgICAgY2FsY0xpbmUoeDAsIHkwLCB4MSwgeTEsIHNldFBvaW50KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQoNCiAgICB2YXIgb2Zmc2V0LCB2Ow0KDQogICAgLy8gZmluZCBsb3dlc3QgcG9pbnRzIGFuZCBzZXQgdGhlbSB0byAwDQogICAgZm9yIChvZmZzZXQgPSBsdyAqIDIgKyAyOyBvZmZzZXQgPCBsYi5sZW5ndGggLSAxIC0gbHc7IG9mZnNldCArPSAxKSB7DQogICAgICAgIHYgPSBsYltvZmZzZXRdOw0KICAgICAgICBpZiAoKGxiW29mZnNldCAtIDFdID4gdiB8fCBsYltvZmZzZXQgLSAyXSA+IHYpICYmIGxiW29mZnNldCArIDFdID4gdikgew0KICAgICAgICAgICAgbGJbb2Zmc2V0XSA9IDA7DQogICAgICAgIH0NCiAgICAgICAgaWYgKChsYltvZmZzZXQgLSBsd10gPiB2IHx8IGxiW29mZnNldCAtIGx3IC0gbHddID4gdikgJiYgbGJbb2Zmc2V0ICsgbHddID4gdikgew0KICAgICAgICAgICAgbGJbb2Zmc2V0XSA9IDA7DQogICAgICAgIH0NCiAgICAgICAgaWYgKChsYltvZmZzZXQgLSBsdyAtIDFdID4gdiB8fCBsYltvZmZzZXQgLSBsdyAtIGx3IC0gMl0gPiB2KSAmJiBsYltvZmZzZXQgKyBsdyArIDFdID4gdikgew0KICAgICAgICAgICAgbGJbb2Zmc2V0XSA9IDA7DQogICAgICAgIH0NCiAgICAgICAgaWYgKChsYltvZmZzZXQgLSBsdyArIDFdID4gdiB8fCBsYltvZmZzZXQgLSBsdyAtIGx3ICsgMl0gPiB2KSAmJiBsYltvZmZzZXQgKyBsdyAtIDFdID4gdikgew0KICAgICAgICAgICAgbGJbb2Zmc2V0XSA9IDA7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBpZiAoIXdlYWtseVNpbXBsZSkgew0KICAgICAgICBmb3IgKGwgPSAwOyBsIDwgcG9seXMubGVuZ3RoOyBsKyspIHsNCiAgICAgICAgICAgIHBvbHlzW2xdLm91dGVyID0gc2ltcGxpZnlTZWdtZW50KGxiLCBsdywgeiwgcG9seXNbbF0ub3V0ZXIsIHdlYWtseVNpbXBsZSk7DQogICAgICAgICAgICBmb3IgKGggPSAwOyBoIDwgcG9seXNbbF0uaW5uZXJzLmxlbmd0aDsgaCsrKSB7DQogICAgICAgICAgICAgICAgcG9seXNbbF0uaW5uZXJzW2hdID0gc2ltcGxpZnlTZWdtZW50KGxiLCBsdywgeiwgcG9seXNbbF0uaW5uZXJzW2hdLCB3ZWFrbHlTaW1wbGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgICAgLy8gZmluZCBzaW1wbGlmaWVkIHBvbHlzDQogICAgICAgIHZhciBpMCwgaTEsIG5ld1BvbHksIHN1YlBvbHk7DQogICAgICAgIGZvciAobCA9IDA7IGwgPCBwb2x5cy5sZW5ndGg7IGwrKykgew0KICAgICAgICAgICAgcG9seSA9IHBvbHlzW2xdLm91dGVyOw0KICAgICAgICAgICAgLy8gTW92ZSBmaXJzdCBwb2ludCB0byBlbmQgb2YgcG9pbnQuIFJlc3VsdHMgaW4gYmV0dGVyIGhvcml6b250YWwvdmVydGljYWwgcG9seSByZWNvZ25pdGlvbg0KICAgICAgICAgICAgLy8NCiAgICAgICAgICAgIHBvbHkuc2hpZnQoKTsNCiAgICAgICAgICAgIHBvbHkuc2hpZnQoKTsNCiAgICAgICAgICAgIHBvbHkuc2hpZnQoKTsNCiAgICAgICAgICAgIHBvbHkucHVzaChwb2x5WzBdKTsNCiAgICAgICAgICAgIHBvbHkucHVzaChwb2x5WzFdKTsNCiAgICAgICAgICAgIHBvbHkucHVzaChwb2x5WzJdKTsNCiAgICAgICAgICAgIG5ld1BvbHkgPSBbXTsNCiAgICAgICAgICAgIGkwID0gMDsNCiAgICAgICAgICAgIGkxID0gMzsNCiAgICAgICAgICAgIHdoaWxlIChpMSA8IHBvbHkubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgLy8gQ2hlY2sgaW50ZXJzZWN0aW9uDQogICAgICAgICAgICAgICAgaWYgKHBvbHlbaTEgKyAyXSAmIDgpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gSW50ZXJzZWN0aW9uIHdoZXJlIGkxIHBvaW50cyB0byBvdGhlciBzaWRlLiBTaW1wbGlmeSBzZWdtZW50IHRvIG1haW50YWluIGNvcnJlY3QgaW50ZXJzZWN0aW9uDQogICAgICAgICAgICAgICAgICAgIC8vIHBvbHlzIGFuZCB0byBhdm9pZCBvdmVybGFwDQogICAgICAgICAgICAgICAgICAgIHN1YlBvbHkgPSBzaW1wbGlmeVNlZ21lbnQobGIsIGx3LCB6LCBwb2x5LnNsaWNlKGkwLCBpMSksIHdlYWtseVNpbXBsZSk7DQogICAgICAgICAgICAgICAgICAgIG5ld1BvbHkgPSBuZXdQb2x5LmNvbmNhdChzdWJQb2x5KTsNCiAgICAgICAgICAgICAgICAgICAgbmV3UG9seS5wdXNoKHBvbHlbaTFdKTsNCiAgICAgICAgICAgICAgICAgICAgbmV3UG9seS5wdXNoKHBvbHlbaTEgKyAxXSk7DQogICAgICAgICAgICAgICAgICAgIGkwID0gaTE7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGkxICs9IDM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzdWJQb2x5ID0gc2ltcGxpZnlTZWdtZW50KGxiLCBsdywgeiwgcG9seS5zbGljZShpMCwgaTEgKyAzLCB3ZWFrbHlTaW1wbGUpKQ0KICAgICAgICAgICAgbmV3UG9seSA9IG5ld1BvbHkuY29uY2F0KHN1YlBvbHkpOw0KICAgICAgICAgICAgcG9seXNbbF0ub3V0ZXIgPSBuZXdQb2x5Ow0KICAgICAgICB9DQoNCiAgICB9DQoNCiAgICByZXR1cm4gcG9seXM7DQp9DQoNCmZ1bmN0aW9uIHNpbXBsaWZ5U2VnbWVudChsYiwgbHcsIHosIHBvbHksIHdlYWtseVNpbXBsZSkgew0KICAgIHZhciB2YWxpZCwNCiAgICAgICAgaTAsDQogICAgICAgIGkxLA0KICAgICAgICBpcHJldiwNCiAgICAgICAgbnAsDQogICAgICAgIG8sDQogICAgICAgIG9saW1pdCwNCiAgICAgICAgc3JhbmdlID0gMzIsDQogICAgICAgIHMwLA0KICAgICAgICBzMSwNCiAgICAgICAgc2F2ZywNCiAgICAgICAgcHQsIGwsDQogICAgICAgIHByZXZMZW5ndGggPSAxMDA7DQoNCiAgICBmdW5jdGlvbiBjaGVja1BvaW50KHgsIHkpIHsNCiAgICAgICAgLy9jb25zb2xlLmxvZygncHQgJyArIHggKyAnLCAnICsgeSArICcgLT4gJyArIGxiW3ggKyB5ICogbHddKTsNCiAgICAgICAgcmV0dXJuIGxiW3ggKyB5ICogbHddID4gMDsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBjaGVja0xpbmVTZWdtZW50KF94MSwgX3kxLCBfeDIsIF95Mikgew0KICAgICAgICAvLyBJbnZhbGlkIHBvaW50cyBhcmUgc3RhdGlzdGljYWxseSBtb3N0bHkgYXQgdGhlIGVuZCBvZiBhIGxpbmUuIFNvIHdlIGRyYXcgdGhlIGxpbmUgYmFja3dhcmRzDQogICAgICAgIHZhciBfcmVzdWx0ID0gY2FsY0xpbmUoX3gyICogeiwgX3kyICogeiwgX3gxICogeiwgX3kxICogeiwgY2hlY2tQb2ludCk7DQogICAgICAgIC8vIGNvbnNvbGUubG9nKCdjaGVjayByZXN1bHQgJyArIF9yZXN1bHQpOw0KICAgICAgICByZXR1cm4gX3Jlc3VsdDsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBjaGVja0xpbmUoX2kwLCBfaTEpIHsNCiAgICAgICAgLy8gY29uc29sZS5sb2coJ2NoZWNrICcgKyBfaTAgKyAnICcgKyBfaTEpOw0KICAgICAgICBpZiAoX2kxID49IHBvbHkubGVuZ3RoIC0gMSkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBjaGVja0xpbmVTZWdtZW50KHBvbHlbX2kwXSwgcG9seVtfaTAgKyAxXSwgcG9seVtfaTFdLCBwb2x5W19pMSArIDFdKTsNCiAgICB9DQoNCiAgICBpZiAoIXdlYWtseVNpbXBsZSkgew0KICAgICAgICAvLyBNb3ZlIGZpcnN0IHBvaW50IHRvIGVuZCBvZiBwb2ludC4gUmVzdWx0cyBpbiBiZXR0ZXIgaG9yaXpvbnRhbC92ZXJ0aWNhbCBsaW5lIHJlY29nbml0aW9uDQogICAgICAgIC8vcG9seS5wdXNoKHBvbHkuc2hpZnQoKSwgcG9seS5zaGlmdCgpLCBwb2x5LnNoaWZ0KCkpOw0KICAgICAgICBwb2x5LnNoaWZ0KCk7DQogICAgICAgIHBvbHkuc2hpZnQoKTsNCiAgICAgICAgcG9seS5zaGlmdCgpOw0KICAgICAgICBwb2x5LnB1c2gocG9seVswXSwgcG9seVsxXSwgcG9seVsyXSk7DQogICAgfQ0KDQogICAgbnAgPSBbcG9seVswXSwgcG9seVsxXV07DQogICAgaTAgPSAwOw0KICAgIC8vIHMyIG1heSBub3QgZXhjZWVkIDEvNCBvZiBwb2x5IGxlbmd0aC4gT3RoZXJ3aXNlIHdlIG1heSBnbyBpbiB0aGUgd3JvbmcgZGlyZWN0aW9uDQogICAgd2hpbGUgKHNyYW5nZSA+IDIgJiYgc3JhbmdlID4gKHBvbHkubGVuZ3RoIC8gMykgLyA0KSB7DQogICAgICAgIHNyYW5nZSAvPSAyOw0KICAgIH0NCg0KICAgIHdoaWxlIChpMCA8IHBvbHkubGVuZ3RoIC0gMykgew0KDQogICAgICAgIC8vIEZpbmQgcGFydCB3aGVyZSBzMiBpcyB0b28gbG9uZw0KICAgICAgICBzMCA9IDA7DQogICAgICAgIHMxID0gc3JhbmdlOw0KICAgICAgICB3aGlsZSAoY2hlY2tMaW5lKGkwLCBpMCArIChzMSAqIDMpKSkgew0KICAgICAgICAgICAgczAgPSBzMTsNCiAgICAgICAgICAgIHMxICs9IHNyYW5nZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGRvIHsNCiAgICAgICAgICAgIC8vY29uc29sZS5sb2coJz4gJyArIHMwICsgJyAnICsgczEpOw0KICAgICAgICAgICAgc2F2ZyA9IE1hdGgucm91bmQoKHMwICsgczEpIC8gMik7DQogICAgICAgICAgICBpZiAoY2hlY2tMaW5lKGkwLCBpMCArIChzYXZnICogMykpKSB7DQogICAgICAgICAgICAgICAgczAgPSBzYXZnOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBzMSA9IHNhdmc7DQogICAgICAgICAgICB9DQogICAgICAgIH0gd2hpbGUgKHMxIC0gczAgPiAxKTsNCiAgICAgICAgaTEgPSBpMCArIHMwICogMzsNCiAgICAgICAgLy8gbG9vayB0aWxsIDQgcG9pbnRzIGJhY2sgYnV0IHVudGlsIGxlYXZlIGF0IDMgcG9pbnRzIGluIHRoZSBwb2x5DQogICAgICAgIG9saW1pdCA9IE1hdGgubWF4KGkxIC0gNiAqIDMsIGkwICsgMyAqIDMpOw0KICAgICAgICBmb3IgKG8gPSBpMTsgbyA+IG9saW1pdDsgbyAtPSAzKSB7DQogICAgICAgICAgICAvLyBjaGVjayBpZiBpMC54ID09PSBvLnggb3IgaTAueSA9PSBvLnkNCiAgICAgICAgICAgIGlmIChwb2x5W2kwXSA9PT0gcG9seVtvXSB8fCBwb2x5W2kwICsgMV0gPT09IHBvbHlbbyArIDFdKSB7DQogICAgICAgICAgICAgICAgaTEgPSBvOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHByZXZMZW5ndGggPCA0ICYmIG5wLmxlbmd0aCA+PSA2KSB7DQogICAgICAgICAgICAvLyBQcmV2aW91cyB3YXMgc21hbGwgc2VnbWVudC4gQ2hlY2sgaWYgaXQgY2FuIGJlIHJlbW92ZWQgYnkgam9pbmluZyB0aGUgbGluZXMgYmVmb3JlIGFuZCBhZnRlcg0KICAgICAgICAgICAgbCA9IG5wLmxlbmd0aDsNCiAgICAgICAgICAgIHB0ID0gZ2V0U2VnbWVudEludGVyc2VjdGlvblBvaW50KA0KICAgICAgICAgICAgICAgIG5wW2wgLSA2XSwgbnBbbCAtIDVdLCBucFtsIC0gNF0sIG5wW2wgLSAzXSwNCiAgICAgICAgICAgICAgICBucFtsIC0gMl0sIG5wW2wgLSAxXSwgcG9seVtpMV0sIHBvbHlbaTEgKyAxXSwNCiAgICAgICAgICAgICAgICBNYXRoLlBJIC8gNCk7DQogICAgICAgICAgICBpZiAocHQgJiYNCiAgICAgICAgICAgICAgICBjaGVja0xpbmVTZWdtZW50KG5wW2wgLSA2XSwgbnBbbCAtIDVdLCBwdFswXSwgcHRbMV0pICYmDQogICAgICAgICAgICAgICAgY2hlY2tMaW5lU2VnbWVudChwdFswXSwgcHRbMV0sIHBvbHlbaTFdLCBwb2x5W2kxICsgMV0pKSB7DQogICAgICAgICAgICAgICAgbnBbbnAubGVuZ3RoIC0gNF0gPSBwdFswXTsNCiAgICAgICAgICAgICAgICBucFtucC5sZW5ndGggLSAzXSA9IHB0WzFdOw0KICAgICAgICAgICAgICAgIG5wLnBvcCgpOw0KICAgICAgICAgICAgICAgIG5wLnBvcCgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQovLyAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncHVzaCAnICsgaTAgKyAnIC0+ICcgKyBpMSk7DQogICAgICAgIG5wLnB1c2gocG9seVtpMV0sIHBvbHlbaTEgKyAxXSk7DQogICAgICAgIHByZXZMZW5ndGggPSAoaTEgLSBpMCkgLyAzOw0KICAgICAgICBpMCA9IGkxOw0KICAgIH0NCg0KICAgIGlmIChwcmV2TGVuZ3RoIDwgNCAmJiBucC5sZW5ndGggPj0gOCkgew0KICAgICAgICAvLyBQcmV2aW91cyB3YXMgc21hbGwgc2VnbWVudC4gQ2hlY2sgaWYgaXQgY2FuIGJlIHJlbW92ZWQgYnkgam9pbmluZyB0aGUgbGluZXMgYmVmb3JlIGFuZCBhZnRlcg0KICAgICAgICBsID0gbnAubGVuZ3RoOw0KICAgICAgICBwdCA9IGdldFNlZ21lbnRJbnRlcnNlY3Rpb25Qb2ludCgNCiAgICAgICAgICAgIG5wW2wgLSA2XSwgbnBbbCAtIDVdLCBucFtsIC0gNF0sIG5wW2wgLSAzXSwNCiAgICAgICAgICAgIG5wW2wgLSAyXSwgbnBbbCAtIDFdLCBucFsyXSwgbnBbM10sDQogICAgICAgICAgICBNYXRoLlBJIC8gNCk7DQogICAgICAgIGlmIChwdCAmJg0KICAgICAgICAgICAgbnBbMF0gPT09IG5wW2wgLSAyXSAmJiBucFsxXSA9PT0gbnBbbCAtIDFdICYmDQogICAgICAgICAgICBjaGVja0xpbmVTZWdtZW50KG5wW2wgLSA2XSwgbnBbbCAtIDVdLCBwdFswXSwgcHRbMV0pICYmDQogICAgICAgICAgICBjaGVja0xpbmVTZWdtZW50KHB0WzBdLCBwdFsxXSwgbnBbMl0sIG5wWzNdKSkgew0KICAgICAgICAgICAgbnBbMF0gPSBwdFswXTsNCiAgICAgICAgICAgIG5wWzFdID0gcHRbMV07DQogICAgICAgICAgICBucFtucC5sZW5ndGggLSA0XSA9IHB0WzBdOw0KICAgICAgICAgICAgbnBbbnAubGVuZ3RoIC0gM10gPSBwdFsxXTsNCiAgICAgICAgICAgIG5wLnBvcCgpOw0KICAgICAgICAgICAgbnAucG9wKCk7DQogICAgICAgIH0NCiAgICB9DQogICAgLy9pMSAtPSAzOw0KICAgIC8vaWYgKGkxID4gaTApIHsNCiAgICAvLyAgICBucC5wdXNoKHBvbHlbaTFdLCBwb2x5W2kxICsgMV0pOw0KICAgIC8vfQ0KICAgIGlmIChucC5sZW5ndGggPD0gMiAqIDIpIHsNCiAgICAgICAgbnAgPSBbXTsNCiAgICB9DQogICAgcmV0dXJuIG5wOw0KfQ0KDQpmdW5jdGlvbiBnZXRTZWdtZW50SW50ZXJzZWN0aW9uUG9pbnQoeHMxLCB5czEsIHhlMSwgeWUxLCB4czIsIHlzMiwgeGUyLCB5ZTIsIG1pbkFuZ2xlKSB7DQogICAgdmFyIGR4MSA9IHhlMSAtIHhzMTsNCiAgICB2YXIgZHkxID0geWUxIC0geXMxOw0KICAgIHZhciBkeDIgPSB4ZTIgLSB4czI7DQogICAgdmFyIGR5MiA9IHllMiAtIHlzMjsNCiAgICB2YXIgYW5nbGUxID0gTWF0aC5hdGFuMihkeTEsIGR4MSk7DQogICAgdmFyIGFuZ2xlMiA9IE1hdGguYXRhbjIoZHkyLCBkeTEpOw0KICAgIHZhciBhbmdsZSA9IE1hdGguYWJzKGFuZ2xlMSAtIGFuZ2xlMik7DQogICAgaWYgKGFuZ2xlID4gTWF0aC5QSSkgew0KICAgICAgICBhbmdsZSAtPSBNYXRoLlBJOw0KICAgIH0NCiAgICBpZiAoYW5nbGUgPCBtaW5BbmdsZSkgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgdmFyIGQgPSAoZHkyICogZHgxKSAtIChkeDIgKiBkeTEpOw0KICAgIGlmICghZCkgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgdmFyIGEgPSB5czEgLSB5czI7DQogICAgdmFyIGIgPSB4czEgLSB4czI7DQogICAgdmFyIG4xID0gZHgyICogYSAtIGR5MiAqIGI7DQogICAgdmFyIG4yID0gZHgxICogYSAtIGR5MSAqIGI7DQogICAgYSA9IG4xIC8gZDsNCiAgICBiID0gbjIgLyBkOw0KICAgIHJldHVybiBbeHMxICsgYSAqIGR4MSwgeXMxICsgYSAqIGR5MV07DQp9DQoNCi8vIEJyZXNlbmhhbSBhbGdvcml0aG0gZm9yIGRyYXd3aW5nIHN0cmFpZ2h0IGxpbmVzDQpmdW5jdGlvbiBjYWxjTGluZSh4MCwgeTAsIHgxLCB5MSwgaGFuZGxlcikgew0KICAgIHgwID0gTWF0aC5yb3VuZCh4MCk7DQogICAgeTAgPSBNYXRoLnJvdW5kKHkwKTsNCiAgICB4MSA9IE1hdGgucm91bmQoeDEpOw0KICAgIHkxID0gTWF0aC5yb3VuZCh5MSk7DQogICAgdmFyIGR4ID0geDEgLSB4MDsNCiAgICB2YXIgZHkgPSB5MSAtIHkwOw0KICAgIHZhciBkZWNsaXZlID0gZmFsc2UsIHNpbWV0cmljbyA9IGZhbHNlOw0KICAgIHZhciB0ZW1wOw0KDQoNCiAgICBpZiAoZHggKiBkeSA8IDApIHsNCiAgICAgICAgeTAgPSAteTA7DQogICAgICAgIHkxID0gLXkxOw0KICAgICAgICBkeSA9IC1keTsNCiAgICAgICAgc2ltZXRyaWNvID0gdHJ1ZTsNCiAgICB9DQoNCiAgICBpZiAoTWF0aC5hYnMoZHgpIDwgTWF0aC5hYnMoZHkpKSB7DQogICAgICAgIHRlbXAgPSBkeDsNCiAgICAgICAgZHggPSBkeTsNCiAgICAgICAgZHkgPSB0ZW1wOw0KDQogICAgICAgIHRlbXAgPSB4MDsNCiAgICAgICAgeDAgPSB5MDsNCiAgICAgICAgeTAgPSB0ZW1wOw0KDQogICAgICAgIHRlbXAgPSB4MTsNCiAgICAgICAgeDEgPSB5MTsNCiAgICAgICAgeTEgPSB0ZW1wOw0KDQogICAgICAgIGRlY2xpdmUgPSB0cnVlOw0KICAgIH0NCg0KICAgIGlmICh4MCA+IHgxKSB7DQogICAgICAgIHRlbXAgPSB4MDsNCiAgICAgICAgeDAgPSB4MTsNCiAgICAgICAgeDEgPSB0ZW1wOw0KDQogICAgICAgIHRlbXAgPSB5MDsNCiAgICAgICAgeTAgPSB5MTsNCiAgICAgICAgeTEgPSB0ZW1wOw0KDQogICAgICAgIGR4ID0gLWR4Ow0KICAgICAgICBkeSA9IC1keTsNCiAgICB9DQoNCiAgICB2YXIgZCA9IDIgKiBkeSAtIGR4Ow0KICAgIHZhciBpbmNFID0gMiAqIGR5Ow0KICAgIHZhciBpbmNORSA9IDIgKiAoZHkgLSBkeCk7DQoNCg0KICAgIHZhciBweCwgcHksIHkgPSB5MDsNCiAgICBmb3IgKHZhciB4ID0geDA7IHggPD0geDE7IHgrKykgew0KICAgICAgICBpZiAoZGVjbGl2ZSkgew0KICAgICAgICAgICAgcHggPSB5Ow0KICAgICAgICAgICAgcHkgPSB4Ow0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcHggPSB4Ow0KICAgICAgICAgICAgcHkgPSB5Ow0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHNpbWV0cmljbykgew0KICAgICAgICAgICAgcHkgPSAtcHk7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoIWhhbmRsZXIocHgsIHB5KSkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGQgPD0gMCkgew0KICAgICAgICAgICAgZCArPSBpbmNFOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgZCArPSBpbmNORTsNCiAgICAgICAgICAgIHkrKzsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gdHJ1ZTsNCn0NCg0KDQptb2R1bGUuZXhwb3J0cy50cmlhbmd1bGF0ZSA9IHRyaWFuZ3VsYXRlOw0KZnVuY3Rpb24gdHJpYW5ndWxhdGUocG9seXMpIHsNCiAgICAvLyBSZW9yZGVyIHBveWdvbnMgZm9yIGVhcmN1dA0KICAgIHZhciBuZXdQb2x5cyA9IFtdOw0KICAgIHZhciBsLCBwb2x5LCBwb2x5QWxsLCBpbm5lckluZGljZXMsIGgsIGlubmVyOw0KICAgIGZvciAobCA9IDA7IGwgPCBwb2x5cy5sZW5ndGg7IGwrKykgew0KICAgICAgICBwb2x5ID0gcG9seXNbbF07DQogICAgICAgIGlubmVySW5kaWNlcyA9IFtdOw0KICAgICAgICBwb2x5QWxsID0gcG9seS5vdXRlcjsNCiAgICAgICAgZm9yIChoID0gMDsgaCA8IHBvbHkuaW5uZXJzLmxlbmd0aDsgaCsrKSB7DQogICAgICAgICAgICBpbm5lciA9IHBvbHkuaW5uZXJzW2hdOw0KICAgICAgICAgICAgaWYgKGlubmVyLmxlbmd0aCkgew0KICAgICAgICAgICAgICAgIGlubmVySW5kaWNlcy5wdXNoKHBvbHlBbGwubGVuZ3RoIC8gMik7DQogICAgICAgICAgICAgICAgcG9seUFsbCA9IHBvbHlBbGwuY29uY2F0KGlubmVyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBuZXdQb2x5cy5wdXNoKHsNCiAgICAgICAgICAgIHBvbHk6IHBvbHlBbGwsDQogICAgICAgICAgICB2ZXJ0aWNlczogZWFyY3V0KHBvbHlBbGwsIGlubmVySW5kaWNlcykNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIHJldHVybiBuZXdQb2x5czsNCn0NCg0KdmFyIFBvbHlMaW5lID0gZnVuY3Rpb24gKCkgew0KICAgIHRoaXMuaWQgPSBQb2x5TGluZS5JRCsrOw0KfTsNClBvbHlMaW5lLklEID0gMTsNClBvbHlMaW5lLnByb3RvdHlwZSA9IHsNCiAgICBpZDogMCwNCiAgICB2ZWN0aWNlczogbnVsbA0KfTsNCg0KdmFyIFZlcnRyaWNlID0gZnVuY3Rpb24gKHgsIHksIHBvbHkpIHsNCiAgICB0aGlzLmlkID0gVmVydHJpY2UuSUQrKzsNCiAgICB0aGlzLnggPSB4Ow0KICAgIHRoaXMueSA9IHk7DQogICAgdGhpcy5uZXh0ID0gdGhpczsNCiAgICB0aGlzLnByZXYgPSB0aGlzOw0KICAgIHRoaXMucG9seSA9IHBvbHk7DQp9Ow0KVmVydHJpY2UuSUQgPSAxOw0KVmVydHJpY2UucHJvdG90eXBlID0gew0KICAgIGlkOiAwLA0KICAgIHg6IDAuMCwNCiAgICB5OiAwLjAsDQogICAgbmV4dDogbnVsbCwNCiAgICBwcmV2OiBudWxsLA0KICAgIHBvbHk6IG51bGwsDQogICAgYXBwZW5kOiBmdW5jdGlvbiAodikgew0KICAgICAgICB0aGlzLnByZXYubmV4dCA9IHY7DQogICAgICAgIHYucHJldiA9IHRoaXMucHJldjsNCiAgICAgICAgdGhpcy5wcmV2ID0gdjsNCiAgICAgICAgdi5uZXh0ID0gdGhpczsNCiAgICAgICAgdi5wb2x5ID0gdGhpcy5wb2x5Ow0KICAgIH0NCn07DQoNCg0KZnVuY3Rpb24gc29ydFZlY3RvcnModmVjdHMpIHsNCiAgICB2YXIgc29ydGVkVmVjdG9ycyA9IHt9Ow0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmVjdHMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgdmFyIHYgPSB2ZWN0c1tpXTsNCiAgICAgICAgZG8gew0KICAgICAgICAgICAgdi5wb2x5LnVzZWQgPSBmYWxzZTsNCiAgICAgICAgICAgIHYuZmlyc3QgPSBmYWxzZTsNCiAgICAgICAgICAgIHZhciBrZXkgPSB2LngudG9TdHJpbmcoKTsNCiAgICAgICAgICAgIGlmICghc29ydGVkVmVjdG9ycy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7DQogICAgICAgICAgICAgICAgc29ydGVkVmVjdG9yc1trZXldID0gW3ZdOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBzb3J0ZWRWZWN0b3JzW2tleV0ucHVzaCh2KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHYgPSB2Lm5leHQ7DQogICAgICAgIH0gd2hpbGUgKHYgIT0gdmVjdHNbaV0pOw0KICAgIH0NCiAgICByZXR1cm4gc29ydGVkVmVjdG9yczsNCn0NCg0KLyoqDQogKiAgUmV0dXJuIHRydWUgaWYgY29ybmVyIHRvIHRoZSByaWdodA0KICogQHBhcmFtIHAwDQogKiBAcGFyYW0gcDENCiAqLw0KZnVuY3Rpb24gaXNDbG9ja3dpc2UocDAsIHAxLCBwMikgew0KICAgIHZhciBheCA9IHAyLnggLSBwMS54Ow0KICAgIHZhciBheSA9IHAyLnkgLSBwMS55Ow0KICAgIHZhciBieCA9IHAxLnggLSBwMC54Ow0KICAgIHZhciBieSA9IHAxLnkgLSBwMC55Ow0KICAgIHJldHVybiAoYnkgKiBheCAtIGJ4ICogYXkpIDwgLTAuMTsgLy8gRG8gbm90IHVzZSAwIGhlcmUsIHVzZSBzb21lIG1hcmdpbiBmb3Igcm91bmRpbmcgZXJyb3JzDQp9DQoNCg0KZnVuY3Rpb24gZmluZE5leHRUcmlhbmdsZShzb3J0ZWRWZWN0cywgdmVjdHMpIHsNCiAgICB2YXIgdiA9IHZlY3RzOw0KICAgIGRvIHsNCiAgICAgICAgdmFyIHhwb2ludHMgPSBzb3J0ZWRWZWN0c1t2LngudG9TdHJpbmcoKV07DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgeHBvaW50cy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgdmFyIHYxID0geHBvaW50c1tpXTsNCiAgICAgICAgICAgIGlmICghdjEucG9seS51c2VkICYmDQogICAgICAgICAgICAgICAgdi5wb2x5ICE9PSB2MS5wb2x5ICYmDQogICAgICAgICAgICAgICAgdi54ID09PSB2MS54ICYmDQogICAgICAgICAgICAgICAgdi55ID09PSB2MS55KSB7DQogICAgICAgICAgICAgICAgaWYgKHYucHJldi54ID09PSB2MS5uZXh0LnggJiYNCiAgICAgICAgICAgICAgICAgICAgdi5wcmV2LnkgPT09IHYxLm5leHQueSkgew0KICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiBjb252ZXggZm9yIGJvdGggZ2x1ZXBvaW50cw0KICAgICAgICAgICAgICAgICAgICBpZiAoaXNDbG9ja3dpc2UodjEucHJldiwgdiwgdi5uZXh0KSAmJg0KICAgICAgICAgICAgICAgICAgICAgICAgaXNDbG9ja3dpc2Uodi5wcmV2LnByZXYsIHYucHJldiwgdjEubmV4dC5uZXh0KSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdjEucG9seS51c2VkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YSA9IHYucHJldjsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2MWEgPSB2MS5uZXh0Ow0KICAgICAgICAgICAgICAgICAgICAgICAgdjFhLm5leHQucHJldiA9IHZhOw0KICAgICAgICAgICAgICAgICAgICAgICAgdmEubmV4dCA9IHYxYS5uZXh0Ow0KICAgICAgICAgICAgICAgICAgICAgICAgdjEucHJldi5uZXh0ID0gdjsNCiAgICAgICAgICAgICAgICAgICAgICAgIHYucHJldiA9IHYxLnByZXY7DQogICAgICAgICAgICAgICAgICAgICAgICBmaW5kTmV4dFRyaWFuZ2xlKHNvcnRlZFZlY3RzLCB2KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gZWxzZQ0KICAgICAgICAgICAgICAgIGlmICh2Lm5leHQueCA9PT0gdjEucHJldi54ICYmDQogICAgICAgICAgICAgICAgICAgIHYubmV4dC55ID09PSB2MS5wcmV2LnkpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzQ2xvY2t3aXNlKHYucHJldiwgdiwgdjEubmV4dCkgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgIGlzQ2xvY2t3aXNlKHYxLnByZXYucHJldiwgdjEucHJldiwgdi5uZXh0Lm5leHQpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2MS5wb2x5LnVzZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhID0gdi5uZXh0Ow0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHYxYSA9IHYxLnByZXY7DQogICAgICAgICAgICAgICAgICAgICAgICB2MWEucHJldi5uZXh0ID0gdmE7DQogICAgICAgICAgICAgICAgICAgICAgICB2YS5wcmV2ID0gdjFhLnByZXY7DQogICAgICAgICAgICAgICAgICAgICAgICB2MS5uZXh0LnByZXYgPSB2Ow0KICAgICAgICAgICAgICAgICAgICAgICAgdi5uZXh0ID0gdjEubmV4dDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbmROZXh0VHJpYW5nbGUoc29ydGVkVmVjdHMsIHYpOw0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgdiA9IHYubmV4dDsNCiAgICB9IHdoaWxlICghdi5maXJzdCk7DQp9DQoNCmZ1bmN0aW9uIGZpbmRDb252ZXgoc29ydGVkVmVjdHMpIHsNCiAgICB2YXIgY29udmV4TGlzdCA9IFtdOw0KDQogICAgZm9yICh2YXIga2V5IGluIHNvcnRlZFZlY3RzKSB7DQogICAgICAgIHZhciB4cG9pbnRzID0gc29ydGVkVmVjdHNba2V5XTsNCg0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHhwb2ludHMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHZhciB2ID0geHBvaW50c1tpXTsNCiAgICAgICAgICAgIGlmICh2LnBvbHkudXNlZCkgew0KICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLy8gU3RhcnQgbmV3IENvbnZleA0KICAgICAgICAgICAgY29udmV4TGlzdC5wdXNoKHYpOw0KICAgICAgICAgICAgdi5wb2x5LnVzZWQgPSB0cnVlOw0KICAgICAgICAgICAgdi5maXJzdCA9IHRydWU7DQogICAgICAgICAgICAvLyBGaW5kIG1hdGNoaW5nIGVkZ2UNCiAgICAgICAgICAgIGZpbmROZXh0VHJpYW5nbGUoc29ydGVkVmVjdHMsIHYpOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBjb252ZXhMaXN0Ow0KfQ0KDQpmdW5jdGlvbiBtYWtlQ2xvY2t3aXNlKHZlY3QpIHsNCiAgICB2YXIgdiA9IHZlY3Q7DQogICAgdmFyIHN1bSA9IDAuMDsNCiAgICBkbyB7DQogICAgICAgIHN1bSArPSAodi5uZXh0LnggLSB2LngpICogKHYubmV4dC55ICsgdi55KTsNCiAgICAgICAgdiA9IHYubmV4dDsNCiAgICB9IHdoaWxlICh2ICE9IHZlY3QpOw0KICAgIC8vIHdoZW4gc3VtIDwgMCBpdCBpcyBjb3VudGVyY2xvY2t3aXNlLiBCdXQgeS1heGlzIHBvaW50cyBkb3dud2FyZHMgc28gbWlycm9yZWQgbWFrZXMgaXQgY2xvY2t3aXNlDQogICAgaWYgKHN1bSA+IDApIHsNCiAgICAgICAgLy8gY291bnRlcmNsb2Nrd2lzZTogdHVybiBhcm91bmQNCiAgICAgICAgdiA9IHZlY3Q7DQogICAgICAgIHZhciB2MiA9IG5ldyBWZXJ0cmljZSh2LngsIHYueSwgdi5wb2x5KTsNCiAgICAgICAgZG8gew0KICAgICAgICAgICAgdjIuYXBwZW5kKG5ldyBWZXJ0cmljZSh2LnByZXYueCwgdi5wcmV2LnksIHYucHJldi5wb2x5KSk7DQogICAgICAgICAgICB2ID0gdi5wcmV2Ow0KICAgICAgICB9IHdoaWxlICh2ICE9IHZlY3QpOw0KICAgICAgICByZXR1cm4gdjI7DQogICAgfQ0KICAgIHJldHVybiB2ZWN0Ow0KfQ0KDQovLyBUcnkgdG8gbWFrZSBjb252ZXggcG9seWxpbmVzIGZyb20gdHJpYW5nbGVzIGJ5IG1lcmdpbmcgdHJpYW5nbGVzIGFzIGxvbmcNCi8vIGFzIGl0IHN0YXlzIGEgY29udmV4LiBPcHRpbWl6ZWQgYnkgc29ydGluZyBhbGwgdmVydGljZXMgYnkgaXRzIHgtY29vcmRpbmF0ZS4NCi8vIEludGVybmFsbHkgYSB2ZXJ0cmljZSBsaW5rZWQgbGlzdCBpcyB1c2VkLg0KbW9kdWxlLmV4cG9ydHMudHJpYW5nbGVzVG9Db252ZXggPSB0cmlhbmdsZXNUb0NvbnZleDsNCmZ1bmN0aW9uIHRyaWFuZ2xlc1RvQ29udmV4KHRyaWFuZ2xlcykgew0KICAgIHZhciBzaGFwZXMgPSBbXTsNCiAgICBmb3IgKHZhciBsID0gMDsgbCA8IHRyaWFuZ2xlcy5sZW5ndGg7IGwrKykgew0KICAgICAgICB2YXIgbGluZSA9IHRyaWFuZ2xlc1tsXS5wb2x5Ow0KICAgICAgICB2YXIgdmVydGljZXMgPSBbXTsNCiAgICAgICAgdmFyIHYgPSB0cmlhbmdsZXNbbF0udmVydGljZXM7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdi5sZW5ndGg7IGkgKz0gMykgew0KICAgICAgICAgICAgdmFyIHBvbHkgPSBuZXcgUG9seUxpbmUoKTsNCiAgICAgICAgICAgIHBvbHkudmVydGljZXMgPSBuZXcgVmVydHJpY2UobGluZVt2W2ldICogMl0sIGxpbmVbdltpXSAqIDIgKyAxXSwgcG9seSk7DQogICAgICAgICAgICBwb2x5LnZlcnRpY2VzLmFwcGVuZChuZXcgVmVydHJpY2UobGluZVt2W2kgKyAxXSAqIDJdLCBsaW5lW3ZbaSArIDFdICogMiArIDFdKSk7DQogICAgICAgICAgICBwb2x5LnZlcnRpY2VzLmFwcGVuZChuZXcgVmVydHJpY2UobGluZVt2W2kgKyAyXSAqIDJdLCBsaW5lW3ZbaSArIDJdICogMiArIDFdKSk7DQogICAgICAgICAgICBwb2x5LnZlcnRpY2VzID0gbWFrZUNsb2Nrd2lzZShwb2x5LnZlcnRpY2VzKTsNCiAgICAgICAgICAgIHZlcnRpY2VzLnB1c2gocG9seS52ZXJ0aWNlcyk7DQogICAgICAgIH0NCiAgICAgICAgdmFyIHNvcnRlZFZlY3RzID0gc29ydFZlY3RvcnModmVydGljZXMpOw0KICAgICAgICB2YXIgY29udmV4TGlzdCA9IGZpbmRDb252ZXgoc29ydGVkVmVjdHMpOw0KDQogICAgICAgIHNoYXBlcy5wdXNoKGNvbnZleExpc3QpOw0KICAgIH0NCiAgICByZXR1cm4gc2hhcGVzOw0KfQ0KDQptb2R1bGUuZXhwb3J0cy5jb252ZXhUb0FycmF5ID0gY29udmV4VG9BcnJheTsNCmZ1bmN0aW9uIGNvbnZleFRvQXJyYXkoY29udmV4TGlzdHMsIG9mZnNldCkgew0KICAgIHZhciBpLCBsLCBjb252ZXhMaXN0LCBpbmRleCwgdiwgYXJyYXksDQogICAgICAgIHZlcnRpY2VzTGVuZ3RoUG9zLCBzaGFwZUNvdW50Ow0KDQogICAgaW5kZXggPSAxOyAvLyBmaXJzdCBwb3NpdGlvbiBpcyBmb3Igc2hhcGUgY291bnQNCiAgICBmb3IgKGwgPSAwOyBsIDwgY29udmV4TGlzdHMubGVuZ3RoOyBsKyspIHsNCiAgICAgICAgY29udmV4TGlzdCA9IGNvbnZleExpc3RzW2xdOw0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY29udmV4TGlzdC5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgdiA9IGNvbnZleExpc3RbaV07DQogICAgICAgICAgICBpbmRleCsrOyAvLyBwb3NpdGlvbiBmb3IgdmVydGljZXMgbGVuZ3RoDQogICAgICAgICAgICBkbyB7DQogICAgICAgICAgICAgICAgaW5kZXggKz0gMjsgLy8geCBhbmQgeSBwb3NpdGlvbg0KICAgICAgICAgICAgICAgIHYgPSB2Lm5leHQ7DQogICAgICAgICAgICB9IHdoaWxlICh2ICE9IGNvbnZleExpc3RbaV0pOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgYXJyYXkgPSBuZXcgRmxvYXQzMkFycmF5KGluZGV4KTsNCiAgICBpbmRleCA9IDE7DQogICAgc2hhcGVDb3VudCA9IDA7DQogICAgZm9yIChsID0gMDsgbCA8IGNvbnZleExpc3RzLmxlbmd0aDsgbCsrKSB7DQogICAgICAgIGNvbnZleExpc3QgPSBjb252ZXhMaXN0c1tsXTsNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IGNvbnZleExpc3QubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHZlcnRpY2VzTGVuZ3RoUG9zID0gaW5kZXgrKzsNCiAgICAgICAgICAgIHYgPSBjb252ZXhMaXN0W2ldOw0KICAgICAgICAgICAgZG8gew0KICAgICAgICAgICAgICAgIGFycmF5W2luZGV4KytdID0gdi54ICsgb2Zmc2V0Ow0KICAgICAgICAgICAgICAgIGFycmF5W2luZGV4KytdID0gdi55ICsgb2Zmc2V0Ow0KICAgICAgICAgICAgICAgIHYgPSB2Lm5leHQ7DQogICAgICAgICAgICB9IHdoaWxlICh2ICE9IGNvbnZleExpc3RbaV0pOw0KICAgICAgICAgICAgYXJyYXlbdmVydGljZXNMZW5ndGhQb3NdID0gKGluZGV4IC0gdmVydGljZXNMZW5ndGhQb3MgLSAxKSAvIDI7DQogICAgICAgICAgICBzaGFwZUNvdW50ICs9IDE7DQogICAgICAgIH0NCiAgICB9DQogICAgYXJyYXlbMF0gPSBzaGFwZUNvdW50Ow0KICAgIHJldHVybiBhcnJheTsNCn0NCg0KLy9URVNUDQptb2R1bGUuZXhwb3J0cy5zaG93VHJhY2VkSW1hZ2UgPSBzaG93VHJhY2VkSW1hZ2U7DQpmdW5jdGlvbiBzaG93VHJhY2VkSW1hZ2UoaW1nRGF0YSwgcG9seXMsIHpvb20pIHsNCiAgICBpZiAodHlwZW9mIGRvY3VtZW50ID09PSAndW5kZWZpbmVkJykgcmV0dXJuOw0KICAgIA0KICAgIHZhciB6ID0gem9vbSB8fCA1Ow0KICAgIHZhciB6bCA9IHo7DQogICAgdmFyIHN0ZXAgPSAzOw0KDQogICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOw0KICAgIGNhbnZhcy53aWR0aCA9IGltZ0RhdGEudyAqIHo7DQogICAgY2FudmFzLmhlaWdodCA9IGltZ0RhdGEuaCAqIHo7DQogICAgdmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOw0KICAgIHZhciB4LA0KICAgICAgICB5LA0KICAgICAgICBwLA0KICAgICAgICBpOw0KICAgIGN0eC5maWxsU3R5bGUgPSAncmdiYSgwLCAwLCAxMjgsIDAuMyknOw0KICAgIGZvciAoeCA9IDA7IHggPCBpbWdEYXRhLnc7IHgrKykgew0KICAgICAgICBmb3IgKHkgPSAwOyB5IDwgaW1nRGF0YS5oOyB5KyspIHsNCiAgICAgICAgICAgIHAgPSBpbWdEYXRhLmRhdGFbeCArIGltZ0RhdGEudyAqIHldOw0KICAgICAgICAgICAgaWYgKHAgJiAweGZmKSB7DQogICAgICAgICAgICAgICAgY3R4LmZpbGxSZWN0KHggKiB6LCB5ICogeiwgeiwgeik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBkcmF3TGluZShwb2x5KSB7DQogICAgICAgIHZhciBpc0ZpcnN0ID0gdHJ1ZTsNCiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOw0KICAgICAgICBmb3IgKHZhciBsMiA9IDA7IGwyIDwgcG9seS5sZW5ndGg7IGwyICs9IHN0ZXApIHsNCiAgICAgICAgICAgIHggPSAocG9seVtsMl0gKyAwLjUpICogemw7DQogICAgICAgICAgICB5ID0gKHBvbHlbbDIgKyAxXSArIDAuNSkgKiB6bDsNCiAgICAgICAgICAgIGlmIChpc0ZpcnN0KSB7DQogICAgICAgICAgICAgICAgY3R4Lm1vdmVUbyh4LCB5KTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgY3R4LmxpbmVUbyh4LCB5KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlzRmlyc3QgPSBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBjdHguZmlsbCgpOw0KICAgICAgICBjdHguc3Ryb2tlKCk7DQogICAgfQ0KDQogICAgaWYgKHBvbHlzKSB7DQogICAgICAgIGN0eC5zdHJva2VTdHlsZSA9ICdibHVlJzsNCiAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICdyZ2JhKDI1NSwgMCwgMCwgMCknOw0KDQogICAgICAgIGZvciAodmFyIGwxID0gMDsgbDEgPCBwb2x5cy5sZW5ndGg7IGwxKyspIHsNCiAgICAgICAgICAgIHZhciBwb2x5ID0gcG9seXNbbDFdOw0KICAgICAgICAgICAgaWYgKHBvbHkuaGFzT3duUHJvcGVydHkoJ291dGVyJykpIHsNCiAgICAgICAgICAgICAgICBkcmF3TGluZShwb2x5Lm91dGVyKTsNCiAgICAgICAgICAgICAgICBmb3IgKHZhciBoID0gMDsgaCA8IHBvbHkuaW5uZXJzLmxlbmd0aDsgaCsrKSB7DQogICAgICAgICAgICAgICAgICAgIGRyYXdMaW5lKHBvbHkuaW5uZXJzW2hdKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGRyYXdMaW5lKHBvbHkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY2FudmFzKTsNCn0NCg0KbW9kdWxlLmV4cG9ydHMuc2hvd1NpbXBsaWZpZWQgPSBzaG93U2ltcGxpZmllZDsNCmZ1bmN0aW9uIHNob3dTaW1wbGlmaWVkKGltZ0RhdGEsIHBvbHlzLCB6b29tKSB7DQogICAgaWYgKHR5cGVvZiBkb2N1bWVudCA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybjsNCiAgICB2YXIgeiA9ICh6b29tIHx8IDEpOw0KICAgIHZhciB6bCA9IHogKiBpbWdEYXRhLnNpbXBsaWZ5Wm9vbTsNCiAgICB2YXIgc3RlcCA9IDI7DQoNCiAgICB2YXIgeCwNCiAgICAgICAgeSwNCiAgICAgICAgcCwNCiAgICAgICAgaSwNCiAgICAgICAgdyA9IGltZ0RhdGEudyAqIGltZ0RhdGEuc2ltcGxpZnlab29tLA0KICAgICAgICBoID0gaW1nRGF0YS5oICogaW1nRGF0YS5zaW1wbGlmeVpvb207DQogICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOw0KICAgIGNhbnZhcy53aWR0aCA9IHcgKiB6Ow0KICAgIGNhbnZhcy5oZWlnaHQgPSBoICogejsNCiAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7DQoNCiAgICBmb3IgKHggPSAwOyB4IDwgdzsgeCsrKSB7DQogICAgICAgIGZvciAoeSA9IDA7IHkgPCBoOyB5KyspIHsNCiAgICAgICAgICAgIHAgPSBpbWdEYXRhLmRhdGFbeCArIHcgKiB5XTsNCiAgICAgICAgICAgIGlmIChwKSB7DQogICAgICAgICAgICAgICAgLy8gPVANCiAgICAgICAgICAgICAgICBwID0gMjU1IC0gcDsNCiAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJ3JnYignICsgW3AsIHAsIHBdLmpvaW4oJywnKSArICcpJzsNCiAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QoeCAqIHosIHkgKiB6LCB6LCB6KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGRyYXdMaW5lKHBvbHkpIHsNCiAgICAgICAgdmFyIGlzRmlyc3QgPSB0cnVlOw0KICAgICAgICBjdHguYmVnaW5QYXRoKCk7DQogICAgICAgIGZvciAodmFyIGwyID0gMDsgbDIgPCBwb2x5Lmxlbmd0aDsgbDIgKz0gc3RlcCkgew0KICAgICAgICAgICAgeCA9IChwb2x5W2wyXSArIDAuNSkgKiB6bDsNCiAgICAgICAgICAgIHkgPSAocG9seVtsMiArIDFdICsgMC41KSAqIHpsOw0KICAgICAgICAgICAgaWYgKGlzRmlyc3QpIHsNCiAgICAgICAgICAgICAgICBjdHgubW92ZVRvKHgsIHkpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBjdHgubGluZVRvKHgsIHkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaXNGaXJzdCA9IGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIGN0eC5zdHJva2UoKTsNCiAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICdyZ2JhKDI1NSwgMCwgMCwgMC4zKSc7DQogICAgICAgIGZvciAobDIgPSAwOyBsMiA8IHBvbHkubGVuZ3RoOyBsMiArPSBzdGVwKSB7DQogICAgICAgICAgICB4ID0gKHBvbHlbbDJdICsgMC41KSAqIHpsOw0KICAgICAgICAgICAgeSA9IChwb2x5W2wyICsgMV0gKyAwLjUpICogemw7DQogICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7DQogICAgICAgICAgICBjdHguYXJjKHgsIHksIDEwLCAwLCAyICogTWF0aC5QSSwgZmFsc2UpOw0KICAgICAgICAgICAgY3R4LmZpbGwoKTsNCiAgICAgICAgICAgIGN0eC5zdHJva2UoKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGlmIChwb2x5cykgew0KICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAncmdiKDI1NSwgMCwgMjU1KSc7DQogICAgICAgIGN0eC5maWxsU3R5bGUgPSAncmdiYSgyNTUsIDAsIDAsIDApJzsNCg0KICAgICAgICBmb3IgKHZhciBsMSA9IDA7IGwxIDwgcG9seXMubGVuZ3RoOyBsMSsrKSB7DQogICAgICAgICAgICB2YXIgcG9seSA9IHBvbHlzW2wxXTsNCiAgICAgICAgICAgIGlmIChwb2x5Lmhhc093blByb3BlcnR5KCdvdXRlcicpKSB7DQogICAgICAgICAgICAgICAgZHJhd0xpbmUocG9seS5vdXRlcik7DQogICAgICAgICAgICAgICAgZm9yICh2YXIgaCA9IDA7IGggPCBwb2x5LmlubmVycy5sZW5ndGg7IGgrKykgew0KICAgICAgICAgICAgICAgICAgICBkcmF3TGluZShwb2x5LmlubmVyc1toXSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBkcmF3TGluZShwb2x5KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGNhbnZhcyk7DQp9DQoNCm1vZHVsZS5leHBvcnRzLnNob3dWZXJ0aWNlcyA9IHNob3dWZXJ0aWNlczsNCmZ1bmN0aW9uIHNob3dWZXJ0aWNlcyh2ZXJ0aWNlcywgdywgaCwgeikgew0KICAgIGlmICh0eXBlb2YgZG9jdW1lbnQgPT09ICd1bmRlZmluZWQnKSByZXR1cm47DQogICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOw0KDQogICAgY2FudmFzLndpZHRoID0gdyAqIHo7DQogICAgY2FudmFzLmhlaWdodCA9IGggKiB6Ow0KICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsNCiAgICBjdHguc3Ryb2tlU3R5bGUgPSAncmdiYSgwLDAsMjU1LDAuMyknOw0KICAgIGN0eC5maWxsU3R5bGUgPSAncmdiYSgyNTUsMCwwLDAuMyknOw0KICAgIHZhciBsLCBsaW5lLCB2LCBpOw0KICAgIGZvciAobCA9IDA7IGwgPCB2ZXJ0aWNlcy5sZW5ndGg7IGwrKykgew0KICAgICAgICBsaW5lID0gdmVydGljZXNbbF0ucG9seTsNCiAgICAgICAgdiA9IHZlcnRpY2VzW2xdLnZlcnRpY2VzOw0KDQogICAgICAgIGZvciAoaSA9IDA7IGkgPCB2Lmxlbmd0aDsgaSArPSAzKSB7DQogICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7DQogICAgICAgICAgICBjdHgubW92ZVRvKGxpbmVbdltpXSAqIDJdICogeiwgbGluZVt2W2ldICogMiArIDFdICogeik7DQogICAgICAgICAgICBjdHgubGluZVRvKGxpbmVbdltpICsgMV0gKiAyXSAqIHosIGxpbmVbdltpICsgMV0gKiAyICsgMV0gKiB6KTsNCiAgICAgICAgICAgIGN0eC5saW5lVG8obGluZVt2W2kgKyAyXSAqIDJdICogeiwgbGluZVt2W2kgKyAyXSAqIDIgKyAxXSAqIHopOw0KICAgICAgICAgICAgY3R4LmxpbmVUbyhsaW5lW3ZbaV0gKiAyXSAqIHosIGxpbmVbdltpXSAqIDIgKyAxXSAqIHopOw0KICAgICAgICAgICAgY3R4LmZpbGwoKTsNCiAgICAgICAgICAgIGN0eC5zdHJva2UoKTsNCiAgICAgICAgfQ0KDQogICAgfQ0KICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY2FudmFzKTsNCn0NCm1vZHVsZS5leHBvcnRzLnNob3dDb252ZXggPSBzaG93Q29udmV4Ow0KZnVuY3Rpb24gc2hvd0NvbnZleChzaGFwZXMsIHcsIGgsIHopIHsNCiAgICBpZiAodHlwZW9mIGRvY3VtZW50ID09PSAndW5kZWZpbmVkJykgcmV0dXJuOw0KICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsNCg0KICAgIGNhbnZhcy53aWR0aCA9IHcgKiB6Ow0KICAgIGNhbnZhcy5oZWlnaHQgPSBoICogejsNCiAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7DQogICAgY3R4LnN0cm9rZVN0eWxlID0gJ3JnYmEoMjU1LDAsMCwwLjMpJzsNCiAgICBjdHguZmlsbFN0eWxlID0gJ3JnYmEoMTI4LDEyOCwxMjgsMC4yKSc7DQogICAgY3R4LmxpbmVXaWR0aCA9IHo7DQogICAgdmFyIGw7DQogICAgZm9yIChsID0gMDsgbCA8IHNoYXBlcy5sZW5ndGg7IGwrKykgew0KICAgICAgICB2YXIgdmVjdCA9IHNoYXBlc1tsXTsNCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2ZWN0Lmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7DQogICAgICAgICAgICBjdHgubGluZUNhcCA9ICdyb3VuZCc7DQogICAgICAgICAgICBjdHgubGluZUpvaW4gPSAncm91bmQnOw0KICAgICAgICAgICAgdmFyIGZpcnN0ID0gdHJ1ZTsNCiAgICAgICAgICAgIHZhciB2ID0gdmVjdFtpXTsNCiAgICAgICAgICAgIGRvIHsNCiAgICAgICAgICAgICAgICBpZiAoZmlyc3QpIHsNCiAgICAgICAgICAgICAgICAgICAgY3R4Lm1vdmVUbyh2LnggKiB6LCB2LnkgKiB6KTsNCiAgICAgICAgICAgICAgICAgICAgZmlyc3QgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjdHgubGluZVRvKHYueCAqIHosIHYueSAqIHopOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB2ID0gdi5uZXh0Ow0KICAgICAgICAgICAgfSB3aGlsZSAodiAhPSB2ZWN0W2ldKTsNCiAgICAgICAgICAgIGN0eC5saW5lVG8odi54ICogeiwgdi55ICogeik7DQogICAgICAgICAgICBjdHguZmlsbCgpOw0KICAgICAgICAgICAgY3R4LnN0cm9rZSgpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY2FudmFzKTsNCn0NCg0KbW9kdWxlLmV4cG9ydHMuc2hvd1BoeXMyZFNoYXBlcyA9IHNob3dQaHlzMmRTaGFwZXM7DQpmdW5jdGlvbiBzaG93UGh5czJkU2hhcGVzKHNoYXBlcykgew0KICAgIGlmICh0eXBlb2YgZG9jdW1lbnQgPT09ICd1bmRlZmluZWQnKSByZXR1cm47DQogICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOw0KICAgIGNhbnZhcy53aWR0aCA9IDEwMDA7DQogICAgY2FudmFzLmhlaWdodCA9IDEwMDA7DQoNCiAgICB2YXIgd29ybGQgPSBlbmdpbmUuY3JlYXRlV29ybGQoe2dyYXZpdHk6IFswLCAxMF19KTsNCiAgICB3b3JsZC5jbGVhcigpOw0KICAgIHZhciBoYW5kUmVmZXJlbmNlQm9keSA9IGVuZ2luZS5jcmVhdGVSaWdpZEJvZHkoew0KICAgICAgICB0eXBlOiAnc3RhdGljJw0KICAgIH0pOw0KICAgIHdvcmxkLmFkZFJpZ2lkQm9keShoYW5kUmVmZXJlbmNlQm9keSk7DQoNCiAgICB2YXIgYm9keSA9IGVuZ2luZS5jcmVhdGVSaWdpZEJvZHkoew0KICAgICAgICB0eXBlOiAnc3RhdGljJywNCiAgICAgICAgc2hhcGVzOiBzaGFwZXMsDQogICAgICAgIHBvc2l0aW9uOiBbMCwgMF0NCiAgICB9KTsNCiAgICB3b3JsZC5hZGRSaWdpZEJvZHkoYm9keSk7DQogICAgd29ybGQuc3RlcCgwKTsNCiAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7DQogICAgdmFyIHNjYWxlID0gMC4wMjU7DQogICAgZm9yICh2YXIgcyA9IDA7IHMgPCBib2R5LnNoYXBlcy5sZW5ndGg7IHMrKykgew0KICAgICAgICB2YXIgc2hhcGUgPSBib2R5LnNoYXBlc1tzXTsNCiAgICAgICAgdmFyIHBkYXRhID0gc2hhcGUuX2RhdGE7DQogICAgICAgIHZhciBmaXJzdFggPSBudWxsLCBmaXJzdFkgPSBudWxsOw0KICAgICAgICBmb3IgKHZhciBpID0gNjsgaSA8IHBkYXRhLmxlbmd0aDsgaSArPSAxMykgew0KICAgICAgICAgICAgdmFyIHggPSBwZGF0YVtpICsgMl0gLyBzY2FsZTsNCiAgICAgICAgICAgIHZhciB5ID0gcGRhdGFbaSArIDNdIC8gc2NhbGU7DQogICAgICAgICAgICBpZiAoZmlyc3RYID09PSBudWxsKSB7DQogICAgICAgICAgICAgICAgZmlyc3RYID0geDsNCiAgICAgICAgICAgICAgICBmaXJzdFkgPSB5Ow0KICAgICAgICAgICAgICAgIGN0eC5tb3ZlVG8oeCwgeSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGN0eC5saW5lVG8oeCwgeSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgY3R4LmxpbmVUbyhmaXJzdFgsIGZpcnN0WSk7DQogICAgICAgIGN0eC5zdHJva2UoKTsNCiAgICB9DQogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjYW52YXMpOw0KfQ0KDQovL2lmICh0eXBlb2YgcnVuVGVzdCAhPT0gJ3VuZGVmaW5lZCcpIHsNCi8vICAgIHZhciBlbmdpbmUgPSBQaHlzaWNzMkREZXZpY2UuY3JlYXRlKCk7DQovLw0KLy8gICAgd2luZG93LmVhcmN1dCA9IHJlcXVpcmUoJy4uL21pc2MvZWFyY3V0X3dyYXBwZWQnKSgpOw0KLy8gICAgdmFyIEltYWdlVHJhY2VyID0gcmVxdWlyZSgnLi4vbWlzYy90cmFjZXJ3b3JrZXJzJyk7DQovLyAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7DQovLyAgICBpbWcub25sb2FkID0gZnVuY3Rpb24oKSB7DQovLyAgICAgICAgdmFyIGltZ0RhdGEgPSBJbWFnZVRyYWNlci5nZXRJbWFnZURhdGEoaW1nLCAyLCAxMDAwICogMTAwMCk7DQovLyAgICAgICAgaW1nRGF0YS53ZWFrbHlTaW1wbGUgPSBmYWxzZTsNCi8vICAgICAgICB2YXIgYXJyYXkgPSB0cmFjZUFuZENvbnZleGlmeShpbWdEYXRhKVswXTsNCi8vICAgICAgICB2YXIgc2hhcGVzID0gYXJyYXlUb1BvbHlnb25TaGFwZXMoZW5naW5lLCBhcnJheSwgMC4wMjUpOw0KLy8gICAgICAgIHNob3dQaHlzMmRTaGFwZXMoc2hhcGVzKTsNCi8vICAgIH07DQovLyAgICBpbWcuc3JjID0gc3JjOw0KLy99DQovL19URVNUDQp9KTsidXNlIHN0cmljdCI7DQpsZXQgdHJhY2VBbmRDb252ZXhpZnkgPSByZXF1aXJlKCcuL2NvZGVjYWJfdHJhY2VyJykudHJhY2VBbmRDb252ZXhpZnk7DQoNCnZhciBtZSA9IHNlbGYgfHwge307DQptZS5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZSkgew0KICAgIHZhciBkYXRhID0gZS5kYXRhOw0KICAgIHZhciByZXN1bHRMaXN0ID0gbnVsbDsNCiAgICB2YXIgZXJyb3JNZXNzYWdlID0gbnVsbDsNCg0KICAgIHRyeSB7DQogICAgICAgIHJlc3VsdExpc3QgPSBkb0NvbW1hbmQoZGF0YSk7DQogICAgfSBjYXRjaCAoZXJyKSB7DQogICAgICAgIHJlc3VsdExpc3QgPSBbXTsNCiAgICAgICAgZXJyb3JNZXNzYWdlID0gZXJyLm1lc3NhZ2U7DQogICAgfQ0KDQogICAgdmFyIHJlc3VsdFRyYW5zZmVyTGlzdCA9IFtdOw0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVzdWx0TGlzdC5sZW5ndGg7IGkrKykgew0KICAgICAgICByZXN1bHRUcmFuc2Zlckxpc3QucHVzaChyZXN1bHRMaXN0W2ldLmJ1ZmZlcik7DQogICAgfQ0KICAgIHZhciByZXR1cm5EYXRhID0gew0KICAgICAgICB0aWNrZXQ6IGRhdGEudGlja2V0LA0KICAgICAgICByZXN1bHRMaXN0OiByZXN1bHRMaXN0LA0KICAgICAgICBlcnJNc2c6IGVycm9yTWVzc2FnZSwNCiAgICAgICAgd29ya2VySWQ6IGRhdGEud29ya2VySWQNCiAgICB9Ow0KICAgIG1lLnBvc3RNZXNzYWdlKHJldHVybkRhdGEsIHJlc3VsdFRyYW5zZmVyTGlzdCk7DQogICAgcmV0dXJuIHJldHVybkRhdGE7DQoNCn07DQoNCmZ1bmN0aW9uIGRvQ29tbWFuZChkYXRhKSB7DQogICAgaWYgKGRhdGEuY21kID09PSAndHJhY2VBbmRDb252ZXhpZnknKSB7DQogICAgICAgIHJldHVybiB0cmFjZUFuZENvbnZleGlmeShkYXRhLmltZ0RhdGEpOw0KICAgIH0NCiAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gY29tbWFuZCAiICsgZGF0YS5jbWQpOw0KfQ0K';
export default src;