"use strict";
let s='KGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT0iZnVuY3Rpb24iJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKCJDYW5ub3QgZmluZCBtb2R1bGUgJyIrbysiJyIpO3Rocm93IGYuY29kZT0iTU9EVUxFX05PVF9GT1VORCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT0iZnVuY3Rpb24iJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSh7MTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCm1vZHVsZS5leHBvcnRzID0gZWFyY3V0Owptb2R1bGUuZXhwb3J0cy5kZWZhdWx0ID0gZWFyY3V0OwoKZnVuY3Rpb24gZWFyY3V0KGRhdGEsIGhvbGVJbmRpY2VzLCBkaW0pIHsKCiAgICBkaW0gPSBkaW0gfHwgMjsKCiAgICB2YXIgaGFzSG9sZXMgPSBob2xlSW5kaWNlcyAmJiBob2xlSW5kaWNlcy5sZW5ndGgsCiAgICAgICAgb3V0ZXJMZW4gPSBoYXNIb2xlcyA/IGhvbGVJbmRpY2VzWzBdICogZGltIDogZGF0YS5sZW5ndGgsCiAgICAgICAgb3V0ZXJOb2RlID0gbGlua2VkTGlzdChkYXRhLCAwLCBvdXRlckxlbiwgZGltLCB0cnVlKSwKICAgICAgICB0cmlhbmdsZXMgPSBbXTsKCiAgICBpZiAoIW91dGVyTm9kZSkgcmV0dXJuIHRyaWFuZ2xlczsKCiAgICB2YXIgbWluWCwgbWluWSwgbWF4WCwgbWF4WSwgeCwgeSwgaW52U2l6ZTsKCiAgICBpZiAoaGFzSG9sZXMpIG91dGVyTm9kZSA9IGVsaW1pbmF0ZUhvbGVzKGRhdGEsIGhvbGVJbmRpY2VzLCBvdXRlck5vZGUsIGRpbSk7CgogICAgLy8gaWYgdGhlIHNoYXBlIGlzIG5vdCB0b28gc2ltcGxlLCB3ZSdsbCB1c2Ugei1vcmRlciBjdXJ2ZSBoYXNoIGxhdGVyOyBjYWxjdWxhdGUgcG9seWdvbiBiYm94CiAgICBpZiAoZGF0YS5sZW5ndGggPiA4MCAqIGRpbSkgewogICAgICAgIG1pblggPSBtYXhYID0gZGF0YVswXTsKICAgICAgICBtaW5ZID0gbWF4WSA9IGRhdGFbMV07CgogICAgICAgIGZvciAodmFyIGkgPSBkaW07IGkgPCBvdXRlckxlbjsgaSArPSBkaW0pIHsKICAgICAgICAgICAgeCA9IGRhdGFbaV07CiAgICAgICAgICAgIHkgPSBkYXRhW2kgKyAxXTsKICAgICAgICAgICAgaWYgKHggPCBtaW5YKSBtaW5YID0geDsKICAgICAgICAgICAgaWYgKHkgPCBtaW5ZKSBtaW5ZID0geTsKICAgICAgICAgICAgaWYgKHggPiBtYXhYKSBtYXhYID0geDsKICAgICAgICAgICAgaWYgKHkgPiBtYXhZKSBtYXhZID0geTsKICAgICAgICB9CgogICAgICAgIC8vIG1pblgsIG1pblkgYW5kIGludlNpemUgYXJlIGxhdGVyIHVzZWQgdG8gdHJhbnNmb3JtIGNvb3JkcyBpbnRvIGludGVnZXJzIGZvciB6LW9yZGVyIGNhbGN1bGF0aW9uCiAgICAgICAgaW52U2l6ZSA9IE1hdGgubWF4KG1heFggLSBtaW5YLCBtYXhZIC0gbWluWSk7CiAgICAgICAgaW52U2l6ZSA9IGludlNpemUgIT09IDAgPyAxIC8gaW52U2l6ZSA6IDA7CiAgICB9CgogICAgZWFyY3V0TGlua2VkKG91dGVyTm9kZSwgdHJpYW5nbGVzLCBkaW0sIG1pblgsIG1pblksIGludlNpemUpOwoKICAgIHJldHVybiB0cmlhbmdsZXM7Cn0KCi8vIGNyZWF0ZSBhIGNpcmN1bGFyIGRvdWJseSBsaW5rZWQgbGlzdCBmcm9tIHBvbHlnb24gcG9pbnRzIGluIHRoZSBzcGVjaWZpZWQgd2luZGluZyBvcmRlcgpmdW5jdGlvbiBsaW5rZWRMaXN0KGRhdGEsIHN0YXJ0LCBlbmQsIGRpbSwgY2xvY2t3aXNlKSB7CiAgICB2YXIgaSwgbGFzdDsKCiAgICBpZiAoY2xvY2t3aXNlID09PSAoc2lnbmVkQXJlYShkYXRhLCBzdGFydCwgZW5kLCBkaW0pID4gMCkpIHsKICAgICAgICBmb3IgKGkgPSBzdGFydDsgaSA8IGVuZDsgaSArPSBkaW0pIGxhc3QgPSBpbnNlcnROb2RlKGksIGRhdGFbaV0sIGRhdGFbaSArIDFdLCBsYXN0KTsKICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChpID0gZW5kIC0gZGltOyBpID49IHN0YXJ0OyBpIC09IGRpbSkgbGFzdCA9IGluc2VydE5vZGUoaSwgZGF0YVtpXSwgZGF0YVtpICsgMV0sIGxhc3QpOwogICAgfQoKICAgIGlmIChsYXN0ICYmIGVxdWFscyhsYXN0LCBsYXN0Lm5leHQpKSB7CiAgICAgICAgcmVtb3ZlTm9kZShsYXN0KTsKICAgICAgICBsYXN0ID0gbGFzdC5uZXh0OwogICAgfQoKICAgIHJldHVybiBsYXN0Owp9CgovLyBlbGltaW5hdGUgY29saW5lYXIgb3IgZHVwbGljYXRlIHBvaW50cwpmdW5jdGlvbiBmaWx0ZXJQb2ludHMoc3RhcnQsIGVuZCkgewogICAgaWYgKCFzdGFydCkgcmV0dXJuIHN0YXJ0OwogICAgaWYgKCFlbmQpIGVuZCA9IHN0YXJ0OwoKICAgIHZhciBwID0gc3RhcnQsCiAgICAgICAgYWdhaW47CiAgICBkbyB7CiAgICAgICAgYWdhaW4gPSBmYWxzZTsKCiAgICAgICAgaWYgKCFwLnN0ZWluZXIgJiYgKGVxdWFscyhwLCBwLm5leHQpIHx8IGFyZWEocC5wcmV2LCBwLCBwLm5leHQpID09PSAwKSkgewogICAgICAgICAgICByZW1vdmVOb2RlKHApOwogICAgICAgICAgICBwID0gZW5kID0gcC5wcmV2OwogICAgICAgICAgICBpZiAocCA9PT0gcC5uZXh0KSBicmVhazsKICAgICAgICAgICAgYWdhaW4gPSB0cnVlOwoKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwID0gcC5uZXh0OwogICAgICAgIH0KICAgIH0gd2hpbGUgKGFnYWluIHx8IHAgIT09IGVuZCk7CgogICAgcmV0dXJuIGVuZDsKfQoKLy8gbWFpbiBlYXIgc2xpY2luZyBsb29wIHdoaWNoIHRyaWFuZ3VsYXRlcyBhIHBvbHlnb24gKGdpdmVuIGFzIGEgbGlua2VkIGxpc3QpCmZ1bmN0aW9uIGVhcmN1dExpbmtlZChlYXIsIHRyaWFuZ2xlcywgZGltLCBtaW5YLCBtaW5ZLCBpbnZTaXplLCBwYXNzKSB7CiAgICBpZiAoIWVhcikgcmV0dXJuOwoKICAgIC8vIGludGVybGluayBwb2x5Z29uIG5vZGVzIGluIHotb3JkZXIKICAgIGlmICghcGFzcyAmJiBpbnZTaXplKSBpbmRleEN1cnZlKGVhciwgbWluWCwgbWluWSwgaW52U2l6ZSk7CgogICAgdmFyIHN0b3AgPSBlYXIsCiAgICAgICAgcHJldiwgbmV4dDsKCiAgICAvLyBpdGVyYXRlIHRocm91Z2ggZWFycywgc2xpY2luZyB0aGVtIG9uZSBieSBvbmUKICAgIHdoaWxlIChlYXIucHJldiAhPT0gZWFyLm5leHQpIHsKICAgICAgICBwcmV2ID0gZWFyLnByZXY7CiAgICAgICAgbmV4dCA9IGVhci5uZXh0OwoKICAgICAgICBpZiAoaW52U2l6ZSA/IGlzRWFySGFzaGVkKGVhciwgbWluWCwgbWluWSwgaW52U2l6ZSkgOiBpc0VhcihlYXIpKSB7CiAgICAgICAgICAgIC8vIGN1dCBvZmYgdGhlIHRyaWFuZ2xlCiAgICAgICAgICAgIHRyaWFuZ2xlcy5wdXNoKHByZXYuaSAvIGRpbSk7CiAgICAgICAgICAgIHRyaWFuZ2xlcy5wdXNoKGVhci5pIC8gZGltKTsKICAgICAgICAgICAgdHJpYW5nbGVzLnB1c2gobmV4dC5pIC8gZGltKTsKCiAgICAgICAgICAgIHJlbW92ZU5vZGUoZWFyKTsKCiAgICAgICAgICAgIC8vIHNraXBwaW5nIHRoZSBuZXh0IHZlcnRpY2UgbGVhZHMgdG8gbGVzcyBzbGl2ZXIgdHJpYW5nbGVzCiAgICAgICAgICAgIGVhciA9IG5leHQubmV4dDsKICAgICAgICAgICAgc3RvcCA9IG5leHQubmV4dDsKCiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KCiAgICAgICAgZWFyID0gbmV4dDsKCiAgICAgICAgLy8gaWYgd2UgbG9vcGVkIHRocm91Z2ggdGhlIHdob2xlIHJlbWFpbmluZyBwb2x5Z29uIGFuZCBjYW4ndCBmaW5kIGFueSBtb3JlIGVhcnMKICAgICAgICBpZiAoZWFyID09PSBzdG9wKSB7CiAgICAgICAgICAgIC8vIHRyeSBmaWx0ZXJpbmcgcG9pbnRzIGFuZCBzbGljaW5nIGFnYWluCiAgICAgICAgICAgIGlmICghcGFzcykgewogICAgICAgICAgICAgICAgZWFyY3V0TGlua2VkKGZpbHRlclBvaW50cyhlYXIpLCB0cmlhbmdsZXMsIGRpbSwgbWluWCwgbWluWSwgaW52U2l6ZSwgMSk7CgogICAgICAgICAgICAvLyBpZiB0aGlzIGRpZG4ndCB3b3JrLCB0cnkgY3VyaW5nIGFsbCBzbWFsbCBzZWxmLWludGVyc2VjdGlvbnMgbG9jYWxseQogICAgICAgICAgICB9IGVsc2UgaWYgKHBhc3MgPT09IDEpIHsKICAgICAgICAgICAgICAgIGVhciA9IGN1cmVMb2NhbEludGVyc2VjdGlvbnMoZWFyLCB0cmlhbmdsZXMsIGRpbSk7CiAgICAgICAgICAgICAgICBlYXJjdXRMaW5rZWQoZWFyLCB0cmlhbmdsZXMsIGRpbSwgbWluWCwgbWluWSwgaW52U2l6ZSwgMik7CgogICAgICAgICAgICAvLyBhcyBhIGxhc3QgcmVzb3J0LCB0cnkgc3BsaXR0aW5nIHRoZSByZW1haW5pbmcgcG9seWdvbiBpbnRvIHR3bwogICAgICAgICAgICB9IGVsc2UgaWYgKHBhc3MgPT09IDIpIHsKICAgICAgICAgICAgICAgIHNwbGl0RWFyY3V0KGVhciwgdHJpYW5nbGVzLCBkaW0sIG1pblgsIG1pblksIGludlNpemUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9Cn0KCi8vIGNoZWNrIHdoZXRoZXIgYSBwb2x5Z29uIG5vZGUgZm9ybXMgYSB2YWxpZCBlYXIgd2l0aCBhZGphY2VudCBub2RlcwpmdW5jdGlvbiBpc0VhcihlYXIpIHsKICAgIHZhciBhID0gZWFyLnByZXYsCiAgICAgICAgYiA9IGVhciwKICAgICAgICBjID0gZWFyLm5leHQ7CgogICAgaWYgKGFyZWEoYSwgYiwgYykgPj0gMCkgcmV0dXJuIGZhbHNlOyAvLyByZWZsZXgsIGNhbid0IGJlIGFuIGVhcgoKICAgIC8vIG5vdyBtYWtlIHN1cmUgd2UgZG9uJ3QgaGF2ZSBvdGhlciBwb2ludHMgaW5zaWRlIHRoZSBwb3RlbnRpYWwgZWFyCiAgICB2YXIgcCA9IGVhci5uZXh0Lm5leHQ7CgogICAgd2hpbGUgKHAgIT09IGVhci5wcmV2KSB7CiAgICAgICAgaWYgKHBvaW50SW5UcmlhbmdsZShhLngsIGEueSwgYi54LCBiLnksIGMueCwgYy55LCBwLngsIHAueSkgJiYKICAgICAgICAgICAgYXJlYShwLnByZXYsIHAsIHAubmV4dCkgPj0gMCkgcmV0dXJuIGZhbHNlOwogICAgICAgIHAgPSBwLm5leHQ7CiAgICB9CgogICAgcmV0dXJuIHRydWU7Cn0KCmZ1bmN0aW9uIGlzRWFySGFzaGVkKGVhciwgbWluWCwgbWluWSwgaW52U2l6ZSkgewogICAgdmFyIGEgPSBlYXIucHJldiwKICAgICAgICBiID0gZWFyLAogICAgICAgIGMgPSBlYXIubmV4dDsKCiAgICBpZiAoYXJlYShhLCBiLCBjKSA+PSAwKSByZXR1cm4gZmFsc2U7IC8vIHJlZmxleCwgY2FuJ3QgYmUgYW4gZWFyCgogICAgLy8gdHJpYW5nbGUgYmJveDsgbWluICYgbWF4IGFyZSBjYWxjdWxhdGVkIGxpa2UgdGhpcyBmb3Igc3BlZWQKICAgIHZhciBtaW5UWCA9IGEueCA8IGIueCA/IChhLnggPCBjLnggPyBhLnggOiBjLngpIDogKGIueCA8IGMueCA/IGIueCA6IGMueCksCiAgICAgICAgbWluVFkgPSBhLnkgPCBiLnkgPyAoYS55IDwgYy55ID8gYS55IDogYy55KSA6IChiLnkgPCBjLnkgPyBiLnkgOiBjLnkpLAogICAgICAgIG1heFRYID0gYS54ID4gYi54ID8gKGEueCA+IGMueCA/IGEueCA6IGMueCkgOiAoYi54ID4gYy54ID8gYi54IDogYy54KSwKICAgICAgICBtYXhUWSA9IGEueSA+IGIueSA/IChhLnkgPiBjLnkgPyBhLnkgOiBjLnkpIDogKGIueSA+IGMueSA/IGIueSA6IGMueSk7CgogICAgLy8gei1vcmRlciByYW5nZSBmb3IgdGhlIGN1cnJlbnQgdHJpYW5nbGUgYmJveDsKICAgIHZhciBtaW5aID0gek9yZGVyKG1pblRYLCBtaW5UWSwgbWluWCwgbWluWSwgaW52U2l6ZSksCiAgICAgICAgbWF4WiA9IHpPcmRlcihtYXhUWCwgbWF4VFksIG1pblgsIG1pblksIGludlNpemUpOwoKICAgIHZhciBwID0gZWFyLnByZXZaLAogICAgICAgIG4gPSBlYXIubmV4dFo7CgogICAgLy8gbG9vayBmb3IgcG9pbnRzIGluc2lkZSB0aGUgdHJpYW5nbGUgaW4gYm90aCBkaXJlY3Rpb25zCiAgICB3aGlsZSAocCAmJiBwLnogPj0gbWluWiAmJiBuICYmIG4ueiA8PSBtYXhaKSB7CiAgICAgICAgaWYgKHAgIT09IGVhci5wcmV2ICYmIHAgIT09IGVhci5uZXh0ICYmCiAgICAgICAgICAgIHBvaW50SW5UcmlhbmdsZShhLngsIGEueSwgYi54LCBiLnksIGMueCwgYy55LCBwLngsIHAueSkgJiYKICAgICAgICAgICAgYXJlYShwLnByZXYsIHAsIHAubmV4dCkgPj0gMCkgcmV0dXJuIGZhbHNlOwogICAgICAgIHAgPSBwLnByZXZaOwoKICAgICAgICBpZiAobiAhPT0gZWFyLnByZXYgJiYgbiAhPT0gZWFyLm5leHQgJiYKICAgICAgICAgICAgcG9pbnRJblRyaWFuZ2xlKGEueCwgYS55LCBiLngsIGIueSwgYy54LCBjLnksIG4ueCwgbi55KSAmJgogICAgICAgICAgICBhcmVhKG4ucHJldiwgbiwgbi5uZXh0KSA+PSAwKSByZXR1cm4gZmFsc2U7CiAgICAgICAgbiA9IG4ubmV4dFo7CiAgICB9CgogICAgLy8gbG9vayBmb3IgcmVtYWluaW5nIHBvaW50cyBpbiBkZWNyZWFzaW5nIHotb3JkZXIKICAgIHdoaWxlIChwICYmIHAueiA+PSBtaW5aKSB7CiAgICAgICAgaWYgKHAgIT09IGVhci5wcmV2ICYmIHAgIT09IGVhci5uZXh0ICYmCiAgICAgICAgICAgIHBvaW50SW5UcmlhbmdsZShhLngsIGEueSwgYi54LCBiLnksIGMueCwgYy55LCBwLngsIHAueSkgJiYKICAgICAgICAgICAgYXJlYShwLnByZXYsIHAsIHAubmV4dCkgPj0gMCkgcmV0dXJuIGZhbHNlOwogICAgICAgIHAgPSBwLnByZXZaOwogICAgfQoKICAgIC8vIGxvb2sgZm9yIHJlbWFpbmluZyBwb2ludHMgaW4gaW5jcmVhc2luZyB6LW9yZGVyCiAgICB3aGlsZSAobiAmJiBuLnogPD0gbWF4WikgewogICAgICAgIGlmIChuICE9PSBlYXIucHJldiAmJiBuICE9PSBlYXIubmV4dCAmJgogICAgICAgICAgICBwb2ludEluVHJpYW5nbGUoYS54LCBhLnksIGIueCwgYi55LCBjLngsIGMueSwgbi54LCBuLnkpICYmCiAgICAgICAgICAgIGFyZWEobi5wcmV2LCBuLCBuLm5leHQpID49IDApIHJldHVybiBmYWxzZTsKICAgICAgICBuID0gbi5uZXh0WjsKICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKfQoKLy8gZ28gdGhyb3VnaCBhbGwgcG9seWdvbiBub2RlcyBhbmQgY3VyZSBzbWFsbCBsb2NhbCBzZWxmLWludGVyc2VjdGlvbnMKZnVuY3Rpb24gY3VyZUxvY2FsSW50ZXJzZWN0aW9ucyhzdGFydCwgdHJpYW5nbGVzLCBkaW0pIHsKICAgIHZhciBwID0gc3RhcnQ7CiAgICBkbyB7CiAgICAgICAgdmFyIGEgPSBwLnByZXYsCiAgICAgICAgICAgIGIgPSBwLm5leHQubmV4dDsKCiAgICAgICAgaWYgKCFlcXVhbHMoYSwgYikgJiYgaW50ZXJzZWN0cyhhLCBwLCBwLm5leHQsIGIpICYmIGxvY2FsbHlJbnNpZGUoYSwgYikgJiYgbG9jYWxseUluc2lkZShiLCBhKSkgewoKICAgICAgICAgICAgdHJpYW5nbGVzLnB1c2goYS5pIC8gZGltKTsKICAgICAgICAgICAgdHJpYW5nbGVzLnB1c2gocC5pIC8gZGltKTsKICAgICAgICAgICAgdHJpYW5nbGVzLnB1c2goYi5pIC8gZGltKTsKCiAgICAgICAgICAgIC8vIHJlbW92ZSB0d28gbm9kZXMgaW52b2x2ZWQKICAgICAgICAgICAgcmVtb3ZlTm9kZShwKTsKICAgICAgICAgICAgcmVtb3ZlTm9kZShwLm5leHQpOwoKICAgICAgICAgICAgcCA9IHN0YXJ0ID0gYjsKICAgICAgICB9CiAgICAgICAgcCA9IHAubmV4dDsKICAgIH0gd2hpbGUgKHAgIT09IHN0YXJ0KTsKCiAgICByZXR1cm4gcDsKfQoKLy8gdHJ5IHNwbGl0dGluZyBwb2x5Z29uIGludG8gdHdvIGFuZCB0cmlhbmd1bGF0ZSB0aGVtIGluZGVwZW5kZW50bHkKZnVuY3Rpb24gc3BsaXRFYXJjdXQoc3RhcnQsIHRyaWFuZ2xlcywgZGltLCBtaW5YLCBtaW5ZLCBpbnZTaXplKSB7CiAgICAvLyBsb29rIGZvciBhIHZhbGlkIGRpYWdvbmFsIHRoYXQgZGl2aWRlcyB0aGUgcG9seWdvbiBpbnRvIHR3bwogICAgdmFyIGEgPSBzdGFydDsKICAgIGRvIHsKICAgICAgICB2YXIgYiA9IGEubmV4dC5uZXh0OwogICAgICAgIHdoaWxlIChiICE9PSBhLnByZXYpIHsKICAgICAgICAgICAgaWYgKGEuaSAhPT0gYi5pICYmIGlzVmFsaWREaWFnb25hbChhLCBiKSkgewogICAgICAgICAgICAgICAgLy8gc3BsaXQgdGhlIHBvbHlnb24gaW4gdHdvIGJ5IHRoZSBkaWFnb25hbAogICAgICAgICAgICAgICAgdmFyIGMgPSBzcGxpdFBvbHlnb24oYSwgYik7CgogICAgICAgICAgICAgICAgLy8gZmlsdGVyIGNvbGluZWFyIHBvaW50cyBhcm91bmQgdGhlIGN1dHMKICAgICAgICAgICAgICAgIGEgPSBmaWx0ZXJQb2ludHMoYSwgYS5uZXh0KTsKICAgICAgICAgICAgICAgIGMgPSBmaWx0ZXJQb2ludHMoYywgYy5uZXh0KTsKCiAgICAgICAgICAgICAgICAvLyBydW4gZWFyY3V0IG9uIGVhY2ggaGFsZgogICAgICAgICAgICAgICAgZWFyY3V0TGlua2VkKGEsIHRyaWFuZ2xlcywgZGltLCBtaW5YLCBtaW5ZLCBpbnZTaXplKTsKICAgICAgICAgICAgICAgIGVhcmN1dExpbmtlZChjLCB0cmlhbmdsZXMsIGRpbSwgbWluWCwgbWluWSwgaW52U2l6ZSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYiA9IGIubmV4dDsKICAgICAgICB9CiAgICAgICAgYSA9IGEubmV4dDsKICAgIH0gd2hpbGUgKGEgIT09IHN0YXJ0KTsKfQoKLy8gbGluayBldmVyeSBob2xlIGludG8gdGhlIG91dGVyIGxvb3AsIHByb2R1Y2luZyBhIHNpbmdsZS1yaW5nIHBvbHlnb24gd2l0aG91dCBob2xlcwpmdW5jdGlvbiBlbGltaW5hdGVIb2xlcyhkYXRhLCBob2xlSW5kaWNlcywgb3V0ZXJOb2RlLCBkaW0pIHsKICAgIHZhciBxdWV1ZSA9IFtdLAogICAgICAgIGksIGxlbiwgc3RhcnQsIGVuZCwgbGlzdDsKCiAgICBmb3IgKGkgPSAwLCBsZW4gPSBob2xlSW5kaWNlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgIHN0YXJ0ID0gaG9sZUluZGljZXNbaV0gKiBkaW07CiAgICAgICAgZW5kID0gaSA8IGxlbiAtIDEgPyBob2xlSW5kaWNlc1tpICsgMV0gKiBkaW0gOiBkYXRhLmxlbmd0aDsKICAgICAgICBsaXN0ID0gbGlua2VkTGlzdChkYXRhLCBzdGFydCwgZW5kLCBkaW0sIGZhbHNlKTsKICAgICAgICBpZiAobGlzdCA9PT0gbGlzdC5uZXh0KSBsaXN0LnN0ZWluZXIgPSB0cnVlOwogICAgICAgIHF1ZXVlLnB1c2goZ2V0TGVmdG1vc3QobGlzdCkpOwogICAgfQoKICAgIHF1ZXVlLnNvcnQoY29tcGFyZVgpOwoKICAgIC8vIHByb2Nlc3MgaG9sZXMgZnJvbSBsZWZ0IHRvIHJpZ2h0CiAgICBmb3IgKGkgPSAwOyBpIDwgcXVldWUubGVuZ3RoOyBpKyspIHsKICAgICAgICBlbGltaW5hdGVIb2xlKHF1ZXVlW2ldLCBvdXRlck5vZGUpOwogICAgICAgIG91dGVyTm9kZSA9IGZpbHRlclBvaW50cyhvdXRlck5vZGUsIG91dGVyTm9kZS5uZXh0KTsKICAgIH0KCiAgICByZXR1cm4gb3V0ZXJOb2RlOwp9CgpmdW5jdGlvbiBjb21wYXJlWChhLCBiKSB7CiAgICByZXR1cm4gYS54IC0gYi54Owp9CgovLyBmaW5kIGEgYnJpZGdlIGJldHdlZW4gdmVydGljZXMgdGhhdCBjb25uZWN0cyBob2xlIHdpdGggYW4gb3V0ZXIgcmluZyBhbmQgYW5kIGxpbmsgaXQKZnVuY3Rpb24gZWxpbWluYXRlSG9sZShob2xlLCBvdXRlck5vZGUpIHsKICAgIG91dGVyTm9kZSA9IGZpbmRIb2xlQnJpZGdlKGhvbGUsIG91dGVyTm9kZSk7CiAgICBpZiAob3V0ZXJOb2RlKSB7CiAgICAgICAgdmFyIGIgPSBzcGxpdFBvbHlnb24ob3V0ZXJOb2RlLCBob2xlKTsKICAgICAgICBmaWx0ZXJQb2ludHMoYiwgYi5uZXh0KTsKICAgIH0KfQoKLy8gRGF2aWQgRWJlcmx5J3MgYWxnb3JpdGhtIGZvciBmaW5kaW5nIGEgYnJpZGdlIGJldHdlZW4gaG9sZSBhbmQgb3V0ZXIgcG9seWdvbgpmdW5jdGlvbiBmaW5kSG9sZUJyaWRnZShob2xlLCBvdXRlck5vZGUpIHsKICAgIHZhciBwID0gb3V0ZXJOb2RlLAogICAgICAgIGh4ID0gaG9sZS54LAogICAgICAgIGh5ID0gaG9sZS55LAogICAgICAgIHF4ID0gLUluZmluaXR5LAogICAgICAgIG07CgogICAgLy8gZmluZCBhIHNlZ21lbnQgaW50ZXJzZWN0ZWQgYnkgYSByYXkgZnJvbSB0aGUgaG9sZSdzIGxlZnRtb3N0IHBvaW50IHRvIHRoZSBsZWZ0OwogICAgLy8gc2VnbWVudCdzIGVuZHBvaW50IHdpdGggbGVzc2VyIHggd2lsbCBiZSBwb3RlbnRpYWwgY29ubmVjdGlvbiBwb2ludAogICAgZG8gewogICAgICAgIGlmIChoeSA8PSBwLnkgJiYgaHkgPj0gcC5uZXh0LnkgJiYgcC5uZXh0LnkgIT09IHAueSkgewogICAgICAgICAgICB2YXIgeCA9IHAueCArIChoeSAtIHAueSkgKiAocC5uZXh0LnggLSBwLngpIC8gKHAubmV4dC55IC0gcC55KTsKICAgICAgICAgICAgaWYgKHggPD0gaHggJiYgeCA+IHF4KSB7CiAgICAgICAgICAgICAgICBxeCA9IHg7CiAgICAgICAgICAgICAgICBpZiAoeCA9PT0gaHgpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaHkgPT09IHAueSkgcmV0dXJuIHA7CiAgICAgICAgICAgICAgICAgICAgaWYgKGh5ID09PSBwLm5leHQueSkgcmV0dXJuIHAubmV4dDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG0gPSBwLnggPCBwLm5leHQueCA/IHAgOiBwLm5leHQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcCA9IHAubmV4dDsKICAgIH0gd2hpbGUgKHAgIT09IG91dGVyTm9kZSk7CgogICAgaWYgKCFtKSByZXR1cm4gbnVsbDsKCiAgICBpZiAoaHggPT09IHF4KSByZXR1cm4gbS5wcmV2OyAvLyBob2xlIHRvdWNoZXMgb3V0ZXIgc2VnbWVudDsgcGljayBsb3dlciBlbmRwb2ludAoKICAgIC8vIGxvb2sgZm9yIHBvaW50cyBpbnNpZGUgdGhlIHRyaWFuZ2xlIG9mIGhvbGUgcG9pbnQsIHNlZ21lbnQgaW50ZXJzZWN0aW9uIGFuZCBlbmRwb2ludDsKICAgIC8vIGlmIHRoZXJlIGFyZSBubyBwb2ludHMgZm91bmQsIHdlIGhhdmUgYSB2YWxpZCBjb25uZWN0aW9uOwogICAgLy8gb3RoZXJ3aXNlIGNob29zZSB0aGUgcG9pbnQgb2YgdGhlIG1pbmltdW0gYW5nbGUgd2l0aCB0aGUgcmF5IGFzIGNvbm5lY3Rpb24gcG9pbnQKCiAgICB2YXIgc3RvcCA9IG0sCiAgICAgICAgbXggPSBtLngsCiAgICAgICAgbXkgPSBtLnksCiAgICAgICAgdGFuTWluID0gSW5maW5pdHksCiAgICAgICAgdGFuOwoKICAgIHAgPSBtLm5leHQ7CgogICAgd2hpbGUgKHAgIT09IHN0b3ApIHsKICAgICAgICBpZiAoaHggPj0gcC54ICYmIHAueCA+PSBteCAmJiBoeCAhPT0gcC54ICYmCiAgICAgICAgICAgICAgICBwb2ludEluVHJpYW5nbGUoaHkgPCBteSA/IGh4IDogcXgsIGh5LCBteCwgbXksIGh5IDwgbXkgPyBxeCA6IGh4LCBoeSwgcC54LCBwLnkpKSB7CgogICAgICAgICAgICB0YW4gPSBNYXRoLmFicyhoeSAtIHAueSkgLyAoaHggLSBwLngpOyAvLyB0YW5nZW50aWFsCgogICAgICAgICAgICBpZiAoKHRhbiA8IHRhbk1pbiB8fCAodGFuID09PSB0YW5NaW4gJiYgcC54ID4gbS54KSkgJiYgbG9jYWxseUluc2lkZShwLCBob2xlKSkgewogICAgICAgICAgICAgICAgbSA9IHA7CiAgICAgICAgICAgICAgICB0YW5NaW4gPSB0YW47CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHAgPSBwLm5leHQ7CiAgICB9CgogICAgcmV0dXJuIG07Cn0KCi8vIGludGVybGluayBwb2x5Z29uIG5vZGVzIGluIHotb3JkZXIKZnVuY3Rpb24gaW5kZXhDdXJ2ZShzdGFydCwgbWluWCwgbWluWSwgaW52U2l6ZSkgewogICAgdmFyIHAgPSBzdGFydDsKICAgIGRvIHsKICAgICAgICBpZiAocC56ID09PSBudWxsKSBwLnogPSB6T3JkZXIocC54LCBwLnksIG1pblgsIG1pblksIGludlNpemUpOwogICAgICAgIHAucHJldlogPSBwLnByZXY7CiAgICAgICAgcC5uZXh0WiA9IHAubmV4dDsKICAgICAgICBwID0gcC5uZXh0OwogICAgfSB3aGlsZSAocCAhPT0gc3RhcnQpOwoKICAgIHAucHJldloubmV4dFogPSBudWxsOwogICAgcC5wcmV2WiA9IG51bGw7CgogICAgc29ydExpbmtlZChwKTsKfQoKLy8gU2ltb24gVGF0aGFtJ3MgbGlua2VkIGxpc3QgbWVyZ2Ugc29ydCBhbGdvcml0aG0KLy8gaHR0cDovL3d3dy5jaGlhcmsuZ3JlZW5lbmQub3JnLnVrL35zZ3RhdGhhbS9hbGdvcml0aG1zL2xpc3Rzb3J0Lmh0bWwKZnVuY3Rpb24gc29ydExpbmtlZChsaXN0KSB7CiAgICB2YXIgaSwgcCwgcSwgZSwgdGFpbCwgbnVtTWVyZ2VzLCBwU2l6ZSwgcVNpemUsCiAgICAgICAgaW5TaXplID0gMTsKCiAgICBkbyB7CiAgICAgICAgcCA9IGxpc3Q7CiAgICAgICAgbGlzdCA9IG51bGw7CiAgICAgICAgdGFpbCA9IG51bGw7CiAgICAgICAgbnVtTWVyZ2VzID0gMDsKCiAgICAgICAgd2hpbGUgKHApIHsKICAgICAgICAgICAgbnVtTWVyZ2VzKys7CiAgICAgICAgICAgIHEgPSBwOwogICAgICAgICAgICBwU2l6ZSA9IDA7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBpblNpemU7IGkrKykgewogICAgICAgICAgICAgICAgcFNpemUrKzsKICAgICAgICAgICAgICAgIHEgPSBxLm5leHRaOwogICAgICAgICAgICAgICAgaWYgKCFxKSBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBxU2l6ZSA9IGluU2l6ZTsKCiAgICAgICAgICAgIHdoaWxlIChwU2l6ZSA+IDAgfHwgKHFTaXplID4gMCAmJiBxKSkgewoKICAgICAgICAgICAgICAgIGlmIChwU2l6ZSAhPT0gMCAmJiAocVNpemUgPT09IDAgfHwgIXEgfHwgcC56IDw9IHEueikpIHsKICAgICAgICAgICAgICAgICAgICBlID0gcDsKICAgICAgICAgICAgICAgICAgICBwID0gcC5uZXh0WjsKICAgICAgICAgICAgICAgICAgICBwU2l6ZS0tOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBlID0gcTsKICAgICAgICAgICAgICAgICAgICBxID0gcS5uZXh0WjsKICAgICAgICAgICAgICAgICAgICBxU2l6ZS0tOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0YWlsKSB0YWlsLm5leHRaID0gZTsKICAgICAgICAgICAgICAgIGVsc2UgbGlzdCA9IGU7CgogICAgICAgICAgICAgICAgZS5wcmV2WiA9IHRhaWw7CiAgICAgICAgICAgICAgICB0YWlsID0gZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcCA9IHE7CiAgICAgICAgfQoKICAgICAgICB0YWlsLm5leHRaID0gbnVsbDsKICAgICAgICBpblNpemUgKj0gMjsKCiAgICB9IHdoaWxlIChudW1NZXJnZXMgPiAxKTsKCiAgICByZXR1cm4gbGlzdDsKfQoKLy8gei1vcmRlciBvZiBhIHBvaW50IGdpdmVuIGNvb3JkcyBhbmQgaW52ZXJzZSBvZiB0aGUgbG9uZ2VyIHNpZGUgb2YgZGF0YSBiYm94CmZ1bmN0aW9uIHpPcmRlcih4LCB5LCBtaW5YLCBtaW5ZLCBpbnZTaXplKSB7CiAgICAvLyBjb29yZHMgYXJlIHRyYW5zZm9ybWVkIGludG8gbm9uLW5lZ2F0aXZlIDE1LWJpdCBpbnRlZ2VyIHJhbmdlCiAgICB4ID0gMzI3NjcgKiAoeCAtIG1pblgpICogaW52U2l6ZTsKICAgIHkgPSAzMjc2NyAqICh5IC0gbWluWSkgKiBpbnZTaXplOwoKICAgIHggPSAoeCB8ICh4IDw8IDgpKSAmIDB4MDBGRjAwRkY7CiAgICB4ID0gKHggfCAoeCA8PCA0KSkgJiAweDBGMEYwRjBGOwogICAgeCA9ICh4IHwgKHggPDwgMikpICYgMHgzMzMzMzMzMzsKICAgIHggPSAoeCB8ICh4IDw8IDEpKSAmIDB4NTU1NTU1NTU7CgogICAgeSA9ICh5IHwgKHkgPDwgOCkpICYgMHgwMEZGMDBGRjsKICAgIHkgPSAoeSB8ICh5IDw8IDQpKSAmIDB4MEYwRjBGMEY7CiAgICB5ID0gKHkgfCAoeSA8PCAyKSkgJiAweDMzMzMzMzMzOwogICAgeSA9ICh5IHwgKHkgPDwgMSkpICYgMHg1NTU1NTU1NTsKCiAgICByZXR1cm4geCB8ICh5IDw8IDEpOwp9CgovLyBmaW5kIHRoZSBsZWZ0bW9zdCBub2RlIG9mIGEgcG9seWdvbiByaW5nCmZ1bmN0aW9uIGdldExlZnRtb3N0KHN0YXJ0KSB7CiAgICB2YXIgcCA9IHN0YXJ0LAogICAgICAgIGxlZnRtb3N0ID0gc3RhcnQ7CiAgICBkbyB7CiAgICAgICAgaWYgKHAueCA8IGxlZnRtb3N0LngpIGxlZnRtb3N0ID0gcDsKICAgICAgICBwID0gcC5uZXh0OwogICAgfSB3aGlsZSAocCAhPT0gc3RhcnQpOwoKICAgIHJldHVybiBsZWZ0bW9zdDsKfQoKLy8gY2hlY2sgaWYgYSBwb2ludCBsaWVzIHdpdGhpbiBhIGNvbnZleCB0cmlhbmdsZQpmdW5jdGlvbiBwb2ludEluVHJpYW5nbGUoYXgsIGF5LCBieCwgYnksIGN4LCBjeSwgcHgsIHB5KSB7CiAgICByZXR1cm4gKGN4IC0gcHgpICogKGF5IC0gcHkpIC0gKGF4IC0gcHgpICogKGN5IC0gcHkpID49IDAgJiYKICAgICAgICAgICAoYXggLSBweCkgKiAoYnkgLSBweSkgLSAoYnggLSBweCkgKiAoYXkgLSBweSkgPj0gMCAmJgogICAgICAgICAgIChieCAtIHB4KSAqIChjeSAtIHB5KSAtIChjeCAtIHB4KSAqIChieSAtIHB5KSA+PSAwOwp9CgovLyBjaGVjayBpZiBhIGRpYWdvbmFsIGJldHdlZW4gdHdvIHBvbHlnb24gbm9kZXMgaXMgdmFsaWQgKGxpZXMgaW4gcG9seWdvbiBpbnRlcmlvcikKZnVuY3Rpb24gaXNWYWxpZERpYWdvbmFsKGEsIGIpIHsKICAgIHJldHVybiBhLm5leHQuaSAhPT0gYi5pICYmIGEucHJldi5pICE9PSBiLmkgJiYgIWludGVyc2VjdHNQb2x5Z29uKGEsIGIpICYmCiAgICAgICAgICAgbG9jYWxseUluc2lkZShhLCBiKSAmJiBsb2NhbGx5SW5zaWRlKGIsIGEpICYmIG1pZGRsZUluc2lkZShhLCBiKTsKfQoKLy8gc2lnbmVkIGFyZWEgb2YgYSB0cmlhbmdsZQpmdW5jdGlvbiBhcmVhKHAsIHEsIHIpIHsKICAgIHJldHVybiAocS55IC0gcC55KSAqIChyLnggLSBxLngpIC0gKHEueCAtIHAueCkgKiAoci55IC0gcS55KTsKfQoKLy8gY2hlY2sgaWYgdHdvIHBvaW50cyBhcmUgZXF1YWwKZnVuY3Rpb24gZXF1YWxzKHAxLCBwMikgewogICAgcmV0dXJuIHAxLnggPT09IHAyLnggJiYgcDEueSA9PT0gcDIueTsKfQoKLy8gY2hlY2sgaWYgdHdvIHNlZ21lbnRzIGludGVyc2VjdApmdW5jdGlvbiBpbnRlcnNlY3RzKHAxLCBxMSwgcDIsIHEyKSB7CiAgICBpZiAoKGVxdWFscyhwMSwgcTEpICYmIGVxdWFscyhwMiwgcTIpKSB8fAogICAgICAgIChlcXVhbHMocDEsIHEyKSAmJiBlcXVhbHMocDIsIHExKSkpIHJldHVybiB0cnVlOwogICAgcmV0dXJuIGFyZWEocDEsIHExLCBwMikgPiAwICE9PSBhcmVhKHAxLCBxMSwgcTIpID4gMCAmJgogICAgICAgICAgIGFyZWEocDIsIHEyLCBwMSkgPiAwICE9PSBhcmVhKHAyLCBxMiwgcTEpID4gMDsKfQoKLy8gY2hlY2sgaWYgYSBwb2x5Z29uIGRpYWdvbmFsIGludGVyc2VjdHMgYW55IHBvbHlnb24gc2VnbWVudHMKZnVuY3Rpb24gaW50ZXJzZWN0c1BvbHlnb24oYSwgYikgewogICAgdmFyIHAgPSBhOwogICAgZG8gewogICAgICAgIGlmIChwLmkgIT09IGEuaSAmJiBwLm5leHQuaSAhPT0gYS5pICYmIHAuaSAhPT0gYi5pICYmIHAubmV4dC5pICE9PSBiLmkgJiYKICAgICAgICAgICAgICAgIGludGVyc2VjdHMocCwgcC5uZXh0LCBhLCBiKSkgcmV0dXJuIHRydWU7CiAgICAgICAgcCA9IHAubmV4dDsKICAgIH0gd2hpbGUgKHAgIT09IGEpOwoKICAgIHJldHVybiBmYWxzZTsKfQoKLy8gY2hlY2sgaWYgYSBwb2x5Z29uIGRpYWdvbmFsIGlzIGxvY2FsbHkgaW5zaWRlIHRoZSBwb2x5Z29uCmZ1bmN0aW9uIGxvY2FsbHlJbnNpZGUoYSwgYikgewogICAgcmV0dXJuIGFyZWEoYS5wcmV2LCBhLCBhLm5leHQpIDwgMCA/CiAgICAgICAgYXJlYShhLCBiLCBhLm5leHQpID49IDAgJiYgYXJlYShhLCBhLnByZXYsIGIpID49IDAgOgogICAgICAgIGFyZWEoYSwgYiwgYS5wcmV2KSA8IDAgfHwgYXJlYShhLCBhLm5leHQsIGIpIDwgMDsKfQoKLy8gY2hlY2sgaWYgdGhlIG1pZGRsZSBwb2ludCBvZiBhIHBvbHlnb24gZGlhZ29uYWwgaXMgaW5zaWRlIHRoZSBwb2x5Z29uCmZ1bmN0aW9uIG1pZGRsZUluc2lkZShhLCBiKSB7CiAgICB2YXIgcCA9IGEsCiAgICAgICAgaW5zaWRlID0gZmFsc2UsCiAgICAgICAgcHggPSAoYS54ICsgYi54KSAvIDIsCiAgICAgICAgcHkgPSAoYS55ICsgYi55KSAvIDI7CiAgICBkbyB7CiAgICAgICAgaWYgKCgocC55ID4gcHkpICE9PSAocC5uZXh0LnkgPiBweSkpICYmIHAubmV4dC55ICE9PSBwLnkgJiYKICAgICAgICAgICAgICAgIChweCA8IChwLm5leHQueCAtIHAueCkgKiAocHkgLSBwLnkpIC8gKHAubmV4dC55IC0gcC55KSArIHAueCkpCiAgICAgICAgICAgIGluc2lkZSA9ICFpbnNpZGU7CiAgICAgICAgcCA9IHAubmV4dDsKICAgIH0gd2hpbGUgKHAgIT09IGEpOwoKICAgIHJldHVybiBpbnNpZGU7Cn0KCi8vIGxpbmsgdHdvIHBvbHlnb24gdmVydGljZXMgd2l0aCBhIGJyaWRnZTsgaWYgdGhlIHZlcnRpY2VzIGJlbG9uZyB0byB0aGUgc2FtZSByaW5nLCBpdCBzcGxpdHMgcG9seWdvbiBpbnRvIHR3bzsKLy8gaWYgb25lIGJlbG9uZ3MgdG8gdGhlIG91dGVyIHJpbmcgYW5kIGFub3RoZXIgdG8gYSBob2xlLCBpdCBtZXJnZXMgaXQgaW50byBhIHNpbmdsZSByaW5nCmZ1bmN0aW9uIHNwbGl0UG9seWdvbihhLCBiKSB7CiAgICB2YXIgYTIgPSBuZXcgTm9kZShhLmksIGEueCwgYS55KSwKICAgICAgICBiMiA9IG5ldyBOb2RlKGIuaSwgYi54LCBiLnkpLAogICAgICAgIGFuID0gYS5uZXh0LAogICAgICAgIGJwID0gYi5wcmV2OwoKICAgIGEubmV4dCA9IGI7CiAgICBiLnByZXYgPSBhOwoKICAgIGEyLm5leHQgPSBhbjsKICAgIGFuLnByZXYgPSBhMjsKCiAgICBiMi5uZXh0ID0gYTI7CiAgICBhMi5wcmV2ID0gYjI7CgogICAgYnAubmV4dCA9IGIyOwogICAgYjIucHJldiA9IGJwOwoKICAgIHJldHVybiBiMjsKfQoKLy8gY3JlYXRlIGEgbm9kZSBhbmQgb3B0aW9uYWxseSBsaW5rIGl0IHdpdGggcHJldmlvdXMgb25lIChpbiBhIGNpcmN1bGFyIGRvdWJseSBsaW5rZWQgbGlzdCkKZnVuY3Rpb24gaW5zZXJ0Tm9kZShpLCB4LCB5LCBsYXN0KSB7CiAgICB2YXIgcCA9IG5ldyBOb2RlKGksIHgsIHkpOwoKICAgIGlmICghbGFzdCkgewogICAgICAgIHAucHJldiA9IHA7CiAgICAgICAgcC5uZXh0ID0gcDsKCiAgICB9IGVsc2UgewogICAgICAgIHAubmV4dCA9IGxhc3QubmV4dDsKICAgICAgICBwLnByZXYgPSBsYXN0OwogICAgICAgIGxhc3QubmV4dC5wcmV2ID0gcDsKICAgICAgICBsYXN0Lm5leHQgPSBwOwogICAgfQogICAgcmV0dXJuIHA7Cn0KCmZ1bmN0aW9uIHJlbW92ZU5vZGUocCkgewogICAgcC5uZXh0LnByZXYgPSBwLnByZXY7CiAgICBwLnByZXYubmV4dCA9IHAubmV4dDsKCiAgICBpZiAocC5wcmV2WikgcC5wcmV2Wi5uZXh0WiA9IHAubmV4dFo7CiAgICBpZiAocC5uZXh0WikgcC5uZXh0Wi5wcmV2WiA9IHAucHJldlo7Cn0KCmZ1bmN0aW9uIE5vZGUoaSwgeCwgeSkgewogICAgLy8gdmVydGljZSBpbmRleCBpbiBjb29yZGluYXRlcyBhcnJheQogICAgdGhpcy5pID0gaTsKCiAgICAvLyB2ZXJ0ZXggY29vcmRpbmF0ZXMKICAgIHRoaXMueCA9IHg7CiAgICB0aGlzLnkgPSB5OwoKICAgIC8vIHByZXZpb3VzIGFuZCBuZXh0IHZlcnRpY2Ugbm9kZXMgaW4gYSBwb2x5Z29uIHJpbmcKICAgIHRoaXMucHJldiA9IG51bGw7CiAgICB0aGlzLm5leHQgPSBudWxsOwoKICAgIC8vIHotb3JkZXIgY3VydmUgdmFsdWUKICAgIHRoaXMueiA9IG51bGw7CgogICAgLy8gcHJldmlvdXMgYW5kIG5leHQgbm9kZXMgaW4gei1vcmRlcgogICAgdGhpcy5wcmV2WiA9IG51bGw7CiAgICB0aGlzLm5leHRaID0gbnVsbDsKCiAgICAvLyBpbmRpY2F0ZXMgd2hldGhlciB0aGlzIGlzIGEgc3RlaW5lciBwb2ludAogICAgdGhpcy5zdGVpbmVyID0gZmFsc2U7Cn0KCi8vIHJldHVybiBhIHBlcmNlbnRhZ2UgZGlmZmVyZW5jZSBiZXR3ZWVuIHRoZSBwb2x5Z29uIGFyZWEgYW5kIGl0cyB0cmlhbmd1bGF0aW9uIGFyZWE7Ci8vIHVzZWQgdG8gdmVyaWZ5IGNvcnJlY3RuZXNzIG9mIHRyaWFuZ3VsYXRpb24KZWFyY3V0LmRldmlhdGlvbiA9IGZ1bmN0aW9uIChkYXRhLCBob2xlSW5kaWNlcywgZGltLCB0cmlhbmdsZXMpIHsKICAgIHZhciBoYXNIb2xlcyA9IGhvbGVJbmRpY2VzICYmIGhvbGVJbmRpY2VzLmxlbmd0aDsKICAgIHZhciBvdXRlckxlbiA9IGhhc0hvbGVzID8gaG9sZUluZGljZXNbMF0gKiBkaW0gOiBkYXRhLmxlbmd0aDsKCiAgICB2YXIgcG9seWdvbkFyZWEgPSBNYXRoLmFicyhzaWduZWRBcmVhKGRhdGEsIDAsIG91dGVyTGVuLCBkaW0pKTsKICAgIGlmIChoYXNIb2xlcykgewogICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBob2xlSW5kaWNlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICB2YXIgc3RhcnQgPSBob2xlSW5kaWNlc1tpXSAqIGRpbTsKICAgICAgICAgICAgdmFyIGVuZCA9IGkgPCBsZW4gLSAxID8gaG9sZUluZGljZXNbaSArIDFdICogZGltIDogZGF0YS5sZW5ndGg7CiAgICAgICAgICAgIHBvbHlnb25BcmVhIC09IE1hdGguYWJzKHNpZ25lZEFyZWEoZGF0YSwgc3RhcnQsIGVuZCwgZGltKSk7CiAgICAgICAgfQogICAgfQoKICAgIHZhciB0cmlhbmdsZXNBcmVhID0gMDsKICAgIGZvciAoaSA9IDA7IGkgPCB0cmlhbmdsZXMubGVuZ3RoOyBpICs9IDMpIHsKICAgICAgICB2YXIgYSA9IHRyaWFuZ2xlc1tpXSAqIGRpbTsKICAgICAgICB2YXIgYiA9IHRyaWFuZ2xlc1tpICsgMV0gKiBkaW07CiAgICAgICAgdmFyIGMgPSB0cmlhbmdsZXNbaSArIDJdICogZGltOwogICAgICAgIHRyaWFuZ2xlc0FyZWEgKz0gTWF0aC5hYnMoCiAgICAgICAgICAgIChkYXRhW2FdIC0gZGF0YVtjXSkgKiAoZGF0YVtiICsgMV0gLSBkYXRhW2EgKyAxXSkgLQogICAgICAgICAgICAoZGF0YVthXSAtIGRhdGFbYl0pICogKGRhdGFbYyArIDFdIC0gZGF0YVthICsgMV0pKTsKICAgIH0KCiAgICByZXR1cm4gcG9seWdvbkFyZWEgPT09IDAgJiYgdHJpYW5nbGVzQXJlYSA9PT0gMCA/IDAgOgogICAgICAgIE1hdGguYWJzKCh0cmlhbmdsZXNBcmVhIC0gcG9seWdvbkFyZWEpIC8gcG9seWdvbkFyZWEpOwp9OwoKZnVuY3Rpb24gc2lnbmVkQXJlYShkYXRhLCBzdGFydCwgZW5kLCBkaW0pIHsKICAgIHZhciBzdW0gPSAwOwogICAgZm9yICh2YXIgaSA9IHN0YXJ0LCBqID0gZW5kIC0gZGltOyBpIDwgZW5kOyBpICs9IGRpbSkgewogICAgICAgIHN1bSArPSAoZGF0YVtqXSAtIGRhdGFbaV0pICogKGRhdGFbaSArIDFdICsgZGF0YVtqICsgMV0pOwogICAgICAgIGogPSBpOwogICAgfQogICAgcmV0dXJuIHN1bTsKfQoKLy8gdHVybiBhIHBvbHlnb24gaW4gYSBtdWx0aS1kaW1lbnNpb25hbCBhcnJheSBmb3JtIChlLmcuIGFzIGluIEdlb0pTT04pIGludG8gYSBmb3JtIEVhcmN1dCBhY2NlcHRzCmVhcmN1dC5mbGF0dGVuID0gZnVuY3Rpb24gKGRhdGEpIHsKICAgIHZhciBkaW0gPSBkYXRhWzBdWzBdLmxlbmd0aCwKICAgICAgICByZXN1bHQgPSB7dmVydGljZXM6IFtdLCBob2xlczogW10sIGRpbWVuc2lvbnM6IGRpbX0sCiAgICAgICAgaG9sZUluZGV4ID0gMDsKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGRhdGFbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgZm9yICh2YXIgZCA9IDA7IGQgPCBkaW07IGQrKykgcmVzdWx0LnZlcnRpY2VzLnB1c2goZGF0YVtpXVtqXVtkXSk7CiAgICAgICAgfQogICAgICAgIGlmIChpID4gMCkgewogICAgICAgICAgICBob2xlSW5kZXggKz0gZGF0YVtpIC0gMV0ubGVuZ3RoOwogICAgICAgICAgICByZXN1bHQuaG9sZXMucHVzaChob2xlSW5kZXgpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXN1bHQ7Cn07Cgp9LHt9XSwyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKInVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMudHJhY2VBbmRDb252ZXhpZnkgPSB0cmFjZUFuZENvbnZleGlmeTsKZXhwb3J0cy5jcmVhdGVNYXNrID0gY3JlYXRlTWFzazsKZXhwb3J0cy5hdm9pZFNpbmdsZVBpeGVscyA9IGF2b2lkU2luZ2xlUGl4ZWxzOwpleHBvcnRzLnRyYWNlSW1hZ2UgPSB0cmFjZUltYWdlOwpleHBvcnRzLnNpbXBsaWZ5ID0gc2ltcGxpZnk7CmV4cG9ydHMudHJpYW5ndWxhdGUgPSB0cmlhbmd1bGF0ZTsKZXhwb3J0cy50cmlhbmdsZXNUb0NvbnZleCA9IHRyaWFuZ2xlc1RvQ29udmV4OwpleHBvcnRzLmNvbnZleFRvQXJyYXkgPSBjb252ZXhUb0FycmF5OwpleHBvcnRzLnNob3dUcmFjZWRJbWFnZSA9IHNob3dUcmFjZWRJbWFnZTsKZXhwb3J0cy5zaG93U2ltcGxpZmllZCA9IHNob3dTaW1wbGlmaWVkOwpleHBvcnRzLnNob3dWZXJ0aWNlcyA9IHNob3dWZXJ0aWNlczsKZXhwb3J0cy5zaG93Q29udmV4ID0gc2hvd0NvbnZleDsKZXhwb3J0cy5zaG93UGh5czJkU2hhcGVzID0gc2hvd1BoeXMyZFNoYXBlczsKbGV0IGVhcmN1dCA9IHJlcXVpcmUoJ2VhcmN1dCcpOwoKLyoNCiBDb3B5cmlnaHQgKGMpIDIwMTUsIEtyaWpnc21hbiBBdXRvbWF0aXNlcmluZw0KIHd3dy5jb2RlY2FiLmNvbQ0KDQogUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55IHB1cnBvc2UNCiB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLCBwcm92aWRlZCB0aGF0IHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlDQogYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2UgYXBwZWFyIGluIGFsbCBjb3BpZXMuDQoNCiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiBBTkQgVEhFIEFVVEhPUiBESVNDTEFJTVMgQUxMIFdBUlJBTlRJRVMgV0lUSA0KIFJFR0FSRCBUTyBUSElTIFNPRlRXQVJFIElOQ0xVRElORyBBTEwgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQNCiBGSVRORVNTLiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SIEJFIExJQUJMRSBGT1IgQU5ZIFNQRUNJQUwsIERJUkVDVCwNCiBJTkRJUkVDVCwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIE9SIEFOWSBEQU1BR0VTIFdIQVRTT0VWRVIgUkVTVUxUSU5HIEZST00gTE9TUw0KIE9GIFVTRSwgREFUQSBPUiBQUk9GSVRTLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgTkVHTElHRU5DRSBPUiBPVEhFUg0KIFRPUlRJT1VTIEFDVElPTiwgQVJJU0lORyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBVU0UgT1IgUEVSRk9STUFOQ0UgT0YNCiBUSElTIFNPRlRXQVJFLg0KICovCgp2YXIgU1RBUlQgPSAyNTU7CnZhciBUUkFDRUQgPSAyNTQ7CnZhciBJR05PUkVEID0gMjUzOwp2YXIgSU5URVJTRUNUSU9OID0gMHgwODsKLy8KLy8gICstLS0rLS0tKy0tLSsKLy8gIHwgMSB8IDAgfCA3IHwKLy8gICstLS0rLS0tKy0tLSsKLy8gIHwgMiB8IFAgfCA2IHwKLy8gICstLS0rLS0tKy0tLSsKLy8gIHwgMyB8IDQgfCA1IHwKLy8gICstLS0rLS0tKy0tLSsKdmFyIERJUlMgPSBbWzAsIC0xXSwgWy0xLCAtMV0sIFstMSwgMF0sIFstMSwgMV0sIFswLCAxXSwgWzEsIDFdLCBbMSwgMF0sIFsxLCAtMV1dOwoKZnVuY3Rpb24gdHJhY2VBbmRDb252ZXhpZnkoaW1nRGF0YSkgewogICAgaW1nRGF0YS5kYXRhID0gY3JlYXRlTWFzayhpbWdEYXRhKTsKICAgIHZhciBwb2x5czsKICAgIC8vVEVTVAogICAgc2hvd1RyYWNlZEltYWdlKGltZ0RhdGEsIHBvbHlzLCA1KTsKICAgIHZhciBzOwogICAgcyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgLy9fVEVTVAoKICAgIGF2b2lkU2luZ2xlUGl4ZWxzKGltZ0RhdGEpOwoKICAgIC8vVEVTVAogICAgaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcpIGNvbnNvbGUubG9nKCdhdm9pZFNpbmdsZVBpeGVscyB0b29rICcgKyAobmV3IERhdGUoKS5nZXRUaW1lKCkgLSBzKSArICcgbXNlYycpOwogICAgc2hvd1RyYWNlZEltYWdlKGltZ0RhdGEsIHBvbHlzLCA1KTsKICAgIHMgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgIC8vX1RFU1QKCiAgICB2YXIgcG9seXMgPSB0cmFjZUltYWdlKGltZ0RhdGEpOwoKICAgIC8vVEVTVAogICAgaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcpIGNvbnNvbGUubG9nKCd0cmFjZUltYWdlIHRvb2sgJyArIChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHMpICsgJyBtc2VjJyk7CiAgICBzaG93VHJhY2VkSW1hZ2UoaW1nRGF0YSwgcG9seXMsIDUpOwogICAgcyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgLy9fVEVTVAoKICAgIHBvbHlzID0gc2ltcGxpZnkoaW1nRGF0YSwgcG9seXMpOwoKICAgIC8vVEVTVAogICAgaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcpIGNvbnNvbGUubG9nKCdzaW1wbGlmeSB0b29rICcgKyAobmV3IERhdGUoKS5nZXRUaW1lKCkgLSBzKSArICcgbXNlYycpOwogICAgc2hvd1NpbXBsaWZpZWQoaW1nRGF0YSwgcG9seXMsIDQpOwogICAgcyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgLy9fVEVTVAoKICAgIHBvbHlzID0gdHJpYW5ndWxhdGUocG9seXMpOwoKICAgIC8vVEVTVAogICAgaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcpIGNvbnNvbGUubG9nKCd0cmlhbmd1bGF0ZSB0b29rICcgKyAobmV3IERhdGUoKS5nZXRUaW1lKCkgLSBzKSArICcgbXNlYycpOwogICAgc2hvd1ZlcnRpY2VzKHBvbHlzLCBpbWdEYXRhLncsIGltZ0RhdGEuaCwgNCk7CiAgICBzID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICAvL19URVNUCgogICAgdmFyIHNoYXBlcyA9IHRyaWFuZ2xlc1RvQ29udmV4KHBvbHlzKTsKICAgIC8vVEVTVAogICAgaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcpIGNvbnNvbGUubG9nKCd0cmlhbmdsZXNUb0NvbnZleCB0b29rICcgKyAobmV3IERhdGUoKS5nZXRUaW1lKCkgLSBzKSArICcgbXNlYycpOwogICAgc2hvd0NvbnZleChzaGFwZXMsIGltZ0RhdGEudywgaW1nRGF0YS5oLCA0KTsKICAgIHMgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgIC8vX1RFU1QKCiAgICByZXR1cm4gW2NvbnZleFRvQXJyYXkoc2hhcGVzLCAtaW1nRGF0YS5tYXJnaW4gLSAwLjUpXTsKfQoKZnVuY3Rpb24gaGV4MnJnYihoZXgpIHsKICAgIHJldHVybiBbKGhleCA+PiAxNiAmIDB4ZmYpIC8gMjU1LCAoaGV4ID4+IDggJiAweGZmKSAvIDI1NSwgKGhleCAmIDB4ZmYpIC8gMjU1XTsKfQoKLy8gQ3JlYXRlIGEgbWFzawpmdW5jdGlvbiBjcmVhdGVNYXNrKGltZ0RhdGEpIHsKICAgIHZhciB3ID0gaW1nRGF0YS53LAogICAgICAgIGggPSBpbWdEYXRhLmgsCiAgICAgICAgZGF0YSA9IGltZ0RhdGEuZGF0YSwKCgogICAgLy8gUmV1c2UgZGF0YSBidWZmZXIgdG8gYXZvaWQgZXh0cmEgbWVtb3J5IGFsbG9jYXRpb24KICAgIC8vIFNldHRpbmcgbWFzayB2YWx1ZSByZXBsYWNlcyB0aGUgb3JpZ2luYWwgaW1hZ2UgcGl4ZWwgd2hpY2ggd2UgZG9uJ3QgbmVlZAogICAgLy8gYW55bW9yZQogICAgbWFzayA9IG5ldyBVaW50MzJBcnJheShkYXRhLmJ1ZmZlciksCiAgICAgICAgaTsKICAgIGlmICh0eXBlb2YgaW1nRGF0YS5iYWNrZ3JvdW5kQ29sb3IgPT09ICdudW1iZXInKSB7CiAgICAgICAgdmFyIGFscGhhID0gaW1nRGF0YS5iYWNrZ3JvdW5kQ29sb3IgKiAyNTY7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHcgKiBoOyBpICs9IDEpIHsKICAgICAgICAgICAgbWFza1tpXSA9IGRhdGFbaSAqIDQgKyAzXSA+IGFscGhhID8gMSA6IDA7CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICB2YXIgYyA9IGhleDJyZ2IoaW1nRGF0YS5iYWNrZ3JvdW5kQ29sb3IpOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCB3ICogaDsgaSArPSAxKSB7CiAgICAgICAgICAgIGlmIChkYXRhW2kgKiA0XSA9PT0gY1swXSAmJiBkYXRhW2kgKiA0ICsgMV0gPT09IGNbMV0gJiYgZGF0YVtpICogNCArIDJdID09PSBjWzJdKSB7CiAgICAgICAgICAgICAgICBtYXNrW2ldID0gMTsKICAgICAgICAgICAgfSBlbHNlIG1hc2tbaV0gPSAwOyAvLyBhdXRvIHNldCBieSBVaW50OEFycmF5IGJ1dCBqdXN0IHRvIGJlIHN1cmUKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gbWFzazsKfQoKLy8gVHJhY2Ugcm91dGluZSB3b24ndCB3b3JrIG9uIHNvbWUgc2luZ2xlIHBpeGVsIHBhdHRlcm5zLgovLyBUaGlzIGZ1bmN0aW9uIHdpbGwgYXZvaWQgdGhlbSBieSBhZGRpbmcgYW4gZXh0cmEgcGl4ZWwuCmZ1bmN0aW9uIGF2b2lkU2luZ2xlUGl4ZWxzKGltZ0RhdGEpIHsKICAgIHZhciByZXNldCA9IFtdOwogICAgdmFyIGksCiAgICAgICAgdyA9IGltZ0RhdGEudywKICAgICAgICBoID0gaW1nRGF0YS5oLAogICAgICAgIGx0aCA9IGltZ0RhdGEudyAqIGltZ0RhdGEuaCwKICAgICAgICBkYXRhID0gaW1nRGF0YS5kYXRhOwogICAgZm9yIChpID0gMDsgaSA8IGx0aCAtIHcgLSAxOyBpICs9IDEpIHsKICAgICAgICBpZiAoZGF0YVtpXSA9PT0gMSkgewogICAgICAgICAgICBpZiAoIWRhdGFbaSArIDFdKSB7CiAgICAgICAgICAgICAgICBkYXRhW2kgKyAxXSA9IDI7CiAgICAgICAgICAgICAgICByZXNldC5wdXNoKGkgKyAxKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWRhdGFbaSArIHddKSB7CiAgICAgICAgICAgICAgICBkYXRhW2kgKyB3XSA9IDI7CiAgICAgICAgICAgICAgICByZXNldC5wdXNoKGkgKyB3KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWRhdGFbaSArIHcgKyAxXSkgewogICAgICAgICAgICAgICAgZGF0YVtpICsgdyArIDFdID0gMjsKICAgICAgICAgICAgICAgIHJlc2V0LnB1c2goaSArIHcgKyAxKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjaGVja0RpYWdvbmFsKGopIHsKICAgICAgICBpZiAoIWRhdGFbal0gJiYgIWRhdGFbaiArIHcgKyAxXSAmJiBkYXRhW2ogKyAxXSAmJiBkYXRhW2ogKyB3XSkgewogICAgICAgICAgICBkYXRhW2pdID0gMTsKICAgICAgICAgICAgY2hlY2tEaWFnb25hbChqIC0gdyAtIDEpOwogICAgICAgICAgICBjaGVja0RpYWdvbmFsKGogLSB3KTsKICAgICAgICAgICAgY2hlY2tEaWFnb25hbChqIC0gdyArIDEpOwogICAgICAgIH0KICAgICAgICBpZiAoZGF0YVtqXSAmJiBkYXRhW2ogKyB3ICsgMV0gJiYgIWRhdGFbaiArIDFdICYmICFkYXRhW2ogKyB3XSkgewogICAgICAgICAgICBkYXRhW2ogKyAxXSA9IDE7CiAgICAgICAgICAgIGNoZWNrRGlhZ29uYWwoaiAtIHcgLSAxKTsKICAgICAgICAgICAgY2hlY2tEaWFnb25hbChqIC0gdyk7CiAgICAgICAgICAgIGNoZWNrRGlhZ29uYWwoaiAtIHcgKyAxKTsKICAgICAgICB9CiAgICB9CgogICAgZm9yIChpID0gdyArIDE7IGkgPCBsdGggLSB3IC0gMTsgaSArPSAxKSB7CiAgICAgICAgY2hlY2tEaWFnb25hbChpKTsKICAgIH0KICAgIGZvciAoaSA9IDA7IGkgPCByZXNldC5sZW5ndGg7IGkrKykgewogICAgICAgIGRhdGFbcmVzZXRbaV1dID0gMTsKICAgIH0KfQoKLy8gRmluZCBlZGdlIGFuZCBmb2xsb3cgaXQgdW50aWwgdGhlIHN0YXJ0IGlzIGZvdW5kCi8vIEVkZ2UgZnJvbSAwIC0+IDEgaXMgb3V0ZXIgbGluZSwgZnJvbSAxIC0+IDAgaXMgaW5uZXIgaG9sZQovLyBUcmFjZWQgcGl4ZWxzIGFyZSBtYXJrZWQgdG8gYXZvaWQgZG91YmxlIHRyYWNpbmcKLy8gV2hlbiBhIGhvbGUgaXMgZm91bmQgd2UgY2FuIGVhc2lseSBjcmVhdGUgYSB3ZWFrbHkgc2ltcGxlIHBvbHlnb24KLy8gYnkgbG9va2luZyB0byB0aGUgbGVmdCB1bnRpbCBpdHMgb3V0ZXIgZWRnZSBpcyBmb3VuZC4gVGhhdCBpcyBhbHdheXMKLy8gdGhlIGNvcnJlc3BvbmRpbmcgb3V0ZXIgZWRnZS4KLy8gV2hlbiB0aGUgd2Vha2x5IHNpbXBsZSBwb2x5Z29uIG9wdGlvbiBpcyBzZXQgdGhlIHBvbHlnb25zIGFyZSBjb21iaW5lZAovLyBhbmQgam9pbmVkIGJ5IGFuIGludGVyc2VjdGlvbiBsaW5lLiBUaGUga25vd2xlZGdlIG9mIGFuIGludGVyc2VjdGlvbgovLyBwb2ludCBoZXJlIGlzIHZlcnkgdXNlZnVsIHRvIGNyZWF0ZSBiZXR0ZXIgc2ltcGxpZmllZCBwb2x5cyBpbiB0aGUgbmV4dAovLyBzdGVwLgpmdW5jdGlvbiB0cmFjZUltYWdlKGltZ0RhdGEpIHsKICAgIHZhciBpLAogICAgICAgIHcgPSBpbWdEYXRhLncsCiAgICAgICAgaCA9IGltZ0RhdGEuaCwKICAgICAgICBsdGggPSBpbWdEYXRhLncgKiBpbWdEYXRhLmgsCiAgICAgICAgZGF0YSA9IGltZ0RhdGEuZGF0YSwKICAgICAgICBwb2x5cyA9IFtdLAogICAgICAgIHBvbHksCiAgICAgICAgcCwKICAgICAgICBwcmV2ID0gMCwKICAgICAgICBpbnRlcnNlY3Rpb24sCiAgICAgICAgaW5kZXggPSAwLAogICAgICAgIHdlYWtseVNpbXBsZSA9IGltZ0RhdGEud2Vha2x5U2ltcGxlOwoKICAgIGZvciAoaSA9IHcgKyAxOyBpIDwgbHRoIC0gdyAtIDE7IGkgKz0gMSkgewogICAgICAgIHAgPSBkYXRhW2ldOwogICAgICAgIGlmIChwID09PSAxICYmIHByZXYgPT09IDApIHsKICAgICAgICAgICAgLy8gT3V0ZXIgbGluZQogICAgICAgICAgICBwb2x5ID0gZm9sbG93RWRnZShkYXRhLCBpLCB3LCB0cnVlLCBpbmRleCk7CiAgICAgICAgICAgIGlmIChwb2x5KSB7CiAgICAgICAgICAgICAgICBwb2x5cy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICBvdXRlcjogcG9seSwKICAgICAgICAgICAgICAgICAgICBpbm5lcnM6IFtdCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGluZGV4Kys7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHAgPT09IDAgJiYgcHJldiA9PT0gMSkgewogICAgICAgICAgICBwb2x5ID0gZm9sbG93RWRnZShkYXRhLCBpIC0gMSwgdywgZmFsc2UsIGluZGV4KTsKICAgICAgICAgICAgaWYgKHBvbHkpIHsKICAgICAgICAgICAgICAgIGludGVyc2VjdGlvbiA9IG1lcmdlSW5uZXJQb2x5KGRhdGEsIHBvbHlzLCBwb2x5LCBpIC0gMSwgdywgd2Vha2x5U2ltcGxlKTsKICAgICAgICAgICAgICAgIGlmICghd2Vha2x5U2ltcGxlKSB7CiAgICAgICAgICAgICAgICAgICAgcG9seXNbaW50ZXJzZWN0aW9uLm90aGVySW5kZXhdLmlubmVycy5wdXNoKHBvbHkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHByZXYgPSBwOwogICAgfQoKICAgIC8vIFJlbW92ZSBpbm5lcnMgd2hlbiBuZWVkZWQKICAgIGlmIChpbWdEYXRhLm9wdGlvbnMubm9Ib2xlcykgewogICAgICAgIGZvciAoaSA9IDA7IGkgPCBwb2x5cy5sZW5ndGg7IGkgKz0gMSkgewogICAgICAgICAgICBwb2x5c1tpXS5pbm5lcnMgPSBbXTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gcG9seXM7Cn0KCi8vRm9sbG93IHRoZSBlZGdlIGJ5IGxvb2tpbmcgY291bnRlcmNsb2Nrd2lzZSBpbiA4IGRpcmVjdGlvbnMuCi8vVGhhdCB3YXkgd2Ugc2hvdWxkIGFsd2F5cyBtZWV0IG91ciBzdGFydCBwb2ludCBhZ2FpbgoKZnVuY3Rpb24gZm9sbG93RWRnZShkYXRhLCBvZmZzZXQsIHdpZHRoLCBpc091dGVyLCBpbmRleCkgewogICAgdmFyIHBvbHkgPSBbXSwKICAgICAgICB4cyA9IG9mZnNldCAlIHdpZHRoLAogICAgICAgIHlzID0gTWF0aC5mbG9vcihvZmZzZXQgLyB3aWR0aCksCiAgICAgICAgeCA9IHhzLAogICAgICAgIHhuLAogICAgICAgIHkgPSB5cywKICAgICAgICB5biwKICAgICAgICBkaXIgPSBpc091dGVyID8gMyA6IDYsCiAgICAgICAgZCwKICAgICAgICBwLAogICAgICAgIGx0aCA9IDAsCiAgICAgICAgbWF4UG9pbnRzID0gMTAwMDAwMDAsCgogICAgLy8gQXZvaWQgZW5kbGVzcyBsb29wcwogICAgaSwKICAgICAgICB2ZWM7CgogICAgZGF0YVt4ICsgeSAqIHdpZHRoXSA9IFNUQVJUOwogICAgd2hpbGUgKGx0aCsrIDwgbWF4UG9pbnRzKSB7CiAgICAgICAgZm9yIChpID0gMDsgaSA8PSA4OyBpKyspIHsKICAgICAgICAgICAgaWYgKGkgPT09IDgpIHsKICAgICAgICAgICAgICAgIC8vIFRyaWVkIGFsbCBkaXJlY3Rpb25zLCBtdXN0IGJlIGEgc2luZ2xlIHBpeGVsCiAgICAgICAgICAgICAgICBpZiAoIXBvbHkubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gSWdub3JlIHNpbmdsZSBwaXhlbAogICAgICAgICAgICAgICAgICAgIGRhdGFbeCArIHkgKiB3aWR0aF0gPSBJR05PUkVEOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgZmluZG5leHQgcG9pbnQgYXQgIiArIHhzICsgIiwgIiArIHlzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkID0gKGRpciArIGkpICUgODsKICAgICAgICAgICAgdmVjID0gRElSU1tkXTsKICAgICAgICAgICAgeG4gPSB4ICsgdmVjWzBdOwogICAgICAgICAgICB5biA9IHkgKyB2ZWNbMV07CiAgICAgICAgICAgIHAgPSBkYXRhW3huICsgeW4gKiB3aWR0aF07CiAgICAgICAgICAgIGlmIChwID09PSAwKSBjb250aW51ZTsKICAgICAgICAgICAgeCA9IHhuOwogICAgICAgICAgICB5ID0geW47CiAgICAgICAgICAgIHBvbHkucHVzaCh4LCB5LCBkKTsKICAgICAgICAgICAgZGF0YVt4ICsgeSAqIHdpZHRoXSA9IFRSQUNFRCB8IGluZGV4IDw8IDg7CiAgICAgICAgICAgIGlmIChwID09PSBTVEFSVCkgewogICAgICAgICAgICAgICAgLy8gUG9seSBtdXN0IGF0IGxlYXN0IGNvbnRhaW4gMyBwb2ludHMgKHRyaWFuZ2xlKQogICAgICAgICAgICAgICAgaWYgKHBvbHkubGVuZ3RoID4gMiAqIDMpIHsKICAgICAgICAgICAgICAgICAgICAvLyBBZGQgc3RhcnQgcG9pbnQKICAgICAgICAgICAgICAgICAgICBwb2x5LnB1c2gocG9seVswXSwgcG9seVsxXSwgcG9seVszXSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBvbHk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBJZ25vcmUgbmV4dCB0aW1lICh0b28gc2hvcnQpCiAgICAgICAgICAgICAgICB3aGlsZSAocG9seS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBkYXRhW3BvbHlbMF0gKyB3aWR0aCAqIHBvbHlbMV1dID0gSUdOT1JFRDsKICAgICAgICAgICAgICAgICAgICBwb2x5LnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgcG9seS5zaGlmdCgpOwogICAgICAgICAgICAgICAgICAgIHBvbHkuc2hpZnQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRpciA9IChkICsgOCAtIDMpICUgODsKICAgICAgICAgICAgLy8gY29udGludWUgd2l0aCBuZXh0IHBvaW50CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KICAgIHRocm93IG5ldyBFcnJvcigiVHJhY2luZyBlcnJvci4gRm91bmQgZW5kbGVzcyBsb29wIGF0ICIgKyB4cyArICIsICIgKyB5cyk7Cn0KCmZ1bmN0aW9uIG1lcmdlSW5uZXJQb2x5KGRhdGEsIHBvbHlzLCBpbm5lciwgb2Zmc2V0LCB3aWR0aCwgd2Vha2x5U2ltcGxlKSB7CiAgICB2YXIgeCA9IG9mZnNldCAlIHdpZHRoOwogICAgdmFyIHkgPSBNYXRoLnRydW5jKG9mZnNldCAvIHdpZHRoKTsKICAgIGZvciAodmFyIHhvID0geCAtIDE7IHhvID4gMDsgeG8tLSkgewogICAgICAgIHZhciBvID0geG8gKyB5ICogd2lkdGg7CiAgICAgICAgaWYgKGRhdGFbb10gPj0gVFJBQ0VEKSB7CiAgICAgICAgICAgIHZhciBpbnRlcnNlY3Rpb24gPSBmaW5kSW50ZXJzZWN0aW9uKGRhdGEsIHdpZHRoLCBwb2x5cywgeG8sIHksIHRydWUsIHdlYWtseVNpbXBsZSk7CiAgICAgICAgICAgIGlmIChpbnRlcnNlY3Rpb24pIHsKICAgICAgICAgICAgICAgIC8vIE1hcmsgaW5uZXJsaW5lIHBpeGVscyB0byB0aGlzIG90aGVyUG9seQogICAgICAgICAgICAgICAgdmFyIG90aGVyUG9seSA9IHBvbHlzW2ludGVyc2VjdGlvbi5vdGhlckluZGV4XS5vdXRlcjsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkyID0gMDsgaTIgPCBpbm5lci5sZW5ndGg7IGkyICs9IDMpIHsKICAgICAgICAgICAgICAgICAgICBkYXRhW2lubmVyW2kyXSArIHdpZHRoICogaW5uZXJbaTIgKyAxXV0gJj0gMHgwZmY7CiAgICAgICAgICAgICAgICAgICAgZGF0YVtpbm5lcltpMl0gKyB3aWR0aCAqIGlubmVyW2kyICsgMV1dIHw9IGludGVyc2VjdGlvbi5vdGhlckluZGV4IDw8IDg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAod2Vha2x5U2ltcGxlKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGN1dFBvaW50ID0gaW50ZXJzZWN0aW9uLnBvaW50SW5kZXg7CiAgICAgICAgICAgICAgICAgICAgLy8gU2tpcCBsZWZ0IHZlY3RvcnMKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoY3V0UG9pbnQgPiA2ICYmIG90aGVyUG9seVtjdXRQb2ludCArIDIgLSAzXSA9PT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICBjdXRQb2ludCAtPSAzOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB2YXIgc3RhcnRQb2x5ID0gb3RoZXJQb2x5LnNsaWNlKDAsIGN1dFBvaW50KTsKCiAgICAgICAgICAgICAgICAgICAgdmFyIGVuZFBvbHkgPSBvdGhlclBvbHkuc2xpY2UoaW50ZXJzZWN0aW9uLnBvaW50SW5kZXggLSAzKTsKICAgICAgICAgICAgICAgICAgICBlbmRQb2x5WzFdICs9IDAuMjsKICAgICAgICAgICAgICAgICAgICBlbmRQb2x5WzJdID0gOCArIDI7IC8vIHNwZWNpYWwgdmVjdG9yIGF2b2lkcyBvcHRpbWFsaXNhdGlvbiBoZXJlCiAgICAgICAgICAgICAgICAgICAgaW5uZXJbaW5uZXIubGVuZ3RoIC0gMl0gKz0gMC4yOwogICAgICAgICAgICAgICAgICAgIGlubmVyWzJdID0gOCArIDY7IC8vIHNwZWNpYWwgdmVjdG9yIGF2b2lkcyBvcHRpbWFsaXNhdGlvbiBoZXJlCiAgICAgICAgICAgICAgICAgICAgb3RoZXJQb2x5ID0gc3RhcnRQb2x5LmNvbmNhdChpbm5lci5jb25jYXQoZW5kUG9seSkpOwogICAgICAgICAgICAgICAgICAgIHBvbHlzW2ludGVyc2VjdGlvbi5vdGhlckluZGV4XS5vdXRlciA9IG90aGVyUG9seTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcnNlY3Rpb247CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICB0aHJvdyBuZXcgRXJyb3IoIk91dGVyIGVkZ2Ugbm90IGZvdW5kIik7Cn0KCmZ1bmN0aW9uIGZpbmRJbnRlcnNlY3Rpb24oZGF0YSwgd2lkdGgsIHBvbHlzLCB4LCB5LCBpc0Rvd253YXJkcywgd2Vha2x5U2ltcGxlKSB7CiAgICB2YXIgb2Zmc2V0ID0geCArIHkgKiB3aWR0aDsKICAgIHZhciBvdGhlckluZGV4ID0gZGF0YVtvZmZzZXRdID4+IDg7CiAgICBpZiAob3RoZXJJbmRleCA9PT0gcG9seXMubGVuZ3RoKSB7CiAgICAgICAgLy8gRm91bmQgb3VyIG93biBpbm5lcmxpbmUuIElnbm9yZQogICAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChvdGhlckluZGV4ID49IHBvbHlzLmxlbmd0aCkgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIG9mZnNldCIpOwogICAgdmFyIG90aGVyUG9seSA9IHBvbHlzW290aGVySW5kZXhdLm91dGVyOwogICAgdmFyIGludGVyc2VjdGlvbiA9IGZpbmRJbnRlcnNlY3Rpb25PbkxpbmUoeCwgeSwgb3RoZXJJbmRleCwgb3RoZXJQb2x5LCBpc0Rvd253YXJkcyk7CiAgICBpZiAoaW50ZXJzZWN0aW9uKSB7CiAgICAgICAgcmV0dXJuIGludGVyc2VjdGlvbjsKICAgIH0KICAgIGZvciAodmFyIGggPSAwOyBoIDwgcG9seXNbb3RoZXJJbmRleF0uaW5uZXJzLmxlbmd0aDsgaCsrKSB7CiAgICAgICAgaW50ZXJzZWN0aW9uID0gZmluZEludGVyc2VjdGlvbk9uTGluZSh4LCB5LCBvdGhlckluZGV4LCBwb2x5c1tvdGhlckluZGV4XS5pbm5lcnNbaF0sIGlzRG93bndhcmRzKTsKICAgICAgICBpZiAoaW50ZXJzZWN0aW9uKSB7CiAgICAgICAgICAgIHJldHVybiBpbnRlcnNlY3Rpb247CiAgICAgICAgfQogICAgfQp9CgpmdW5jdGlvbiBmaW5kSW50ZXJzZWN0aW9uT25MaW5lKHgsIHksIG90aGVySW5kZXgsIG90aGVyUG9seSwgaXNEb3dud2FyZHMpIHsKCiAgICAvLyBGaW5kIHBvaW50IG9uIG90aGVyIHBvbHkKICAgIHZhciBkaXJzID0gaXNEb3dud2FyZHMgPyBbMywgNCwgNV0gOiBbMCwgMiwgMSwgNiwgN107CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG90aGVyUG9seS5sZW5ndGg7IGkgKz0gMykgewogICAgICAgIGlmIChvdGhlclBvbHlbaV0gPT09IHggJiYgb3RoZXJQb2x5W2kgKyAxXSA9PT0geSAmJiBkaXJzLmluZGV4T2Yob3RoZXJQb2x5W2kgKyAyXSkgPj0gMCkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgb3RoZXJJbmRleDogb3RoZXJJbmRleCwKICAgICAgICAgICAgICAgIHBvaW50SW5kZXg6IGksCiAgICAgICAgICAgICAgICBpc0Rvd253YXJkczogaXNEb3dud2FyZHMKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9Cn0KCi8vIFNpbXBsaWZ5IGNyZWF0ZXMgYSByYXN0ZXIgMngyIHRpbWVzIGxhcmdlciB0aGFuIHRoZSBpbWFnZS4KLy8gVGhlbiBkcmF3IHRoZSBzbWFsbCBwb2x5IGxpbmVzIHdpdGggYSAnc2xvcGUnIGFyb3VuZCBpdC4gU2xvcGUgd2lkdGggaXMKLy8gdGhlIHRvbGVyYW5jZSB2YWx1ZSBmb3Igc2ltcGxpZmljYXRpb24uIFRoaXMgbWVhbnMgdGhhdCBhcyBsb25nIGFzIHdlCi8vIGNhbiBkcmF3IGEgc3RyYWlnaHQgbGluZSBiZXR3ZWVuIHZlcnRpY2VzIHdoaWxlIHN0YXlpbiAnb24gdGhlIHNsb3BlJwovLyB0aGUgbGluZSBpcyB3aXRoaW4gdGhlIHRvbGVyYW5jZSB2YWx1ZToKLy8KLy8gICAgICAgICAgWCAgICAgICAgICBYICAgWCAgICAgIFgKLy8KLy8gICAgICAgICAgXyAgICAgICAgICBfICAgXyAgICAgIF8KLy8gICAgICAgICBfIF8gICAgICAgIF8gXyBfIF8gICAgXyBfCi8vICAgICAgICBfICAgXyAgICAgIF8gICBfICAgXyAgXyAgIF8KLy8gICAgICAgXyAgICAgXyAgICBfICAgICAgICAgX18gICAgIF8KLy8gICBfX19fICAgICAgIF9fX18gICAgICAgICAgICAgICAgICBfCi8vCi8vIEluIHRoZSBuZXh0IHN0ZXAgYWxsICd2YWxsZXkgcG9pbnRzJyBhcmUgZGV0ZWN0ZWQgYW5kIHNldCB0byAwLgovLwovLyAgICAgICAgICBYICAgICAgICAgIFggICBYICAgICAgWAovLwovLyAgICAgICAgICBfICAgICAgICAgIF8gICBfICAgICAgXwovLyAgICAgICAgIF8gXyAgICAgICAgXyBfIF8gXyAgICBfIF8KLy8gICAgICAgIF8gICBfICAgICAgXyAgICAgICBfICBfICAgXwovLyAgICAgICBfICAgICBfICAgIF8gICAgICAgICAgXyAgICAgXwovLyAgIF9fX18gICAgICAgX19fXyAgICAgXyAgICBfICAgICAgIF8KLy8gICAgICAgICAgICAgICAgICAgICAgIDAgICAgMAovLwovLyBXaXRoIHRoaXMgcmFzdGVyIHRoZSBzaW1saWZpZWQgbGluZXMgY2FuIGJlIGZvdW5kIGJ5IGNvbm5lY3RpbmcKLy8gdmVydHJpY2VzIGFzIGxvbmcgYXMgdGhlIHN0cmFpZ2h0IGxpbmUgYmV0d2VlbiBkZSB2ZXJ0aWNlcyBkbwovLyBub3QgY3Jvc3MgJzAnIHZhbHVlcy4gVGhpcyB3aWxsIGd1YXJhbnRlZSB0aGF0IHNpbXBsaWZpZWQgbGluZXMKLy8gd2lsbCBuZXZlciBvdmVybGFwLgovLyBGb3Igc3BlZWQgb3B0aW1hbGl6YXRpb24gd2UgdXNlIGJpc2VjdGluZyBzdGVwcyAoc3RhcnQgd2l0aCAzMiBvciBtYXgKLy8gaGFsZiB0aGUgdG90YWwgcG9seSBsZW5ndGgpLgovLyBGLmUuIHdoZW4gdGhlIGxhcmdlc3QgZml0dGluZyBsaW5lIGxlbmd0aCBpcyA0MyB0aGUgZm9sbG93aW5nIGxlbmd0aHMKLy8gd2lsbCBiZSB0ZXN0ZWQ6IDMyLCA2NCwgNDgsIDQwLCA0NCwgNDIsIDQzCmZ1bmN0aW9uIHNpbXBsaWZ5KGltZ0RhdGEsIHBvbHlzKSB7CiAgICB2YXIgeiA9IGltZ0RhdGEuc2ltcGxpZnlab29tID0gMjsKICAgIHZhciBzID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICB2YXIgbHcgPSBpbWdEYXRhLncgKiB6OwogICAgdmFyIGxoID0gaW1nRGF0YS5oICogejsKICAgIHZhciBkZWx0YXMgPSBpbWdEYXRhLnRvbGVyYW5jZSAqIHo7CiAgICAvLyBSZXVzZSBhcnJheQogICAgdmFyIGxiID0gbmV3IFVpbnQ4QXJyYXkoaW1nRGF0YS5kYXRhLmJ1ZmZlcik7CiAgICBpbWdEYXRhLmRhdGEgPSBsYjsKICAgIHZhciB4LCB5LCBkOwogICAgdmFyIGk7CiAgICBmb3IgKGkgPSAwOyBpIDwgbGIubGVuZ3RoOyBpKyspIHsKICAgICAgICBsYltpXSA9IDA7CiAgICB9CiAgICB2YXIgbCwgcG9seSwgaDsKICAgIHZhciB4MCwgeTAsIHgxLCB5MTsKICAgIHZhciB3ZWFrbHlTaW1wbGUgPSBpbWdEYXRhLndlYWtseVNpbXBsZTsKICAgIHZhciB0b2xlcmFuY2UgPSBNYXRoLnJvdW5kKGltZ0RhdGEudG9sZXJhbmNlICogeik7CiAgICB2YXIgbWFzayA9IG5ldyBBcnJheSh0b2xlcmFuY2UpOwogICAgZm9yICh4ID0gMDsgeCA8IHRvbGVyYW5jZTsgeCsrKSB7CiAgICAgICAgbWFza1t4XSA9IG5ldyBBcnJheSh0b2xlcmFuY2UpOwogICAgICAgIGZvciAoeSA9IDA7IHkgPCB0b2xlcmFuY2U7IHkrKykgewogICAgICAgICAgICBkID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkpOwogICAgICAgICAgICBtYXNrW3hdW3ldID0gMjU1IC0gTWF0aC5mbG9vcigyNTYgLyB0b2xlcmFuY2UpICogZDsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gc2V0UG9pbnQoX3gsIF95KSB7CiAgICAgICAgZm9yICh2YXIgbXggPSAwOyBteCA8IG1hc2subGVuZ3RoOyBteCsrKSB7CiAgICAgICAgICAgIGZvciAodmFyIG15ID0gMDsgbXkgPCBtYXNrLmxlbmd0aDsgbXkrKykgewogICAgICAgICAgICAgICAgaWYgKG1hc2tbbXhdW215XSA+IGxiW194ICsgbXggKyAoX3kgKyBteSkgKiBsd10pIHsKICAgICAgICAgICAgICAgICAgICBsYltfeCArIG14ICsgKF95ICsgbXkpICogbHddID0gbWFza1tteF1bbXldOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG1hc2tbbXhdW215XSA+IGxiW194IC0gbXggKyAoX3kgKyBteSkgKiBsd10pIHsKICAgICAgICAgICAgICAgICAgICBsYltfeCAtIG14ICsgKF95ICsgbXkpICogbHddID0gbWFza1tteF1bbXldOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG1hc2tbbXhdW215XSA+IGxiW194ICsgbXggKyAoX3kgLSBteSkgKiBsd10pIHsKICAgICAgICAgICAgICAgICAgICBsYltfeCArIG14ICsgKF95IC0gbXkpICogbHddID0gbWFza1tteF1bbXldOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG1hc2tbbXhdW215XSA+IGxiW194IC0gbXggKyAoX3kgLSBteSkgKiBsd10pIHsKICAgICAgICAgICAgICAgICAgICBsYltfeCAtIG14ICsgKF95IC0gbXkpICogbHddID0gbWFza1tteF1bbXldOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZvciAobCA9IDA7IGwgPCBwb2x5cy5sZW5ndGg7IGwrKykgewogICAgICAgIHBvbHkgPSBwb2x5c1tsXS5vdXRlcjsKICAgICAgICBmb3IgKGkgPSAzOyBpIDwgcG9seS5sZW5ndGg7IGkgKz0gMykgewogICAgICAgICAgICB4MCA9IHBvbHlbaSAtIDNdICogejsKICAgICAgICAgICAgeTAgPSBwb2x5W2kgLSAyXSAqIHo7CiAgICAgICAgICAgIHgxID0gcG9seVtpXSAqIHo7CiAgICAgICAgICAgIHkxID0gcG9seVtpICsgMV0gKiB6OwogICAgICAgICAgICBjYWxjTGluZSh4MCwgeTAsIHgxLCB5MSwgc2V0UG9pbnQpOwogICAgICAgIH0KICAgICAgICBpZiAoIXdlYWtseVNpbXBsZSkgewogICAgICAgICAgICBmb3IgKGggPSAwOyBoIDwgcG9seXNbbF0uaW5uZXJzLmxlbmd0aDsgaCsrKSB7CiAgICAgICAgICAgICAgICBwb2x5ID0gcG9seXNbbF0uaW5uZXJzW2hdOwogICAgICAgICAgICAgICAgZm9yIChpID0gMzsgaSA8IHBvbHkubGVuZ3RoOyBpICs9IDMpIHsKICAgICAgICAgICAgICAgICAgICB4MCA9IHBvbHlbaSAtIDNdICogejsKICAgICAgICAgICAgICAgICAgICB5MCA9IHBvbHlbaSAtIDJdICogejsKICAgICAgICAgICAgICAgICAgICB4MSA9IHBvbHlbaV0gKiB6OwogICAgICAgICAgICAgICAgICAgIHkxID0gcG9seVtpICsgMV0gKiB6OwogICAgICAgICAgICAgICAgICAgIGNhbGNMaW5lKHgwLCB5MCwgeDEsIHkxLCBzZXRQb2ludCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgdmFyIG9mZnNldCwgdjsKCiAgICAvLyBmaW5kIGxvd2VzdCBwb2ludHMgYW5kIHNldCB0aGVtIHRvIDAKICAgIGZvciAob2Zmc2V0ID0gbHcgKiAyICsgMjsgb2Zmc2V0IDwgbGIubGVuZ3RoIC0gMSAtIGx3OyBvZmZzZXQgKz0gMSkgewogICAgICAgIHYgPSBsYltvZmZzZXRdOwogICAgICAgIGlmICgobGJbb2Zmc2V0IC0gMV0gPiB2IHx8IGxiW29mZnNldCAtIDJdID4gdikgJiYgbGJbb2Zmc2V0ICsgMV0gPiB2KSB7CiAgICAgICAgICAgIGxiW29mZnNldF0gPSAwOwogICAgICAgIH0KICAgICAgICBpZiAoKGxiW29mZnNldCAtIGx3XSA+IHYgfHwgbGJbb2Zmc2V0IC0gbHcgLSBsd10gPiB2KSAmJiBsYltvZmZzZXQgKyBsd10gPiB2KSB7CiAgICAgICAgICAgIGxiW29mZnNldF0gPSAwOwogICAgICAgIH0KICAgICAgICBpZiAoKGxiW29mZnNldCAtIGx3IC0gMV0gPiB2IHx8IGxiW29mZnNldCAtIGx3IC0gbHcgLSAyXSA+IHYpICYmIGxiW29mZnNldCArIGx3ICsgMV0gPiB2KSB7CiAgICAgICAgICAgIGxiW29mZnNldF0gPSAwOwogICAgICAgIH0KICAgICAgICBpZiAoKGxiW29mZnNldCAtIGx3ICsgMV0gPiB2IHx8IGxiW29mZnNldCAtIGx3IC0gbHcgKyAyXSA+IHYpICYmIGxiW29mZnNldCArIGx3IC0gMV0gPiB2KSB7CiAgICAgICAgICAgIGxiW29mZnNldF0gPSAwOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAoIXdlYWtseVNpbXBsZSkgewogICAgICAgIGZvciAobCA9IDA7IGwgPCBwb2x5cy5sZW5ndGg7IGwrKykgewogICAgICAgICAgICBwb2x5c1tsXS5vdXRlciA9IHNpbXBsaWZ5U2VnbWVudChsYiwgbHcsIHosIHBvbHlzW2xdLm91dGVyLCB3ZWFrbHlTaW1wbGUpOwogICAgICAgICAgICBmb3IgKGggPSAwOyBoIDwgcG9seXNbbF0uaW5uZXJzLmxlbmd0aDsgaCsrKSB7CiAgICAgICAgICAgICAgICBwb2x5c1tsXS5pbm5lcnNbaF0gPSBzaW1wbGlmeVNlZ21lbnQobGIsIGx3LCB6LCBwb2x5c1tsXS5pbm5lcnNbaF0sIHdlYWtseVNpbXBsZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIC8vIGZpbmQgc2ltcGxpZmllZCBwb2x5cwogICAgICAgIHZhciBpMCwgaTEsIG5ld1BvbHksIHN1YlBvbHk7CiAgICAgICAgZm9yIChsID0gMDsgbCA8IHBvbHlzLmxlbmd0aDsgbCsrKSB7CiAgICAgICAgICAgIHBvbHkgPSBwb2x5c1tsXS5vdXRlcjsKICAgICAgICAgICAgLy8gTW92ZSBmaXJzdCBwb2ludCB0byBlbmQgb2YgcG9pbnQuIFJlc3VsdHMgaW4gYmV0dGVyIGhvcml6b250YWwvdmVydGljYWwgcG9seSByZWNvZ25pdGlvbgogICAgICAgICAgICAvLwogICAgICAgICAgICBwb2x5LnNoaWZ0KCk7CiAgICAgICAgICAgIHBvbHkuc2hpZnQoKTsKICAgICAgICAgICAgcG9seS5zaGlmdCgpOwogICAgICAgICAgICBwb2x5LnB1c2gocG9seVswXSk7CiAgICAgICAgICAgIHBvbHkucHVzaChwb2x5WzFdKTsKICAgICAgICAgICAgcG9seS5wdXNoKHBvbHlbMl0pOwogICAgICAgICAgICBuZXdQb2x5ID0gW107CiAgICAgICAgICAgIGkwID0gMDsKICAgICAgICAgICAgaTEgPSAzOwogICAgICAgICAgICB3aGlsZSAoaTEgPCBwb2x5Lmxlbmd0aCkgewogICAgICAgICAgICAgICAgLy8gQ2hlY2sgaW50ZXJzZWN0aW9uCiAgICAgICAgICAgICAgICBpZiAocG9seVtpMSArIDJdICYgOCkgewogICAgICAgICAgICAgICAgICAgIC8vIEludGVyc2VjdGlvbiB3aGVyZSBpMSBwb2ludHMgdG8gb3RoZXIgc2lkZS4gU2ltcGxpZnkgc2VnbWVudCB0byBtYWludGFpbiBjb3JyZWN0IGludGVyc2VjdGlvbgogICAgICAgICAgICAgICAgICAgIC8vIHBvbHlzIGFuZCB0byBhdm9pZCBvdmVybGFwCiAgICAgICAgICAgICAgICAgICAgc3ViUG9seSA9IHNpbXBsaWZ5U2VnbWVudChsYiwgbHcsIHosIHBvbHkuc2xpY2UoaTAsIGkxKSwgd2Vha2x5U2ltcGxlKTsKICAgICAgICAgICAgICAgICAgICBuZXdQb2x5ID0gbmV3UG9seS5jb25jYXQoc3ViUG9seSk7CiAgICAgICAgICAgICAgICAgICAgbmV3UG9seS5wdXNoKHBvbHlbaTFdKTsKICAgICAgICAgICAgICAgICAgICBuZXdQb2x5LnB1c2gocG9seVtpMSArIDFdKTsKICAgICAgICAgICAgICAgICAgICBpMCA9IGkxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaTEgKz0gMzsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdWJQb2x5ID0gc2ltcGxpZnlTZWdtZW50KGxiLCBsdywgeiwgcG9seS5zbGljZShpMCwgaTEgKyAzLCB3ZWFrbHlTaW1wbGUpKTsKICAgICAgICAgICAgbmV3UG9seSA9IG5ld1BvbHkuY29uY2F0KHN1YlBvbHkpOwogICAgICAgICAgICBwb2x5c1tsXS5vdXRlciA9IG5ld1BvbHk7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBwb2x5czsKfQoKZnVuY3Rpb24gc2ltcGxpZnlTZWdtZW50KGxiLCBsdywgeiwgcG9seSwgd2Vha2x5U2ltcGxlKSB7CiAgICB2YXIgdmFsaWQsCiAgICAgICAgaTAsCiAgICAgICAgaTEsCiAgICAgICAgaXByZXYsCiAgICAgICAgbnAsCiAgICAgICAgbywKICAgICAgICBvbGltaXQsCiAgICAgICAgc3JhbmdlID0gMzIsCiAgICAgICAgczAsCiAgICAgICAgczEsCiAgICAgICAgc2F2ZywKICAgICAgICBwdCwKICAgICAgICBsLAogICAgICAgIHByZXZMZW5ndGggPSAxMDA7CgogICAgZnVuY3Rpb24gY2hlY2tQb2ludCh4LCB5KSB7CiAgICAgICAgLy9jb25zb2xlLmxvZygncHQgJyArIHggKyAnLCAnICsgeSArICcgLT4gJyArIGxiW3ggKyB5ICogbHddKTsKICAgICAgICByZXR1cm4gbGJbeCArIHkgKiBsd10gPiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGNoZWNrTGluZVNlZ21lbnQoX3gxLCBfeTEsIF94MiwgX3kyKSB7CiAgICAgICAgLy8gSW52YWxpZCBwb2ludHMgYXJlIHN0YXRpc3RpY2FsbHkgbW9zdGx5IGF0IHRoZSBlbmQgb2YgYSBsaW5lLiBTbyB3ZSBkcmF3IHRoZSBsaW5lIGJhY2t3YXJkcwogICAgICAgIHZhciBfcmVzdWx0ID0gY2FsY0xpbmUoX3gyICogeiwgX3kyICogeiwgX3gxICogeiwgX3kxICogeiwgY2hlY2tQb2ludCk7CiAgICAgICAgLy8gY29uc29sZS5sb2coJ2NoZWNrIHJlc3VsdCAnICsgX3Jlc3VsdCk7CiAgICAgICAgcmV0dXJuIF9yZXN1bHQ7CiAgICB9CgogICAgZnVuY3Rpb24gY2hlY2tMaW5lKF9pMCwgX2kxKSB7CiAgICAgICAgLy8gY29uc29sZS5sb2coJ2NoZWNrICcgKyBfaTAgKyAnICcgKyBfaTEpOwogICAgICAgIGlmIChfaTEgPj0gcG9seS5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNoZWNrTGluZVNlZ21lbnQocG9seVtfaTBdLCBwb2x5W19pMCArIDFdLCBwb2x5W19pMV0sIHBvbHlbX2kxICsgMV0pOwogICAgfQoKICAgIGlmICghd2Vha2x5U2ltcGxlKSB7CiAgICAgICAgLy8gTW92ZSBmaXJzdCBwb2ludCB0byBlbmQgb2YgcG9pbnQuIFJlc3VsdHMgaW4gYmV0dGVyIGhvcml6b250YWwvdmVydGljYWwgbGluZSByZWNvZ25pdGlvbgogICAgICAgIC8vcG9seS5wdXNoKHBvbHkuc2hpZnQoKSwgcG9seS5zaGlmdCgpLCBwb2x5LnNoaWZ0KCkpOwogICAgICAgIHBvbHkuc2hpZnQoKTsKICAgICAgICBwb2x5LnNoaWZ0KCk7CiAgICAgICAgcG9seS5zaGlmdCgpOwogICAgICAgIHBvbHkucHVzaChwb2x5WzBdLCBwb2x5WzFdLCBwb2x5WzJdKTsKICAgIH0KCiAgICBucCA9IFtwb2x5WzBdLCBwb2x5WzFdXTsKICAgIGkwID0gMDsKICAgIC8vIHMyIG1heSBub3QgZXhjZWVkIDEvNCBvZiBwb2x5IGxlbmd0aC4gT3RoZXJ3aXNlIHdlIG1heSBnbyBpbiB0aGUgd3JvbmcgZGlyZWN0aW9uCiAgICB3aGlsZSAoc3JhbmdlID4gMiAmJiBzcmFuZ2UgPiBwb2x5Lmxlbmd0aCAvIDMgLyA0KSB7CiAgICAgICAgc3JhbmdlIC89IDI7CiAgICB9CgogICAgd2hpbGUgKGkwIDwgcG9seS5sZW5ndGggLSAzKSB7CgogICAgICAgIC8vIEZpbmQgcGFydCB3aGVyZSBzMiBpcyB0b28gbG9uZwogICAgICAgIHMwID0gMDsKICAgICAgICBzMSA9IHNyYW5nZTsKICAgICAgICB3aGlsZSAoY2hlY2tMaW5lKGkwLCBpMCArIHMxICogMykpIHsKICAgICAgICAgICAgczAgPSBzMTsKICAgICAgICAgICAgczEgKz0gc3JhbmdlOwogICAgICAgIH0KCiAgICAgICAgZG8gewogICAgICAgICAgICAvL2NvbnNvbGUubG9nKCc+ICcgKyBzMCArICcgJyArIHMxKTsKICAgICAgICAgICAgc2F2ZyA9IE1hdGgucm91bmQoKHMwICsgczEpIC8gMik7CiAgICAgICAgICAgIGlmIChjaGVja0xpbmUoaTAsIGkwICsgc2F2ZyAqIDMpKSB7CiAgICAgICAgICAgICAgICBzMCA9IHNhdmc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzMSA9IHNhdmc7CiAgICAgICAgICAgIH0KICAgICAgICB9IHdoaWxlIChzMSAtIHMwID4gMSk7CiAgICAgICAgaTEgPSBpMCArIHMwICogMzsKICAgICAgICAvLyBsb29rIHRpbGwgNCBwb2ludHMgYmFjayBidXQgdW50aWwgbGVhdmUgYXQgMyBwb2ludHMgaW4gdGhlIHBvbHkKICAgICAgICBvbGltaXQgPSBNYXRoLm1heChpMSAtIDYgKiAzLCBpMCArIDMgKiAzKTsKICAgICAgICBmb3IgKG8gPSBpMTsgbyA+IG9saW1pdDsgbyAtPSAzKSB7CiAgICAgICAgICAgIC8vIGNoZWNrIGlmIGkwLnggPT09IG8ueCBvciBpMC55ID09IG8ueQogICAgICAgICAgICBpZiAocG9seVtpMF0gPT09IHBvbHlbb10gfHwgcG9seVtpMCArIDFdID09PSBwb2x5W28gKyAxXSkgewogICAgICAgICAgICAgICAgaTEgPSBvOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChwcmV2TGVuZ3RoIDwgNCAmJiBucC5sZW5ndGggPj0gNikgewogICAgICAgICAgICAvLyBQcmV2aW91cyB3YXMgc21hbGwgc2VnbWVudC4gQ2hlY2sgaWYgaXQgY2FuIGJlIHJlbW92ZWQgYnkgam9pbmluZyB0aGUgbGluZXMgYmVmb3JlIGFuZCBhZnRlcgogICAgICAgICAgICBsID0gbnAubGVuZ3RoOwogICAgICAgICAgICBwdCA9IGdldFNlZ21lbnRJbnRlcnNlY3Rpb25Qb2ludChucFtsIC0gNl0sIG5wW2wgLSA1XSwgbnBbbCAtIDRdLCBucFtsIC0gM10sIG5wW2wgLSAyXSwgbnBbbCAtIDFdLCBwb2x5W2kxXSwgcG9seVtpMSArIDFdLCBNYXRoLlBJIC8gNCk7CiAgICAgICAgICAgIGlmIChwdCAmJiBjaGVja0xpbmVTZWdtZW50KG5wW2wgLSA2XSwgbnBbbCAtIDVdLCBwdFswXSwgcHRbMV0pICYmIGNoZWNrTGluZVNlZ21lbnQocHRbMF0sIHB0WzFdLCBwb2x5W2kxXSwgcG9seVtpMSArIDFdKSkgewogICAgICAgICAgICAgICAgbnBbbnAubGVuZ3RoIC0gNF0gPSBwdFswXTsKICAgICAgICAgICAgICAgIG5wW25wLmxlbmd0aCAtIDNdID0gcHRbMV07CiAgICAgICAgICAgICAgICBucC5wb3AoKTsKICAgICAgICAgICAgICAgIG5wLnBvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdwdXNoICcgKyBpMCArICcgLT4gJyArIGkxKTsKICAgICAgICBucC5wdXNoKHBvbHlbaTFdLCBwb2x5W2kxICsgMV0pOwogICAgICAgIHByZXZMZW5ndGggPSAoaTEgLSBpMCkgLyAzOwogICAgICAgIGkwID0gaTE7CiAgICB9CgogICAgaWYgKHByZXZMZW5ndGggPCA0ICYmIG5wLmxlbmd0aCA+PSA4KSB7CiAgICAgICAgLy8gUHJldmlvdXMgd2FzIHNtYWxsIHNlZ21lbnQuIENoZWNrIGlmIGl0IGNhbiBiZSByZW1vdmVkIGJ5IGpvaW5pbmcgdGhlIGxpbmVzIGJlZm9yZSBhbmQgYWZ0ZXIKICAgICAgICBsID0gbnAubGVuZ3RoOwogICAgICAgIHB0ID0gZ2V0U2VnbWVudEludGVyc2VjdGlvblBvaW50KG5wW2wgLSA2XSwgbnBbbCAtIDVdLCBucFtsIC0gNF0sIG5wW2wgLSAzXSwgbnBbbCAtIDJdLCBucFtsIC0gMV0sIG5wWzJdLCBucFszXSwgTWF0aC5QSSAvIDQpOwogICAgICAgIGlmIChwdCAmJiBucFswXSA9PT0gbnBbbCAtIDJdICYmIG5wWzFdID09PSBucFtsIC0gMV0gJiYgY2hlY2tMaW5lU2VnbWVudChucFtsIC0gNl0sIG5wW2wgLSA1XSwgcHRbMF0sIHB0WzFdKSAmJiBjaGVja0xpbmVTZWdtZW50KHB0WzBdLCBwdFsxXSwgbnBbMl0sIG5wWzNdKSkgewogICAgICAgICAgICBucFswXSA9IHB0WzBdOwogICAgICAgICAgICBucFsxXSA9IHB0WzFdOwogICAgICAgICAgICBucFtucC5sZW5ndGggLSA0XSA9IHB0WzBdOwogICAgICAgICAgICBucFtucC5sZW5ndGggLSAzXSA9IHB0WzFdOwogICAgICAgICAgICBucC5wb3AoKTsKICAgICAgICAgICAgbnAucG9wKCk7CiAgICAgICAgfQogICAgfQogICAgLy9pMSAtPSAzOwogICAgLy9pZiAoaTEgPiBpMCkgewogICAgLy8gICAgbnAucHVzaChwb2x5W2kxXSwgcG9seVtpMSArIDFdKTsKICAgIC8vfQogICAgaWYgKG5wLmxlbmd0aCA8PSAyICogMikgewogICAgICAgIG5wID0gW107CiAgICB9CiAgICByZXR1cm4gbnA7Cn0KCmZ1bmN0aW9uIGdldFNlZ21lbnRJbnRlcnNlY3Rpb25Qb2ludCh4czEsIHlzMSwgeGUxLCB5ZTEsIHhzMiwgeXMyLCB4ZTIsIHllMiwgbWluQW5nbGUpIHsKICAgIHZhciBkeDEgPSB4ZTEgLSB4czE7CiAgICB2YXIgZHkxID0geWUxIC0geXMxOwogICAgdmFyIGR4MiA9IHhlMiAtIHhzMjsKICAgIHZhciBkeTIgPSB5ZTIgLSB5czI7CiAgICB2YXIgYW5nbGUxID0gTWF0aC5hdGFuMihkeTEsIGR4MSk7CiAgICB2YXIgYW5nbGUyID0gTWF0aC5hdGFuMihkeTIsIGR5MSk7CiAgICB2YXIgYW5nbGUgPSBNYXRoLmFicyhhbmdsZTEgLSBhbmdsZTIpOwogICAgaWYgKGFuZ2xlID4gTWF0aC5QSSkgewogICAgICAgIGFuZ2xlIC09IE1hdGguUEk7CiAgICB9CiAgICBpZiAoYW5nbGUgPCBtaW5BbmdsZSkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgdmFyIGQgPSBkeTIgKiBkeDEgLSBkeDIgKiBkeTE7CiAgICBpZiAoIWQpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIHZhciBhID0geXMxIC0geXMyOwogICAgdmFyIGIgPSB4czEgLSB4czI7CiAgICB2YXIgbjEgPSBkeDIgKiBhIC0gZHkyICogYjsKICAgIHZhciBuMiA9IGR4MSAqIGEgLSBkeTEgKiBiOwogICAgYSA9IG4xIC8gZDsKICAgIGIgPSBuMiAvIGQ7CiAgICByZXR1cm4gW3hzMSArIGEgKiBkeDEsIHlzMSArIGEgKiBkeTFdOwp9CgovLyBCcmVzZW5oYW0gYWxnb3JpdGhtIGZvciBkcmF3d2luZyBzdHJhaWdodCBsaW5lcwpmdW5jdGlvbiBjYWxjTGluZSh4MCwgeTAsIHgxLCB5MSwgaGFuZGxlcikgewogICAgeDAgPSBNYXRoLnJvdW5kKHgwKTsKICAgIHkwID0gTWF0aC5yb3VuZCh5MCk7CiAgICB4MSA9IE1hdGgucm91bmQoeDEpOwogICAgeTEgPSBNYXRoLnJvdW5kKHkxKTsKICAgIHZhciBkeCA9IHgxIC0geDA7CiAgICB2YXIgZHkgPSB5MSAtIHkwOwogICAgdmFyIGRlY2xpdmUgPSBmYWxzZSwKICAgICAgICBzaW1ldHJpY28gPSBmYWxzZTsKICAgIHZhciB0ZW1wOwoKICAgIGlmIChkeCAqIGR5IDwgMCkgewogICAgICAgIHkwID0gLXkwOwogICAgICAgIHkxID0gLXkxOwogICAgICAgIGR5ID0gLWR5OwogICAgICAgIHNpbWV0cmljbyA9IHRydWU7CiAgICB9CgogICAgaWYgKE1hdGguYWJzKGR4KSA8IE1hdGguYWJzKGR5KSkgewogICAgICAgIHRlbXAgPSBkeDsKICAgICAgICBkeCA9IGR5OwogICAgICAgIGR5ID0gdGVtcDsKCiAgICAgICAgdGVtcCA9IHgwOwogICAgICAgIHgwID0geTA7CiAgICAgICAgeTAgPSB0ZW1wOwoKICAgICAgICB0ZW1wID0geDE7CiAgICAgICAgeDEgPSB5MTsKICAgICAgICB5MSA9IHRlbXA7CgogICAgICAgIGRlY2xpdmUgPSB0cnVlOwogICAgfQoKICAgIGlmICh4MCA+IHgxKSB7CiAgICAgICAgdGVtcCA9IHgwOwogICAgICAgIHgwID0geDE7CiAgICAgICAgeDEgPSB0ZW1wOwoKICAgICAgICB0ZW1wID0geTA7CiAgICAgICAgeTAgPSB5MTsKICAgICAgICB5MSA9IHRlbXA7CgogICAgICAgIGR4ID0gLWR4OwogICAgICAgIGR5ID0gLWR5OwogICAgfQoKICAgIHZhciBkID0gMiAqIGR5IC0gZHg7CiAgICB2YXIgaW5jRSA9IDIgKiBkeTsKICAgIHZhciBpbmNORSA9IDIgKiAoZHkgLSBkeCk7CgogICAgdmFyIHB4LAogICAgICAgIHB5LAogICAgICAgIHkgPSB5MDsKICAgIGZvciAodmFyIHggPSB4MDsgeCA8PSB4MTsgeCsrKSB7CiAgICAgICAgaWYgKGRlY2xpdmUpIHsKICAgICAgICAgICAgcHggPSB5OwogICAgICAgICAgICBweSA9IHg7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcHggPSB4OwogICAgICAgICAgICBweSA9IHk7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2ltZXRyaWNvKSB7CiAgICAgICAgICAgIHB5ID0gLXB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKCFoYW5kbGVyKHB4LCBweSkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgaWYgKGQgPD0gMCkgewogICAgICAgICAgICBkICs9IGluY0U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZCArPSBpbmNORTsKICAgICAgICAgICAgeSsrOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB0cnVlOwp9CgpmdW5jdGlvbiB0cmlhbmd1bGF0ZShwb2x5cykgewogICAgLy8gUmVvcmRlciBwb3lnb25zIGZvciBlYXJjdXQKICAgIHZhciBuZXdQb2x5cyA9IFtdOwogICAgdmFyIGwsIHBvbHksIHBvbHlBbGwsIGlubmVySW5kaWNlcywgaCwgaW5uZXI7CiAgICBmb3IgKGwgPSAwOyBsIDwgcG9seXMubGVuZ3RoOyBsKyspIHsKICAgICAgICBwb2x5ID0gcG9seXNbbF07CiAgICAgICAgaW5uZXJJbmRpY2VzID0gW107CiAgICAgICAgcG9seUFsbCA9IHBvbHkub3V0ZXI7CiAgICAgICAgZm9yIChoID0gMDsgaCA8IHBvbHkuaW5uZXJzLmxlbmd0aDsgaCsrKSB7CiAgICAgICAgICAgIGlubmVyID0gcG9seS5pbm5lcnNbaF07CiAgICAgICAgICAgIGlmIChpbm5lci5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGlubmVySW5kaWNlcy5wdXNoKHBvbHlBbGwubGVuZ3RoIC8gMik7CiAgICAgICAgICAgICAgICBwb2x5QWxsID0gcG9seUFsbC5jb25jYXQoaW5uZXIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIG5ld1BvbHlzLnB1c2goewogICAgICAgICAgICBwb2x5OiBwb2x5QWxsLAogICAgICAgICAgICB2ZXJ0aWNlczogZWFyY3V0KHBvbHlBbGwsIGlubmVySW5kaWNlcykKICAgICAgICB9KTsKICAgIH0KICAgIHJldHVybiBuZXdQb2x5czsKfQoKdmFyIFBvbHlMaW5lID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5pZCA9IFBvbHlMaW5lLklEKys7Cn07ClBvbHlMaW5lLklEID0gMTsKUG9seUxpbmUucHJvdG90eXBlID0gewogICAgaWQ6IDAsCiAgICB2ZWN0aWNlczogbnVsbAp9OwoKdmFyIFZlcnRyaWNlID0gZnVuY3Rpb24gKHgsIHksIHBvbHkpIHsKICAgIHRoaXMuaWQgPSBWZXJ0cmljZS5JRCsrOwogICAgdGhpcy54ID0geDsKICAgIHRoaXMueSA9IHk7CiAgICB0aGlzLm5leHQgPSB0aGlzOwogICAgdGhpcy5wcmV2ID0gdGhpczsKICAgIHRoaXMucG9seSA9IHBvbHk7Cn07ClZlcnRyaWNlLklEID0gMTsKVmVydHJpY2UucHJvdG90eXBlID0gewogICAgaWQ6IDAsCiAgICB4OiAwLjAsCiAgICB5OiAwLjAsCiAgICBuZXh0OiBudWxsLAogICAgcHJldjogbnVsbCwKICAgIHBvbHk6IG51bGwsCiAgICBhcHBlbmQ6IGZ1bmN0aW9uICh2KSB7CiAgICAgICAgdGhpcy5wcmV2Lm5leHQgPSB2OwogICAgICAgIHYucHJldiA9IHRoaXMucHJldjsKICAgICAgICB0aGlzLnByZXYgPSB2OwogICAgICAgIHYubmV4dCA9IHRoaXM7CiAgICAgICAgdi5wb2x5ID0gdGhpcy5wb2x5OwogICAgfQp9OwoKZnVuY3Rpb24gc29ydFZlY3RvcnModmVjdHMpIHsKICAgIHZhciBzb3J0ZWRWZWN0b3JzID0ge307CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZlY3RzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIHYgPSB2ZWN0c1tpXTsKICAgICAgICBkbyB7CiAgICAgICAgICAgIHYucG9seS51c2VkID0gZmFsc2U7CiAgICAgICAgICAgIHYuZmlyc3QgPSBmYWxzZTsKICAgICAgICAgICAgdmFyIGtleSA9IHYueC50b1N0cmluZygpOwogICAgICAgICAgICBpZiAoIXNvcnRlZFZlY3RvcnMuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICAgICAgICAgICAgc29ydGVkVmVjdG9yc1trZXldID0gW3ZdOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc29ydGVkVmVjdG9yc1trZXldLnB1c2godik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdiA9IHYubmV4dDsKICAgICAgICB9IHdoaWxlICh2ICE9IHZlY3RzW2ldKTsKICAgIH0KICAgIHJldHVybiBzb3J0ZWRWZWN0b3JzOwp9CgovKioNCiAqICBSZXR1cm4gdHJ1ZSBpZiBjb3JuZXIgdG8gdGhlIHJpZ2h0DQogKiBAcGFyYW0gcDANCiAqIEBwYXJhbSBwMQ0KICovCmZ1bmN0aW9uIGlzQ2xvY2t3aXNlKHAwLCBwMSwgcDIpIHsKICAgIHZhciBheCA9IHAyLnggLSBwMS54OwogICAgdmFyIGF5ID0gcDIueSAtIHAxLnk7CiAgICB2YXIgYnggPSBwMS54IC0gcDAueDsKICAgIHZhciBieSA9IHAxLnkgLSBwMC55OwogICAgcmV0dXJuIGJ5ICogYXggLSBieCAqIGF5IDwgLTAuMTsgLy8gRG8gbm90IHVzZSAwIGhlcmUsIHVzZSBzb21lIG1hcmdpbiBmb3Igcm91bmRpbmcgZXJyb3JzCn0KCmZ1bmN0aW9uIGZpbmROZXh0VHJpYW5nbGUoc29ydGVkVmVjdHMsIHZlY3RzKSB7CiAgICB2YXIgdiA9IHZlY3RzOwogICAgZG8gewogICAgICAgIHZhciB4cG9pbnRzID0gc29ydGVkVmVjdHNbdi54LnRvU3RyaW5nKCldOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgeHBvaW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgdjEgPSB4cG9pbnRzW2ldOwogICAgICAgICAgICBpZiAoIXYxLnBvbHkudXNlZCAmJiB2LnBvbHkgIT09IHYxLnBvbHkgJiYgdi54ID09PSB2MS54ICYmIHYueSA9PT0gdjEueSkgewogICAgICAgICAgICAgICAgaWYgKHYucHJldi54ID09PSB2MS5uZXh0LnggJiYgdi5wcmV2LnkgPT09IHYxLm5leHQueSkgewogICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIGlmIGNvbnZleCBmb3IgYm90aCBnbHVlcG9pbnRzCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzQ2xvY2t3aXNlKHYxLnByZXYsIHYsIHYubmV4dCkgJiYgaXNDbG9ja3dpc2Uodi5wcmV2LnByZXYsIHYucHJldiwgdjEubmV4dC5uZXh0KSkgewogICAgICAgICAgICAgICAgICAgICAgICB2MS5wb2x5LnVzZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmEgPSB2LnByZXY7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2MWEgPSB2MS5uZXh0OwogICAgICAgICAgICAgICAgICAgICAgICB2MWEubmV4dC5wcmV2ID0gdmE7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhLm5leHQgPSB2MWEubmV4dDsKICAgICAgICAgICAgICAgICAgICAgICAgdjEucHJldi5uZXh0ID0gdjsKICAgICAgICAgICAgICAgICAgICAgICAgdi5wcmV2ID0gdjEucHJldjsKICAgICAgICAgICAgICAgICAgICAgICAgZmluZE5leHRUcmlhbmdsZShzb3J0ZWRWZWN0cywgdik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh2Lm5leHQueCA9PT0gdjEucHJldi54ICYmIHYubmV4dC55ID09PSB2MS5wcmV2LnkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNDbG9ja3dpc2Uodi5wcmV2LCB2LCB2MS5uZXh0KSAmJiBpc0Nsb2Nrd2lzZSh2MS5wcmV2LnByZXYsIHYxLnByZXYsIHYubmV4dC5uZXh0KSkgewogICAgICAgICAgICAgICAgICAgICAgICB2MS5wb2x5LnVzZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmEgPSB2Lm5leHQ7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2MWEgPSB2MS5wcmV2OwogICAgICAgICAgICAgICAgICAgICAgICB2MWEucHJldi5uZXh0ID0gdmE7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhLnByZXYgPSB2MWEucHJldjsKICAgICAgICAgICAgICAgICAgICAgICAgdjEubmV4dC5wcmV2ID0gdjsKICAgICAgICAgICAgICAgICAgICAgICAgdi5uZXh0ID0gdjEubmV4dDsKICAgICAgICAgICAgICAgICAgICAgICAgZmluZE5leHRUcmlhbmdsZShzb3J0ZWRWZWN0cywgdik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHYgPSB2Lm5leHQ7CiAgICB9IHdoaWxlICghdi5maXJzdCk7Cn0KCmZ1bmN0aW9uIGZpbmRDb252ZXgoc29ydGVkVmVjdHMpIHsKICAgIHZhciBjb252ZXhMaXN0ID0gW107CgogICAgZm9yICh2YXIga2V5IGluIHNvcnRlZFZlY3RzKSB7CiAgICAgICAgdmFyIHhwb2ludHMgPSBzb3J0ZWRWZWN0c1trZXldOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHhwb2ludHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdmFyIHYgPSB4cG9pbnRzW2ldOwogICAgICAgICAgICBpZiAodi5wb2x5LnVzZWQpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIFN0YXJ0IG5ldyBDb252ZXgKICAgICAgICAgICAgY29udmV4TGlzdC5wdXNoKHYpOwogICAgICAgICAgICB2LnBvbHkudXNlZCA9IHRydWU7CiAgICAgICAgICAgIHYuZmlyc3QgPSB0cnVlOwogICAgICAgICAgICAvLyBGaW5kIG1hdGNoaW5nIGVkZ2UKICAgICAgICAgICAgZmluZE5leHRUcmlhbmdsZShzb3J0ZWRWZWN0cywgdik7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIGNvbnZleExpc3Q7Cn0KCmZ1bmN0aW9uIG1ha2VDbG9ja3dpc2UodmVjdCkgewogICAgdmFyIHYgPSB2ZWN0OwogICAgdmFyIHN1bSA9IDAuMDsKICAgIGRvIHsKICAgICAgICBzdW0gKz0gKHYubmV4dC54IC0gdi54KSAqICh2Lm5leHQueSArIHYueSk7CiAgICAgICAgdiA9IHYubmV4dDsKICAgIH0gd2hpbGUgKHYgIT0gdmVjdCk7CiAgICAvLyB3aGVuIHN1bSA8IDAgaXQgaXMgY291bnRlcmNsb2Nrd2lzZS4gQnV0IHktYXhpcyBwb2ludHMgZG93bndhcmRzIHNvIG1pcnJvcmVkIG1ha2VzIGl0IGNsb2Nrd2lzZQogICAgaWYgKHN1bSA+IDApIHsKICAgICAgICAvLyBjb3VudGVyY2xvY2t3aXNlOiB0dXJuIGFyb3VuZAogICAgICAgIHYgPSB2ZWN0OwogICAgICAgIHZhciB2MiA9IG5ldyBWZXJ0cmljZSh2LngsIHYueSwgdi5wb2x5KTsKICAgICAgICBkbyB7CiAgICAgICAgICAgIHYyLmFwcGVuZChuZXcgVmVydHJpY2Uodi5wcmV2LngsIHYucHJldi55LCB2LnByZXYucG9seSkpOwogICAgICAgICAgICB2ID0gdi5wcmV2OwogICAgICAgIH0gd2hpbGUgKHYgIT0gdmVjdCk7CiAgICAgICAgcmV0dXJuIHYyOwogICAgfQogICAgcmV0dXJuIHZlY3Q7Cn0KCi8vIFRyeSB0byBtYWtlIGNvbnZleCBwb2x5bGluZXMgZnJvbSB0cmlhbmdsZXMgYnkgbWVyZ2luZyB0cmlhbmdsZXMgYXMgbG9uZwovLyBhcyBpdCBzdGF5cyBhIGNvbnZleC4gT3B0aW1pemVkIGJ5IHNvcnRpbmcgYWxsIHZlcnRpY2VzIGJ5IGl0cyB4LWNvb3JkaW5hdGUuCi8vIEludGVybmFsbHkgYSB2ZXJ0cmljZSBsaW5rZWQgbGlzdCBpcyB1c2VkLgpmdW5jdGlvbiB0cmlhbmdsZXNUb0NvbnZleCh0cmlhbmdsZXMpIHsKICAgIHZhciBzaGFwZXMgPSBbXTsKICAgIGZvciAodmFyIGwgPSAwOyBsIDwgdHJpYW5nbGVzLmxlbmd0aDsgbCsrKSB7CiAgICAgICAgdmFyIGxpbmUgPSB0cmlhbmdsZXNbbF0ucG9seTsKICAgICAgICB2YXIgdmVydGljZXMgPSBbXTsKICAgICAgICB2YXIgdiA9IHRyaWFuZ2xlc1tsXS52ZXJ0aWNlczsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHYubGVuZ3RoOyBpICs9IDMpIHsKICAgICAgICAgICAgdmFyIHBvbHkgPSBuZXcgUG9seUxpbmUoKTsKICAgICAgICAgICAgcG9seS52ZXJ0aWNlcyA9IG5ldyBWZXJ0cmljZShsaW5lW3ZbaV0gKiAyXSwgbGluZVt2W2ldICogMiArIDFdLCBwb2x5KTsKICAgICAgICAgICAgcG9seS52ZXJ0aWNlcy5hcHBlbmQobmV3IFZlcnRyaWNlKGxpbmVbdltpICsgMV0gKiAyXSwgbGluZVt2W2kgKyAxXSAqIDIgKyAxXSkpOwogICAgICAgICAgICBwb2x5LnZlcnRpY2VzLmFwcGVuZChuZXcgVmVydHJpY2UobGluZVt2W2kgKyAyXSAqIDJdLCBsaW5lW3ZbaSArIDJdICogMiArIDFdKSk7CiAgICAgICAgICAgIHBvbHkudmVydGljZXMgPSBtYWtlQ2xvY2t3aXNlKHBvbHkudmVydGljZXMpOwogICAgICAgICAgICB2ZXJ0aWNlcy5wdXNoKHBvbHkudmVydGljZXMpOwogICAgICAgIH0KICAgICAgICB2YXIgc29ydGVkVmVjdHMgPSBzb3J0VmVjdG9ycyh2ZXJ0aWNlcyk7CiAgICAgICAgdmFyIGNvbnZleExpc3QgPSBmaW5kQ29udmV4KHNvcnRlZFZlY3RzKTsKCiAgICAgICAgc2hhcGVzLnB1c2goY29udmV4TGlzdCk7CiAgICB9CiAgICByZXR1cm4gc2hhcGVzOwp9CgpmdW5jdGlvbiBjb252ZXhUb0FycmF5KGNvbnZleExpc3RzLCBvZmZzZXQpIHsKICAgIHZhciBpLCBsLCBjb252ZXhMaXN0LCBpbmRleCwgdiwgYXJyYXksIHZlcnRpY2VzTGVuZ3RoUG9zLCBzaGFwZUNvdW50OwoKICAgIGluZGV4ID0gMTsgLy8gZmlyc3QgcG9zaXRpb24gaXMgZm9yIHNoYXBlIGNvdW50CiAgICBmb3IgKGwgPSAwOyBsIDwgY29udmV4TGlzdHMubGVuZ3RoOyBsKyspIHsKICAgICAgICBjb252ZXhMaXN0ID0gY29udmV4TGlzdHNbbF07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGNvbnZleExpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdiA9IGNvbnZleExpc3RbaV07CiAgICAgICAgICAgIGluZGV4Kys7IC8vIHBvc2l0aW9uIGZvciB2ZXJ0aWNlcyBsZW5ndGgKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgaW5kZXggKz0gMjsgLy8geCBhbmQgeSBwb3NpdGlvbgogICAgICAgICAgICAgICAgdiA9IHYubmV4dDsKICAgICAgICAgICAgfSB3aGlsZSAodiAhPSBjb252ZXhMaXN0W2ldKTsKICAgICAgICB9CiAgICB9CgogICAgYXJyYXkgPSBuZXcgRmxvYXQzMkFycmF5KGluZGV4KTsKICAgIGluZGV4ID0gMTsKICAgIHNoYXBlQ291bnQgPSAwOwogICAgZm9yIChsID0gMDsgbCA8IGNvbnZleExpc3RzLmxlbmd0aDsgbCsrKSB7CiAgICAgICAgY29udmV4TGlzdCA9IGNvbnZleExpc3RzW2xdOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb252ZXhMaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHZlcnRpY2VzTGVuZ3RoUG9zID0gaW5kZXgrKzsKICAgICAgICAgICAgdiA9IGNvbnZleExpc3RbaV07CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIGFycmF5W2luZGV4KytdID0gdi54ICsgb2Zmc2V0OwogICAgICAgICAgICAgICAgYXJyYXlbaW5kZXgrK10gPSB2LnkgKyBvZmZzZXQ7CiAgICAgICAgICAgICAgICB2ID0gdi5uZXh0OwogICAgICAgICAgICB9IHdoaWxlICh2ICE9IGNvbnZleExpc3RbaV0pOwogICAgICAgICAgICBhcnJheVt2ZXJ0aWNlc0xlbmd0aFBvc10gPSAoaW5kZXggLSB2ZXJ0aWNlc0xlbmd0aFBvcyAtIDEpIC8gMjsKICAgICAgICAgICAgc2hhcGVDb3VudCArPSAxOwogICAgICAgIH0KICAgIH0KICAgIGFycmF5WzBdID0gc2hhcGVDb3VudDsKICAgIHJldHVybiBhcnJheTsKfQoKLy9URVNUCmZ1bmN0aW9uIHNob3dUcmFjZWRJbWFnZShpbWdEYXRhLCBwb2x5cywgem9vbSkgewogICAgaWYgKHR5cGVvZiBkb2N1bWVudCA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybjsKCiAgICB2YXIgeiA9IHpvb20gfHwgNTsKICAgIHZhciB6bCA9IHo7CiAgICB2YXIgc3RlcCA9IDM7CgogICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgY2FudmFzLndpZHRoID0gaW1nRGF0YS53ICogejsKICAgIGNhbnZhcy5oZWlnaHQgPSBpbWdEYXRhLmggKiB6OwogICAgdmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgdmFyIHgsIHksIHAsIGk7CiAgICBjdHguZmlsbFN0eWxlID0gJ3JnYmEoMCwgMCwgMTI4LCAwLjMpJzsKICAgIGZvciAoeCA9IDA7IHggPCBpbWdEYXRhLnc7IHgrKykgewogICAgICAgIGZvciAoeSA9IDA7IHkgPCBpbWdEYXRhLmg7IHkrKykgewogICAgICAgICAgICBwID0gaW1nRGF0YS5kYXRhW3ggKyBpbWdEYXRhLncgKiB5XTsKICAgICAgICAgICAgaWYgKHAgJiAweGZmKSB7CiAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QoeCAqIHosIHkgKiB6LCB6LCB6KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBkcmF3TGluZShwb2x5KSB7CiAgICAgICAgdmFyIGlzRmlyc3QgPSB0cnVlOwogICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICBmb3IgKHZhciBsMiA9IDA7IGwyIDwgcG9seS5sZW5ndGg7IGwyICs9IHN0ZXApIHsKICAgICAgICAgICAgeCA9IChwb2x5W2wyXSArIDAuNSkgKiB6bDsKICAgICAgICAgICAgeSA9IChwb2x5W2wyICsgMV0gKyAwLjUpICogemw7CiAgICAgICAgICAgIGlmIChpc0ZpcnN0KSB7CiAgICAgICAgICAgICAgICBjdHgubW92ZVRvKHgsIHkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3R4LmxpbmVUbyh4LCB5KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpc0ZpcnN0ID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgY3R4LnN0cm9rZSgpOwogICAgfQoKICAgIGlmIChwb2x5cykgewogICAgICAgIGN0eC5zdHJva2VTdHlsZSA9ICdibHVlJzsKICAgICAgICBjdHguZmlsbFN0eWxlID0gJ3JnYmEoMjU1LCAwLCAwLCAwKSc7CgogICAgICAgIGZvciAodmFyIGwxID0gMDsgbDEgPCBwb2x5cy5sZW5ndGg7IGwxKyspIHsKICAgICAgICAgICAgdmFyIHBvbHkgPSBwb2x5c1tsMV07CiAgICAgICAgICAgIGlmIChwb2x5Lmhhc093blByb3BlcnR5KCdvdXRlcicpKSB7CiAgICAgICAgICAgICAgICBkcmF3TGluZShwb2x5Lm91dGVyKTsKICAgICAgICAgICAgICAgIGZvciAodmFyIGggPSAwOyBoIDwgcG9seS5pbm5lcnMubGVuZ3RoOyBoKyspIHsKICAgICAgICAgICAgICAgICAgICBkcmF3TGluZShwb2x5LmlubmVyc1toXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBkcmF3TGluZShwb2x5KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY2FudmFzKTsKfQoKZnVuY3Rpb24gc2hvd1NpbXBsaWZpZWQoaW1nRGF0YSwgcG9seXMsIHpvb20pIHsKICAgIGlmICh0eXBlb2YgZG9jdW1lbnQgPT09ICd1bmRlZmluZWQnKSByZXR1cm47CiAgICB2YXIgeiA9IHpvb20gfHwgMTsKICAgIHZhciB6bCA9IHogKiBpbWdEYXRhLnNpbXBsaWZ5Wm9vbTsKICAgIHZhciBzdGVwID0gMjsKCiAgICB2YXIgeCwKICAgICAgICB5LAogICAgICAgIHAsCiAgICAgICAgaSwKICAgICAgICB3ID0gaW1nRGF0YS53ICogaW1nRGF0YS5zaW1wbGlmeVpvb20sCiAgICAgICAgaCA9IGltZ0RhdGEuaCAqIGltZ0RhdGEuc2ltcGxpZnlab29tOwogICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgY2FudmFzLndpZHRoID0gdyAqIHo7CiAgICBjYW52YXMuaGVpZ2h0ID0gaCAqIHo7CiAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7CgogICAgZm9yICh4ID0gMDsgeCA8IHc7IHgrKykgewogICAgICAgIGZvciAoeSA9IDA7IHkgPCBoOyB5KyspIHsKICAgICAgICAgICAgcCA9IGltZ0RhdGEuZGF0YVt4ICsgdyAqIHldOwogICAgICAgICAgICBpZiAocCkgewogICAgICAgICAgICAgICAgLy8gPVAKICAgICAgICAgICAgICAgIHAgPSAyNTUgLSBwOwogICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICdyZ2IoJyArIFtwLCBwLCBwXS5qb2luKCcsJykgKyAnKSc7CiAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QoeCAqIHosIHkgKiB6LCB6LCB6KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBkcmF3TGluZShwb2x5KSB7CiAgICAgICAgdmFyIGlzRmlyc3QgPSB0cnVlOwogICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICBmb3IgKHZhciBsMiA9IDA7IGwyIDwgcG9seS5sZW5ndGg7IGwyICs9IHN0ZXApIHsKICAgICAgICAgICAgeCA9IChwb2x5W2wyXSArIDAuNSkgKiB6bDsKICAgICAgICAgICAgeSA9IChwb2x5W2wyICsgMV0gKyAwLjUpICogemw7CiAgICAgICAgICAgIGlmIChpc0ZpcnN0KSB7CiAgICAgICAgICAgICAgICBjdHgubW92ZVRvKHgsIHkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3R4LmxpbmVUbyh4LCB5KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpc0ZpcnN0ID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGN0eC5zdHJva2UoKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gJ3JnYmEoMjU1LCAwLCAwLCAwLjMpJzsKICAgICAgICBmb3IgKGwyID0gMDsgbDIgPCBwb2x5Lmxlbmd0aDsgbDIgKz0gc3RlcCkgewogICAgICAgICAgICB4ID0gKHBvbHlbbDJdICsgMC41KSAqIHpsOwogICAgICAgICAgICB5ID0gKHBvbHlbbDIgKyAxXSArIDAuNSkgKiB6bDsKICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICBjdHguYXJjKHgsIHksIDEwLCAwLCAyICogTWF0aC5QSSwgZmFsc2UpOwogICAgICAgICAgICBjdHguZmlsbCgpOwogICAgICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgfQogICAgfQoKICAgIGlmIChwb2x5cykgewogICAgICAgIGN0eC5zdHJva2VTdHlsZSA9ICdyZ2IoMjU1LCAwLCAyNTUpJzsKICAgICAgICBjdHguZmlsbFN0eWxlID0gJ3JnYmEoMjU1LCAwLCAwLCAwKSc7CgogICAgICAgIGZvciAodmFyIGwxID0gMDsgbDEgPCBwb2x5cy5sZW5ndGg7IGwxKyspIHsKICAgICAgICAgICAgdmFyIHBvbHkgPSBwb2x5c1tsMV07CiAgICAgICAgICAgIGlmIChwb2x5Lmhhc093blByb3BlcnR5KCdvdXRlcicpKSB7CiAgICAgICAgICAgICAgICBkcmF3TGluZShwb2x5Lm91dGVyKTsKICAgICAgICAgICAgICAgIGZvciAodmFyIGggPSAwOyBoIDwgcG9seS5pbm5lcnMubGVuZ3RoOyBoKyspIHsKICAgICAgICAgICAgICAgICAgICBkcmF3TGluZShwb2x5LmlubmVyc1toXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBkcmF3TGluZShwb2x5KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY2FudmFzKTsKfQoKZnVuY3Rpb24gc2hvd1ZlcnRpY2VzKHZlcnRpY2VzLCB3LCBoLCB6KSB7CiAgICBpZiAodHlwZW9mIGRvY3VtZW50ID09PSAndW5kZWZpbmVkJykgcmV0dXJuOwogICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwoKICAgIGNhbnZhcy53aWR0aCA9IHcgKiB6OwogICAgY2FudmFzLmhlaWdodCA9IGggKiB6OwogICAgdmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgY3R4LnN0cm9rZVN0eWxlID0gJ3JnYmEoMCwwLDI1NSwwLjMpJzsKICAgIGN0eC5maWxsU3R5bGUgPSAncmdiYSgyNTUsMCwwLDAuMyknOwogICAgdmFyIGwsIGxpbmUsIHYsIGk7CiAgICBmb3IgKGwgPSAwOyBsIDwgdmVydGljZXMubGVuZ3RoOyBsKyspIHsKICAgICAgICBsaW5lID0gdmVydGljZXNbbF0ucG9seTsKICAgICAgICB2ID0gdmVydGljZXNbbF0udmVydGljZXM7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCB2Lmxlbmd0aDsgaSArPSAzKSB7CiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgY3R4Lm1vdmVUbyhsaW5lW3ZbaV0gKiAyXSAqIHosIGxpbmVbdltpXSAqIDIgKyAxXSAqIHopOwogICAgICAgICAgICBjdHgubGluZVRvKGxpbmVbdltpICsgMV0gKiAyXSAqIHosIGxpbmVbdltpICsgMV0gKiAyICsgMV0gKiB6KTsKICAgICAgICAgICAgY3R4LmxpbmVUbyhsaW5lW3ZbaSArIDJdICogMl0gKiB6LCBsaW5lW3ZbaSArIDJdICogMiArIDFdICogeik7CiAgICAgICAgICAgIGN0eC5saW5lVG8obGluZVt2W2ldICogMl0gKiB6LCBsaW5lW3ZbaV0gKiAyICsgMV0gKiB6KTsKICAgICAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgICAgICAgY3R4LnN0cm9rZSgpOwogICAgICAgIH0KICAgIH0KICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY2FudmFzKTsKfQpmdW5jdGlvbiBzaG93Q29udmV4KHNoYXBlcywgdywgaCwgeikgewogICAgaWYgKHR5cGVvZiBkb2N1bWVudCA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybjsKICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKCiAgICBjYW52YXMud2lkdGggPSB3ICogejsKICAgIGNhbnZhcy5oZWlnaHQgPSBoICogejsKICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgIGN0eC5zdHJva2VTdHlsZSA9ICdyZ2JhKDI1NSwwLDAsMC4zKSc7CiAgICBjdHguZmlsbFN0eWxlID0gJ3JnYmEoMTI4LDEyOCwxMjgsMC4yKSc7CiAgICBjdHgubGluZVdpZHRoID0gejsKICAgIHZhciBsOwogICAgZm9yIChsID0gMDsgbCA8IHNoYXBlcy5sZW5ndGg7IGwrKykgewogICAgICAgIHZhciB2ZWN0ID0gc2hhcGVzW2xdOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmVjdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgIGN0eC5saW5lQ2FwID0gJ3JvdW5kJzsKICAgICAgICAgICAgY3R4LmxpbmVKb2luID0gJ3JvdW5kJzsKICAgICAgICAgICAgdmFyIGZpcnN0ID0gdHJ1ZTsKICAgICAgICAgICAgdmFyIHYgPSB2ZWN0W2ldOwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICBpZiAoZmlyc3QpIHsKICAgICAgICAgICAgICAgICAgICBjdHgubW92ZVRvKHYueCAqIHosIHYueSAqIHopOwogICAgICAgICAgICAgICAgICAgIGZpcnN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGN0eC5saW5lVG8odi54ICogeiwgdi55ICogeik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2ID0gdi5uZXh0OwogICAgICAgICAgICB9IHdoaWxlICh2ICE9IHZlY3RbaV0pOwogICAgICAgICAgICBjdHgubGluZVRvKHYueCAqIHosIHYueSAqIHopOwogICAgICAgICAgICBjdHguZmlsbCgpOwogICAgICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgfQogICAgfQogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjYW52YXMpOwp9CgpmdW5jdGlvbiBzaG93UGh5czJkU2hhcGVzKHNoYXBlcykgewogICAgaWYgKHR5cGVvZiBkb2N1bWVudCA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybjsKICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgIGNhbnZhcy53aWR0aCA9IDEwMDA7CiAgICBjYW52YXMuaGVpZ2h0ID0gMTAwMDsKCiAgICB2YXIgd29ybGQgPSBlbmdpbmUuY3JlYXRlV29ybGQoeyBncmF2aXR5OiBbMCwgMTBdIH0pOwogICAgd29ybGQuY2xlYXIoKTsKICAgIHZhciBoYW5kUmVmZXJlbmNlQm9keSA9IGVuZ2luZS5jcmVhdGVSaWdpZEJvZHkoewogICAgICAgIHR5cGU6ICdzdGF0aWMnCiAgICB9KTsKICAgIHdvcmxkLmFkZFJpZ2lkQm9keShoYW5kUmVmZXJlbmNlQm9keSk7CgogICAgdmFyIGJvZHkgPSBlbmdpbmUuY3JlYXRlUmlnaWRCb2R5KHsKICAgICAgICB0eXBlOiAnc3RhdGljJywKICAgICAgICBzaGFwZXM6IHNoYXBlcywKICAgICAgICBwb3NpdGlvbjogWzAsIDBdCiAgICB9KTsKICAgIHdvcmxkLmFkZFJpZ2lkQm9keShib2R5KTsKICAgIHdvcmxkLnN0ZXAoMCk7CiAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgICB2YXIgc2NhbGUgPSAwLjAyNTsKICAgIGZvciAodmFyIHMgPSAwOyBzIDwgYm9keS5zaGFwZXMubGVuZ3RoOyBzKyspIHsKICAgICAgICB2YXIgc2hhcGUgPSBib2R5LnNoYXBlc1tzXTsKICAgICAgICB2YXIgcGRhdGEgPSBzaGFwZS5fZGF0YTsKICAgICAgICB2YXIgZmlyc3RYID0gbnVsbCwKICAgICAgICAgICAgZmlyc3RZID0gbnVsbDsKICAgICAgICBmb3IgKHZhciBpID0gNjsgaSA8IHBkYXRhLmxlbmd0aDsgaSArPSAxMykgewogICAgICAgICAgICB2YXIgeCA9IHBkYXRhW2kgKyAyXSAvIHNjYWxlOwogICAgICAgICAgICB2YXIgeSA9IHBkYXRhW2kgKyAzXSAvIHNjYWxlOwogICAgICAgICAgICBpZiAoZmlyc3RYID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICBmaXJzdFggPSB4OwogICAgICAgICAgICAgICAgZmlyc3RZID0geTsKICAgICAgICAgICAgICAgIGN0eC5tb3ZlVG8oeCwgeSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjdHgubGluZVRvKHgsIHkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGN0eC5saW5lVG8oZmlyc3RYLCBmaXJzdFkpOwogICAgICAgIGN0eC5zdHJva2UoKTsKICAgIH0KICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY2FudmFzKTsKfQoKLy9pZiAodHlwZW9mIHJ1blRlc3QgIT09ICd1bmRlZmluZWQnKSB7Ci8vICAgIHZhciBlbmdpbmUgPSBQaHlzaWNzMkREZXZpY2UuY3JlYXRlKCk7Ci8vCi8vICAgIHdpbmRvdy5lYXJjdXQgPSByZXF1aXJlKCcuLi9taXNjL2VhcmN1dF93cmFwcGVkJykoKTsKLy8gICAgdmFyIEltYWdlVHJhY2VyID0gcmVxdWlyZSgnLi4vbWlzYy90cmFjZXJ3b3JrZXJzJyk7Ci8vICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTsKLy8gICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uKCkgewovLyAgICAgICAgdmFyIGltZ0RhdGEgPSBJbWFnZVRyYWNlci5nZXRJbWFnZURhdGEoaW1nLCAyLCAxMDAwICogMTAwMCk7Ci8vICAgICAgICBpbWdEYXRhLndlYWtseVNpbXBsZSA9IGZhbHNlOwovLyAgICAgICAgdmFyIGFycmF5ID0gdHJhY2VBbmRDb252ZXhpZnkoaW1nRGF0YSlbMF07Ci8vICAgICAgICB2YXIgc2hhcGVzID0gYXJyYXlUb1BvbHlnb25TaGFwZXMoZW5naW5lLCBhcnJheSwgMC4wMjUpOwovLyAgICAgICAgc2hvd1BoeXMyZFNoYXBlcyhzaGFwZXMpOwovLyAgICB9OwovLyAgICBpbWcuc3JjID0gc3JjOwovL30KLy9fVEVTVAoKfSx7ImVhcmN1dCI6MX1dLDM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7Cgp2YXIgX2NvZGVjYWJfdHJhY2VyX3dvcmtlciA9IHJlcXVpcmUoJy4vY29kZWNhYl90cmFjZXJfd29ya2VyJyk7Cgp2YXIgX2NvZGVjYWJfdHJhY2VyX3dvcmtlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9jb2RlY2FiX3RyYWNlcl93b3JrZXIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsKICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsKfQoKKDAsIF9jb2RlY2FiX3RyYWNlcl93b3JrZXIyLmRlZmF1bHQpKHNlbGYpOwoKfSx7Ii4vY29kZWNhYl90cmFjZXJfd29ya2VyIjo0fV0sNDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CiJ1c2Ugc3RyaWN0IjsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgIHZhbHVlOiB0cnVlCn0pOwoKZXhwb3J0cy5kZWZhdWx0ID0gZnVuY3Rpb24gKHNlbGYpIHsKICAgIHZhciBtZSA9IHNlbGYgfHwge307CiAgICBtZS5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciBkYXRhID0gZS5kYXRhOwogICAgICAgIHZhciByZXN1bHRMaXN0ID0gbnVsbDsKICAgICAgICB2YXIgZXJyb3JNZXNzYWdlID0gbnVsbDsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmVzdWx0TGlzdCA9IGRvQ29tbWFuZChkYXRhKTsKICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgcmVzdWx0TGlzdCA9IFtdOwogICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSBlcnIubWVzc2FnZTsKICAgICAgICB9CgogICAgICAgIHZhciByZXN1bHRUcmFuc2Zlckxpc3QgPSBbXTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlc3VsdExpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgcmVzdWx0VHJhbnNmZXJMaXN0LnB1c2gocmVzdWx0TGlzdFtpXS5idWZmZXIpOwogICAgICAgIH0KICAgICAgICB2YXIgcmV0dXJuRGF0YSA9IHsKICAgICAgICAgICAgdGlja2V0OiBkYXRhLnRpY2tldCwKICAgICAgICAgICAgcmVzdWx0TGlzdDogcmVzdWx0TGlzdCwKICAgICAgICAgICAgZXJyTXNnOiBlcnJvck1lc3NhZ2UsCiAgICAgICAgICAgIHdvcmtlcklkOiBkYXRhLndvcmtlcklkCiAgICAgICAgfTsKICAgICAgICBtZS5wb3N0TWVzc2FnZShyZXR1cm5EYXRhLCByZXN1bHRUcmFuc2Zlckxpc3QpOwogICAgICAgIHJldHVybiByZXR1cm5EYXRhOwogICAgfTsKCiAgICBmdW5jdGlvbiBkb0NvbW1hbmQoZGF0YSkgewogICAgICAgIGlmIChkYXRhLmNtZCA9PT0gJ3RyYWNlQW5kQ29udmV4aWZ5JykgewogICAgICAgICAgICByZXR1cm4gKDAsIF9jb2RlY2FiX3RyYWNlci50cmFjZUFuZENvbnZleGlmeSkoZGF0YS5pbWdEYXRhKTsKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIGNvbW1hbmQgIiArIGRhdGEuY21kKTsKICAgIH0KfTsKCnZhciBfY29kZWNhYl90cmFjZXIgPSByZXF1aXJlKCcuL2NvZGVjYWJfdHJhY2VyJyk7Cgo7Cgp9LHsiLi9jb2RlY2FiX3RyYWNlciI6Mn1dfSx7fSxbM10pOwo=';
export default s;